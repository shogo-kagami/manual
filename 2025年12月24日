data.terraform_remote_state.tfstate: Reading...
data.terraform_remote_state.tfstate: Read complete after 1s
data.aws_security_group.reimei_rag_sg_relay_subnet: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_vpc.reimei_rag_main_vpc: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Read complete after 0s [id=subnet-07eaa5c2b02e5b427]
aws_s3_object.serve_config["sbkk-01"]: Refreshing state... [id=sbkk/ray-serve-config-sbkk-01/latest.yaml]
aws_s3_object.serve_config["sbkk-02"]: Refreshing state... [id=sbkk/ray-serve-config-sbkk-02/latest.yaml]
data.aws_security_group.reimei_rag_sg_relay_subnet: Read complete after 0s [id=sg-081ae7e5679bbb12f]
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Read complete after 0s [id=subnet-0a1d36335207cb4f4]
aws_lb.app: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0]
aws_lb_listener.http["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/f338b3d651cbf668]
aws_lb_listener.http["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/a04c2098bab782ee]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 0s [id=vpc-07758e1658c4c2149]
aws_lb_target_group.ray_workers: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358]
aws_lb_target_group.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428]
aws_lb_target_group.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f]
aws_lb_target_group_attachment.ray_workers["10.120.113.14"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216130935871000000001]
aws_lb_target_group_attachment.ray_workers["10.120.113.16"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216130935945200000003]
aws_lb_target_group_attachment.ray_workers["10.120.113.12"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216130935917800000002]
aws_lb_target_group_attachment.ray_workers["10.120.113.13"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445205000000001]
aws_lb_target_group_attachment.ray_workers["10.120.113.17"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445278200000003]
aws_lb_target_group_attachment.ray_workers["10.120.113.15"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445497800000004]
aws_lb_target_group_attachment.ray_workers["10.120.113.18"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216130936282700000004]
aws_lb_target_group_attachment.ray_workers["10.120.113.11"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445255700000002]
aws_lb_listener_rule.ray_workers["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/a04c2098bab782ee/c86c2deef32d0051]
aws_lb_listener_rule.ray_workers["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/f338b3d651cbf668/a671887ee430fe6c]
aws_lb_listener.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157/a4c5a80fb6493b1f]
aws_lb_listener.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157/747f5b8606ebbe97]

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  ~ update in-place
  - destroy

Terraform will perform the following actions:

  # aws_lb_target_group_attachment.ray_workers["10.120.113.11"] will be destroyed
  # (because key ["10.120.113.11"] is not in for_each map)
  - resource "aws_lb_target_group_attachment" "ray_workers" {
      - availability_zone = "all" -> null
      - id                = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445255700000002" -> null
      - port              = 8008 -> null
      - target_group_arn  = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358" -> null
      - target_id         = "10.120.113.11" -> null
    }

  # aws_lb_target_group_attachment.ray_workers["10.120.113.13"] will be destroyed
  # (because key ["10.120.113.13"] is not in for_each map)
  - resource "aws_lb_target_group_attachment" "ray_workers" {
      - availability_zone = "all" -> null
      - id                = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445205000000001" -> null
      - port              = 8008 -> null
      - target_group_arn  = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358" -> null
      - target_id         = "10.120.113.13" -> null
    }

  # aws_lb_target_group_attachment.ray_workers["10.120.113.15"] will be destroyed
  # (because key ["10.120.113.15"] is not in for_each map)
  - resource "aws_lb_target_group_attachment" "ray_workers" {
      - availability_zone = "all" -> null
      - id                = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445497800000004" -> null
      - port              = 8008 -> null
      - target_group_arn  = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358" -> null
      - target_id         = "10.120.113.15" -> null
    }

  # aws_lb_target_group_attachment.ray_workers["10.120.113.17"] will be destroyed
  # (because key ["10.120.113.17"] is not in for_each map)
  - resource "aws_lb_target_group_attachment" "ray_workers" {
      - availability_zone = "all" -> null
      - id                = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358-20251216124445278200000003" -> null
      - port              = 8008 -> null
      - target_group_arn  = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251216122736299100000001/69cec505765bd358" -> null
      - target_id         = "10.120.113.17" -> null
    }

  # aws_s3_object.serve_config["sbkk-01"] will be updated in-place
  ~ resource "aws_s3_object" "serve_config" {
      ~ content                       = <<-EOT
            "applications":
            - "args":
                "deployment_options":
          -       "autoscaling_config":
          -         "max_replicas": 32
          -         "min_replicas": 32
          -         "target_ongoing_requests": 16
                  "max_ongoing_requests": 256
          -       "max_replicas_per_node": null
          -       "name": "llm_inference_app"
          -       "num_replicas": "auto"
          +       "max_replicas_per_node": 16
          +       "name": "llm-server-router"
          +       "num_replicas": 32
                  "ray_actor_options":
                    "accelerator_type": "H100"
                    "num_cpus": 1
                "llm_server_configs":
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
                    "name": "sbint-instruct-2025-11-25:70b-sft"
          -         "num_replicas": "auto"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "accelerator_type:H100": 0.001
          +         "placement_group_strategy": "PACK"
                    "ray_actor_options":
                      "accelerator_type": "H100"
          -           "num_cpus": 4
          -           "num_gpus": 0
          +           "num_cpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
                    "distributed_executor_backend": "ray"
                    "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-11-25/sbint-2025-11-25-70b-sft/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
                    - "sbint-instruct-2025-11-25:70b-sft"
                    - "sarashina2-mini"
                    - "sarashina-mini"
                    "tensor_parallel_size": 4
                  "server_kwargs":
                    "enable_auto_tool_choice": true
                    "tool_call_parser": "sarashina2_json"
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
          -         "name": "sbint-instruct-2025-08-25:70b-sft"
          -         "num_replicas": "auto"
          +         "name": "sbint-translation-2025-10-20:7b-dpo"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
                      "accelerator_type": "H100"
          -           "num_cpus": 4
          -           "num_gpus": 0
          +           "num_cpus": 1
          +           "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          -         "distributed_executor_backend": "ray"
          -         "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-08-25/sbint-2025-08-25-70b-sft/"
          +         "gpu_memory_utilization": 0.9
          +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
          -         - "sbint-instruct-2025-08-25:70b-sft"
          -         "tensor_parallel_size": 4
          -       "server_kwargs":
          -         "enable_auto_tool_choice": true
          -         "tool_call_parser": "sarashina2_json"
          +         - "sbint-translation-2025-10-20:7b-dpo"
          +       "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
          -         "name": "sbint-translation-2025-10-20:7b-dpo"
          -         "num_replicas": "auto"
          +         "name": "sbint-translation-2025-12-22:7b-dpo"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 16
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          -         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
          +         "gpu_memory_utilization": 0.9
          +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-12-22/sbint-translation-2025-12-22-dpo/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
          -         - "sbint-translation-2025-10-20:7b-dpo"
          +         - "sbint-translation-2025-12-22:7b-dpo"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
                    "name": "sarashinaguard-7b-20250508"
          -         "num_replicas": "auto"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 16
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          +         "gpu_memory_utilization": 0.9
                    "model": "/lustre/share/sbint_models/guardrail/sarashinaguard-7b-20250508/"
                    "served_model_name":
                    - "sarashinaguard-7b-20250508"
                    - "sarashinaguard-v2.0.1"
                    - "sarashina2-guard"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 4
          -           "min_replicas": 4
          -           "target_ongoing_requests": 16
                    "max_ongoing_requests": 512
                    "name": "sarashina-embedding-v2-1b"
          -         "num_replicas": "auto"
          +         "num_replicas": 4
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 0.25
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 4
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 0.25
                  "engine": "vllm"
                  "engine_kwargs":
                    "gpu_memory_utilization": 0.225
                    "model": "/lustre/teams/text_embeddings/experiments/model_merge/sarashina2.2-1B/test_merge_PROTO_sarashina2.2-1B__multistage_20250610_stg1_v1__stg2_base1_gecko_all_forbes_cl_classsification_base2_gecko_ruri-v3-ft_jsnli_nq_nu-mnli_mr-tydi/"
                    "served_model_name":
                    - "sarashina-embedding-v2-1b"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 4
          -           "min_replicas": 4
          -           "target_ongoing_requests": 16
                    "max_ongoing_requests": 512
                    "name": "sarashina2.2-0.5b-reranker-toy-0523"
          -         "num_replicas": "auto"
          +         "num_replicas": 4
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 0.25
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 4
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 0.25
                  "engine": "vllm"
                  "engine_kwargs":
                    "gpu_memory_utilization": 0.225
                    "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
                    "served_model_name":
                    - "sarashina2.2-0.5b-reranker-toy-0523"
                  "server_kwargs": {}
              "import_path": "llm_serve.app.builder:build_openai_app"
              "name": "llm-inference-app"
              "route_prefix": "/"
              "runtime_env":
                "env_vars":
                  "RAY_LOG_TO_DRIVER": "1"
                  "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
                  "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
                  "VLLM_NO_USAGE_STATS": "1"
            "http_options":
              "host": "0.0.0.0"
              "keep_alive_timeout_s": 200
              "port": 8008
              "request_timeout_s": null
            "logging_config":
              "enable_access_log": true
              "encoding": "JSON"
              "log_level": "INFO"
              "logs_dir": null
            "proxy_location": "EveryNode"
        EOT
      ~ etag                          = "cfdf39f79317abb7e963a21f33970af3" -> "a59232ecd5990f5fa24c70f1dcf560e6"
        id                            = "sbkk/ray-serve-config-sbkk-01/latest.yaml"
        tags                          = {}
      ~ version_id                    = "_qMBExTboJt3gRXx5O0.H_i9PqHelydo" -> (known after apply)
        # (23 unchanged attributes hidden)
    }

  # aws_s3_object.serve_config["sbkk-02"] will be updated in-place
  ~ resource "aws_s3_object" "serve_config" {
      ~ content                       = <<-EOT
            "applications":
            - "args":
                "deployment_options":
          -       "autoscaling_config":
          -         "max_replicas": 32
          -         "min_replicas": 32
          -         "target_ongoing_requests": 16
                  "max_ongoing_requests": 256
          -       "max_replicas_per_node": null
          -       "name": "llm_inference_app"
          -       "num_replicas": "auto"
          +       "max_replicas_per_node": 16
          +       "name": "llm-server-router"
          +       "num_replicas": 32
                  "ray_actor_options":
                    "accelerator_type": "H100"
                    "num_cpus": 1
                "llm_server_configs":
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
                    "name": "sbint-instruct-2025-11-25:70b-sft"
          -         "num_replicas": "auto"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "GPU": 1
          +         - "CPU": 1
          +           "accelerator_type:H100": 0.001
          +         "placement_group_strategy": "PACK"
                    "ray_actor_options":
                      "accelerator_type": "H100"
          -           "num_cpus": 4
          -           "num_gpus": 0
          +           "num_cpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
                    "distributed_executor_backend": "ray"
                    "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-11-25/sbint-2025-11-25-70b-sft/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
                    - "sbint-instruct-2025-11-25:70b-sft"
                    - "sarashina2-mini"
                    - "sarashina-mini"
                    "tensor_parallel_size": 4
                  "server_kwargs":
                    "enable_auto_tool_choice": true
                    "tool_call_parser": "sarashina2_json"
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
          -         "name": "sbint-instruct-2025-08-25:70b-sft"
          -         "num_replicas": "auto"
          +         "name": "sbint-translation-2025-10-20:7b-dpo"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
                      "accelerator_type": "H100"
          -           "num_cpus": 4
          -           "num_gpus": 0
          +           "num_cpus": 1
          +           "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          -         "distributed_executor_backend": "ray"
          -         "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-08-25/sbint-2025-08-25-70b-sft/"
          +         "gpu_memory_utilization": 0.9
          +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
          -         - "sbint-instruct-2025-08-25:70b-sft"
          -         "tensor_parallel_size": 4
          -       "server_kwargs":
          -         "enable_auto_tool_choice": true
          -         "tool_call_parser": "sarashina2_json"
          +         - "sbint-translation-2025-10-20:7b-dpo"
          +       "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
          -         "name": "sbint-translation-2025-10-20:7b-dpo"
          -         "num_replicas": "auto"
          +         "name": "sbint-translation-2025-12-22:7b-dpo"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 16
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          -         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
          +         "gpu_memory_utilization": 0.9
          +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-12-22/sbint-translation-2025-12-22-dpo/"
                    "override_generation_config":
                      "repetition_penalty": 1.05
                      "temperature": 0.7
                      "top_p": 0.9
                    "served_model_name":
          -         - "sbint-translation-2025-10-20:7b-dpo"
          +         - "sbint-translation-2025-12-22:7b-dpo"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 2
          -           "min_replicas": 2
          -           "target_ongoing_requests": 2
                    "max_ongoing_requests": 512
                    "name": "sarashinaguard-7b-20250508"
          -         "num_replicas": "auto"
          +         "num_replicas": 2
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 1
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 16
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 1
                  "engine": "vllm"
                  "engine_kwargs":
          +         "gpu_memory_utilization": 0.9
                    "model": "/lustre/share/sbint_models/guardrail/sarashinaguard-7b-20250508/"
                    "served_model_name":
                    - "sarashinaguard-7b-20250508"
                    - "sarashinaguard-v2.0.1"
                    - "sarashina2-guard"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 4
          -           "min_replicas": 4
          -           "target_ongoing_requests": 16
                    "max_ongoing_requests": 512
                    "name": "sarashina-embedding-v2-1b"
          -         "num_replicas": "auto"
          +         "num_replicas": 4
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 0.25
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 4
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 0.25
                  "engine": "vllm"
                  "engine_kwargs":
                    "gpu_memory_utilization": 0.225
                    "model": "/lustre/teams/text_embeddings/experiments/model_merge/sarashina2.2-1B/test_merge_PROTO_sarashina2.2-1B__multistage_20250610_stg1_v1__stg2_base1_gecko_all_forbes_cl_classsification_base2_gecko_ruri-v3-ft_jsnli_nq_nu-mnli_mr-tydi/"
                    "served_model_name":
                    - "sarashina-embedding-v2-1b"
                  "server_kwargs": {}
                - "deployment_options":
          -         "autoscaling_config":
          -           "max_replicas": 4
          -           "min_replicas": 4
          -           "target_ongoing_requests": 16
                    "max_ongoing_requests": 512
                    "name": "sarashina2.2-0.5b-reranker-toy-0523"
          -         "num_replicas": "auto"
          +         "num_replicas": 4
          +         "placement_group_bundles":
          +         - "CPU": 1
          +           "GPU": 0.25
          +           "accelerator_type:H100": 0.001
                    "ray_actor_options":
          -           "num_cpus": 4
          +           "accelerator_type": "H100"
          +           "num_cpus": 1
                      "num_gpus": 0.25
                  "engine": "vllm"
                  "engine_kwargs":
                    "gpu_memory_utilization": 0.225
                    "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
                    "served_model_name":
                    - "sarashina2.2-0.5b-reranker-toy-0523"
                  "server_kwargs": {}
              "import_path": "llm_serve.app.builder:build_openai_app"
              "name": "llm-inference-app"
              "route_prefix": "/"
              "runtime_env":
                "env_vars":
                  "RAY_LOG_TO_DRIVER": "1"
                  "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
                  "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
                  "VLLM_NO_USAGE_STATS": "1"
            "http_options":
              "host": "0.0.0.0"
              "keep_alive_timeout_s": 200
              "port": 8008
              "request_timeout_s": null
            "logging_config":
              "enable_access_log": true
              "encoding": "JSON"
              "log_level": "INFO"
              "logs_dir": null
            "proxy_location": "EveryNode"
        EOT
      ~ etag                          = "cfdf39f79317abb7e963a21f33970af3" -> "a59232ecd5990f5fa24c70f1dcf560e6"
        id                            = "sbkk/ray-serve-config-sbkk-02/latest.yaml"
        tags                          = {}
      ~ version_id                    = "YGAzzVOn4GVQr892.gw187jQeX64xFMg" -> (known after apply)
        # (23 unchanged attributes hidden)
    }

Plan: 0 to add, 2 to change, 4 to destroy.

Changes to Outputs:
  ~ s3_object_serve_config = {
      ~ sbkk-01 = {
          ~ content                       = <<-EOT
                "applications":
                - "args":
                    "deployment_options":
              -       "autoscaling_config":
              -         "max_replicas": 32
              -         "min_replicas": 32
              -         "target_ongoing_requests": 16
                      "max_ongoing_requests": 256
              -       "max_replicas_per_node": null
              -       "name": "llm_inference_app"
              -       "num_replicas": "auto"
              +       "max_replicas_per_node": 16
              +       "name": "llm-server-router"
              +       "num_replicas": 32
                      "ray_actor_options":
                        "accelerator_type": "H100"
                        "num_cpus": 1
                    "llm_server_configs":
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
                        "name": "sbint-instruct-2025-11-25:70b-sft"
              -         "num_replicas": "auto"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "accelerator_type:H100": 0.001
              +         "placement_group_strategy": "PACK"
                        "ray_actor_options":
                          "accelerator_type": "H100"
              -           "num_cpus": 4
              -           "num_gpus": 0
              +           "num_cpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
                        "distributed_executor_backend": "ray"
                        "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-11-25/sbint-2025-11-25-70b-sft/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
                        - "sbint-instruct-2025-11-25:70b-sft"
                        - "sarashina2-mini"
                        - "sarashina-mini"
                        "tensor_parallel_size": 4
                      "server_kwargs":
                        "enable_auto_tool_choice": true
                        "tool_call_parser": "sarashina2_json"
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
              -         "name": "sbint-instruct-2025-08-25:70b-sft"
              -         "num_replicas": "auto"
              +         "name": "sbint-translation-2025-10-20:7b-dpo"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
                          "accelerator_type": "H100"
              -           "num_cpus": 4
              -           "num_gpus": 0
              +           "num_cpus": 1
              +           "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              -         "distributed_executor_backend": "ray"
              -         "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-08-25/sbint-2025-08-25-70b-sft/"
              +         "gpu_memory_utilization": 0.9
              +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
              -         - "sbint-instruct-2025-08-25:70b-sft"
              -         "tensor_parallel_size": 4
              -       "server_kwargs":
              -         "enable_auto_tool_choice": true
              -         "tool_call_parser": "sarashina2_json"
              +         - "sbint-translation-2025-10-20:7b-dpo"
              +       "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
              -         "name": "sbint-translation-2025-10-20:7b-dpo"
              -         "num_replicas": "auto"
              +         "name": "sbint-translation-2025-12-22:7b-dpo"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 16
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              -         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
              +         "gpu_memory_utilization": 0.9
              +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-12-22/sbint-translation-2025-12-22-dpo/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
              -         - "sbint-translation-2025-10-20:7b-dpo"
              +         - "sbint-translation-2025-12-22:7b-dpo"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
                        "name": "sarashinaguard-7b-20250508"
              -         "num_replicas": "auto"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 16
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              +         "gpu_memory_utilization": 0.9
                        "model": "/lustre/share/sbint_models/guardrail/sarashinaguard-7b-20250508/"
                        "served_model_name":
                        - "sarashinaguard-7b-20250508"
                        - "sarashinaguard-v2.0.1"
                        - "sarashina2-guard"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 4
              -           "min_replicas": 4
              -           "target_ongoing_requests": 16
                        "max_ongoing_requests": 512
                        "name": "sarashina-embedding-v2-1b"
              -         "num_replicas": "auto"
              +         "num_replicas": 4
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 0.25
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 4
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 0.25
                      "engine": "vllm"
                      "engine_kwargs":
                        "gpu_memory_utilization": 0.225
                        "model": "/lustre/teams/text_embeddings/experiments/model_merge/sarashina2.2-1B/test_merge_PROTO_sarashina2.2-1B__multistage_20250610_stg1_v1__stg2_base1_gecko_all_forbes_cl_classsification_base2_gecko_ruri-v3-ft_jsnli_nq_nu-mnli_mr-tydi/"
                        "served_model_name":
                        - "sarashina-embedding-v2-1b"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 4
              -           "min_replicas": 4
              -           "target_ongoing_requests": 16
                        "max_ongoing_requests": 512
                        "name": "sarashina2.2-0.5b-reranker-toy-0523"
              -         "num_replicas": "auto"
              +         "num_replicas": 4
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 0.25
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 4
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 0.25
                      "engine": "vllm"
                      "engine_kwargs":
                        "gpu_memory_utilization": 0.225
                        "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
                        "served_model_name":
                        - "sarashina2.2-0.5b-reranker-toy-0523"
                      "server_kwargs": {}
                  "import_path": "llm_serve.app.builder:build_openai_app"
                  "name": "llm-inference-app"
                  "route_prefix": "/"
                  "runtime_env":
                    "env_vars":
                      "RAY_LOG_TO_DRIVER": "1"
                      "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
                      "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
                      "VLLM_NO_USAGE_STATS": "1"
                "http_options":
                  "host": "0.0.0.0"
                  "keep_alive_timeout_s": 200
                  "port": 8008
                  "request_timeout_s": null
                "logging_config":
                  "enable_access_log": true
                  "encoding": "JSON"
                  "log_level": "INFO"
                  "logs_dir": null
                "proxy_location": "EveryNode"
            EOT
          ~ etag                          = "cfdf39f79317abb7e963a21f33970af3" -> "a59232ecd5990f5fa24c70f1dcf560e6"
            id                            = "sbkk/ray-serve-config-sbkk-01/latest.yaml"
            tags                          = {}
          ~ version_id                    = "_qMBExTboJt3gRXx5O0.H_i9PqHelydo" -> (known after apply)
            # (30 unchanged attributes hidden)
        }
      ~ sbkk-02 = {
          ~ content                       = <<-EOT
                "applications":
                - "args":
                    "deployment_options":
              -       "autoscaling_config":
              -         "max_replicas": 32
              -         "min_replicas": 32
              -         "target_ongoing_requests": 16
                      "max_ongoing_requests": 256
              -       "max_replicas_per_node": null
              -       "name": "llm_inference_app"
              -       "num_replicas": "auto"
              +       "max_replicas_per_node": 16
              +       "name": "llm-server-router"
              +       "num_replicas": 32
                      "ray_actor_options":
                        "accelerator_type": "H100"
                        "num_cpus": 1
                    "llm_server_configs":
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
                        "name": "sbint-instruct-2025-11-25:70b-sft"
              -         "num_replicas": "auto"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "GPU": 1
              +         - "CPU": 1
              +           "accelerator_type:H100": 0.001
              +         "placement_group_strategy": "PACK"
                        "ray_actor_options":
                          "accelerator_type": "H100"
              -           "num_cpus": 4
              -           "num_gpus": 0
              +           "num_cpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
                        "distributed_executor_backend": "ray"
                        "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-11-25/sbint-2025-11-25-70b-sft/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
                        - "sbint-instruct-2025-11-25:70b-sft"
                        - "sarashina2-mini"
                        - "sarashina-mini"
                        "tensor_parallel_size": 4
                      "server_kwargs":
                        "enable_auto_tool_choice": true
                        "tool_call_parser": "sarashina2_json"
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
              -         "name": "sbint-instruct-2025-08-25:70b-sft"
              -         "num_replicas": "auto"
              +         "name": "sbint-translation-2025-10-20:7b-dpo"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
                          "accelerator_type": "H100"
              -           "num_cpus": 4
              -           "num_gpus": 0
              +           "num_cpus": 1
              +           "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              -         "distributed_executor_backend": "ray"
              -         "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-08-25/sbint-2025-08-25-70b-sft/"
              +         "gpu_memory_utilization": 0.9
              +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
              -         - "sbint-instruct-2025-08-25:70b-sft"
              -         "tensor_parallel_size": 4
              -       "server_kwargs":
              -         "enable_auto_tool_choice": true
              -         "tool_call_parser": "sarashina2_json"
              +         - "sbint-translation-2025-10-20:7b-dpo"
              +       "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
              -         "name": "sbint-translation-2025-10-20:7b-dpo"
              -         "num_replicas": "auto"
              +         "name": "sbint-translation-2025-12-22:7b-dpo"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 16
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              -         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
              +         "gpu_memory_utilization": 0.9
              +         "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-12-22/sbint-translation-2025-12-22-dpo/"
                        "override_generation_config":
                          "repetition_penalty": 1.05
                          "temperature": 0.7
                          "top_p": 0.9
                        "served_model_name":
              -         - "sbint-translation-2025-10-20:7b-dpo"
              +         - "sbint-translation-2025-12-22:7b-dpo"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 2
              -           "min_replicas": 2
              -           "target_ongoing_requests": 2
                        "max_ongoing_requests": 512
                        "name": "sarashinaguard-7b-20250508"
              -         "num_replicas": "auto"
              +         "num_replicas": 2
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 1
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 16
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 1
                      "engine": "vllm"
                      "engine_kwargs":
              +         "gpu_memory_utilization": 0.9
                        "model": "/lustre/share/sbint_models/guardrail/sarashinaguard-7b-20250508/"
                        "served_model_name":
                        - "sarashinaguard-7b-20250508"
                        - "sarashinaguard-v2.0.1"
                        - "sarashina2-guard"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 4
              -           "min_replicas": 4
              -           "target_ongoing_requests": 16
                        "max_ongoing_requests": 512
                        "name": "sarashina-embedding-v2-1b"
              -         "num_replicas": "auto"
              +         "num_replicas": 4
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 0.25
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 4
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 0.25
                      "engine": "vllm"
                      "engine_kwargs":
                        "gpu_memory_utilization": 0.225
                        "model": "/lustre/teams/text_embeddings/experiments/model_merge/sarashina2.2-1B/test_merge_PROTO_sarashina2.2-1B__multistage_20250610_stg1_v1__stg2_base1_gecko_all_forbes_cl_classsification_base2_gecko_ruri-v3-ft_jsnli_nq_nu-mnli_mr-tydi/"
                        "served_model_name":
                        - "sarashina-embedding-v2-1b"
                      "server_kwargs": {}
                    - "deployment_options":
              -         "autoscaling_config":
              -           "max_replicas": 4
              -           "min_replicas": 4
              -           "target_ongoing_requests": 16
                        "max_ongoing_requests": 512
                        "name": "sarashina2.2-0.5b-reranker-toy-0523"
              -         "num_replicas": "auto"
              +         "num_replicas": 4
              +         "placement_group_bundles":
              +         - "CPU": 1
              +           "GPU": 0.25
              +           "accelerator_type:H100": 0.001
                        "ray_actor_options":
              -           "num_cpus": 4
              +           "accelerator_type": "H100"
              +           "num_cpus": 1
                          "num_gpus": 0.25
                      "engine": "vllm"
                      "engine_kwargs":
                        "gpu_memory_utilization": 0.225
                        "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
                        "served_model_name":
                        - "sarashina2.2-0.5b-reranker-toy-0523"
                      "server_kwargs": {}
                  "import_path": "llm_serve.app.builder:build_openai_app"
                  "name": "llm-inference-app"
                  "route_prefix": "/"
                  "runtime_env":
                    "env_vars":
                      "RAY_LOG_TO_DRIVER": "1"
                      "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
                      "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
                      "VLLM_NO_USAGE_STATS": "1"
                "http_options":
                  "host": "0.0.0.0"
                  "keep_alive_timeout_s": 200
                  "port": 8008
                  "request_timeout_s": null
                "logging_config":
                  "enable_access_log": true
                  "encoding": "JSON"
                  "log_level": "INFO"
                  "logs_dir": null
                "proxy_location": "EveryNode"
            EOT
          ~ etag                          = "cfdf39f79317abb7e963a21f33970af3" -> "a59232ecd5990f5fa24c70f1dcf560e6"
            id                            = "sbkk/ray-serve-config-sbkk-02/latest.yaml"
            tags                          = {}
          ~ version_id                    = "YGAzzVOn4GVQr892.gw187jQeX64xFMg" -> (known after apply)
            # (30 unchanged attributes hidden)
        }
    }



Note: You didn't use the -out option to save this plan, so Terraform can't
guarantee to take exactly these actions if you run "terraform apply" now.
