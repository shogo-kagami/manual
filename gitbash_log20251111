prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ aws configure sso
SSO session name (Recommended): prod
Attempting to automatically open the SSO authorization page in your default browser.
If the browser does not open or you wish to use a different device to authorize this request, open the following URL:

https://oidc.ap-northeast-1.amazonaws.com/authorize?response_type=code&client_id=QjmBw_97_POQ0UZv3sH6hWFwLW5vcnRoZWFzdC0x&redirect_uri=http%3A%2F%2F127.0.0.1%3A50293%2Foauth%2Fcallback&state=6c0fe1a4-0fdb-4913-827c-6974eaeacb12&code_challenge_method=S256&scopes=sso%3Aaccount%3Aaccess&code_challenge=2Jt6JMuN1k4QErCvqmAYTZzeqqBXsx4eE2ApSF5h2gg
There are 2 AWS accounts available to you.
Using the account ID 050451382758
The only role available to you is: AWSAdministratorAccess
Using the role name "AWSAdministratorAccess"
Default client Region [None]:
CLI default output format (json if not specified) [None]:
Profile name [AWSAdministratorAccess-050451382758]:
To use this profile, specify the profile name using --profile, as shown:

aws sts get-caller-identity --profile AWSAdministratorAccess-050451382758

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ pwd
/c/Users/prod.shogo.kagami

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd ~

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ pwd
/c/Users/prod.shogo.kagami

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ mkdir deploy_20251111

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd deploy_20251111

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111 (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251111

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111 (main)
$ git clone https://github.com/sbintuitions/reimei_RAG
Cloning into 'reimei_RAG'...
remote: Enumerating objects: 21741, done.
remote: Counting objects: 100% (87/87), done.
remote: Compressing objects: 100% (56/56), done.
remote: Total 21741 (delta 48), reused 43 (delta 31), pack-reused 21654 (from 2)
Receiving objects: 100% (21741/21741), 58.91 MiB | 20.47 MiB/s, done.
Resolving deltas: 100% (13671/13671), done.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111 (main)
$ cd reimei_RAG/terraform/environments_ray/prod

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (main)
$ git fetch origin main
From https://github.com/sbintuitions/reimei_RAG
 * branch              main       -> FETCH_HEAD

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (main)
$ git diff origin/main

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (main)
$ git checkout ray/update-enviroments_ray-prod-terraform
branch 'ray/update-enviroments_ray-prod-terraform' set up to track 'origin/ray/update-enviroments_ray-prod-terraform'.
Switched to a new branch 'ray/update-enviroments_ray-prod-terraform'

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$ git branch
  main
* ray/update-enviroments_ray-prod-terraform

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$ terraform init
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing provider plugins...
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/cloudinit from the dependency lock file
- Reusing previous version of hashicorp/archive from the dependency lock file
- Installing hashicorp/aws v5.93.0...
- Installed hashicorp/aws v5.93.0 (signed by HashiCorp)
- Installing hashicorp/cloudinit v2.3.7...
- Installed hashicorp/cloudinit v2.3.7 (signed by HashiCorp)
- Installing hashicorp/archive v2.7.1...
- Installed hashicorp/archive v2.7.1 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$ terraform plan
data.archive_file.lambda_function: Reading...
data.archive_file.lambda_function: Read complete after 0s [id=f3ff445fba411205c5521ab81e0db14eea2aa737]
aws_iam_role.lambda_exec: Refreshing state... [id=GetJsonForMultiTenant-role20251107015217559700000004]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_security_group.nlb_gpu_backend_connector: Reading...
data.aws_security_group.reimei_rag_sg_lb_from_ext: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
aws_s3_bucket.env_config: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-config]
module.ecr_repos["llm-serve-cpu"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-engine-ray-prd/llm-serve-cpu]
module.ecr_repos["llm-serve-cpu-replica"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-engine-ray-prd/llm-serve-cpu]
module.ecr_repos["llm-serve-cpu-replica"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-engine-ray-prd/llm-serve-cpu]
module.ecr_repos["llm-serve-cpu"].aws_ecr_repository.this: Refreshing state... [id=reimei-engine-ray-prd/llm-serve-cpu]
data.aws_security_group.reimei_rag_sg_lb_from_ext: Read complete after 0s [id=sg-0d2018e3f8628f571]
data.aws_security_group.alb_gpu_backend_connector: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
data.aws_security_group.nlb_gpu_backend_connector: Read complete after 0s [id=sg-0c397970a1630eb41]
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Reading...
aws_lb_target_group.alb_gpu_backend_connector["85"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/gpucon20251107015217559500000003/a261a429d80c4e66]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
data.aws_vpc.reimei_rag_main_vpc: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
aws_iam_policy.management_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/rManagementS3Policy_20251107015217558100000001]
data.aws_security_group.alb_gpu_backend_connector: Read complete after 0s [id=sg-0880b2dad9975ee2d]
aws_s3_bucket_versioning.env_config: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-config]
aws_s3_object.env_config["srdgx00001"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00001.json]
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Read complete after 0s [id=subnet-0a1d36335207cb4f4]
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Read complete after 0s [id=subnet-07eaa5c2b02e5b427]
aws_s3_object.env_config["srdgx00004"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00004.json]
aws_s3_object.env_config["srdgx00002"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00002.json]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
aws_s3_object.env_config["srdgx00007"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00007.json]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
aws_s3_object.env_config["srdgx00006"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00006.json]
aws_s3_object.env_config["srdgx00005"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00005.json]
aws_s3_object.env_config["srdgx00008"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00008.json]
aws_s3_object.env_config["srdgx00003"]: Refreshing state... [id=ray-multi-tenant-config/srdgx00003.json]
aws_lb.nlb_gpu_backend_connector: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-engine-ray-prd-nlbmon01/9aa01b320393bbe7]
aws_lb.nlb_for_ext: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157]
aws_lb.alb_gpu_backend_connector: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-engine-ray-prd-albmon01/fbcccdb09afc17c8]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
aws_lb_target_group.nlb_gpu_backend_connector["10085"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/gpucon20251107015217559500000002/6adad5238d252cf3]
aws_lb_listener.alb_gpu_backend_connector["85"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-albmon01/fbcccdb09afc17c8/0a490cf50204dbe0]
aws_lb_target_group_attachment.nlb_gpu_backend_connector["10085"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/gpucon20251107015217559500000002/6adad5238d252cf3-20251107015617140900000001]
aws_lb_listener.nlb_gpu_backend_connector["10085"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-engine-ray-prd-nlbmon01/9aa01b320393bbe7/147cb8474c879580]
aws_iam_role_policy_attachment.lambda_exec_basic: Refreshing state... [id=GetJsonForMultiTenant-role20251107015217559700000004-20251107015219051700000005]
aws_iam_role_policy_attachment.lamdba_s3: Refreshing state... [id=GetJsonForMultiTenant-role20251107015217559700000004-20251107015219056100000006]
aws_lambda_function.lambda_function: Refreshing state... [id=GetJsonForMultiTenant_prd]
aws_lambda_permission.alb_gpu_backend_connector["85"]: Refreshing state... [id=AllowExecutionFromALB]
aws_lb_target_group_attachment.alb_gpu_backend_connector["85"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/gpucon20251107015217559500000003/a261a429d80c4e66-20251107015233174000000007]

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # module.ecr_repos["llm-serve-cpu"].aws_ecr_lifecycle_policy.this will be destroyed
  # (because aws_ecr_lifecycle_policy.this is not in configuration)
  - resource "aws_ecr_lifecycle_policy" "this" {
      - id          = "reimei-engine-ray-prd/llm-serve-cpu" -> null
      - policy      = jsonencode(
            {
              - rules = [
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Keep the image tagged with edge"
                      - rulePriority = 1
                      - selection    = {
                          - countNumber    = 10
                          - countType      = "imageCountMoreThan"
                          - tagPatternList = [
                              - "20*-*",
                            ]
                          - tagStatus      = "tagged"
                        }
                    },
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Expire images older than 30 days"
                      - rulePriority = 2
                      - selection    = {
                          - countNumber    = 30
                          - countType      = "sinceImagePushed"
                          - countUnit      = "days"
                          - tagPatternList = [
                              - "*",
                            ]
                          - tagStatus      = "tagged"
                        }
                    },
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Keep last 5 images, delete older"
                      - rulePriority = 3
                      - selection    = {
                          - countNumber = 5
                          - countType   = "imageCountMoreThan"
                          - tagStatus   = "any"
                        }
                    },
                ]
            }
        ) -> null
      - registry_id = "050451382758" -> null
      - repository  = "reimei-engine-ray-prd/llm-serve-cpu" -> null
    }

  # module.ecr_repos["llm-serve-cpu"].aws_ecr_repository.this will be destroyed
  # (because aws_ecr_repository.this is not in configuration)
  - resource "aws_ecr_repository" "this" {
      - arn                  = "arn:aws:ecr:ap-northeast-1:050451382758:repository/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - id                   = "reimei-engine-ray-prd/llm-serve-cpu" -> null
      - image_tag_mutability = "MUTABLE" -> null
      - name                 = "reimei-engine-ray-prd/llm-serve-cpu" -> null
      - registry_id          = "050451382758" -> null
      - repository_url       = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - tags                 = {} -> null
      - tags_all             = {
          - "Env"       = "prd"
          - "Project"   = "reimei-engine-ray"
          - "Terraform" = "true"
        } -> null

      - encryption_configuration {
          - encryption_type = "AES256" -> null
            # (1 unchanged attribute hidden)
        }

      - image_scanning_configuration {
          - scan_on_push = false -> null
        }
    }

  # module.ecr_repos["llm-serve-cpu-replica"].aws_ecr_lifecycle_policy.this will be destroyed
  # (because aws_ecr_lifecycle_policy.this is not in configuration)
  - resource "aws_ecr_lifecycle_policy" "this" {
      - id          = "sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - policy      = jsonencode(
            {
              - rules = [
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Keep the image tagged with edge"
                      - rulePriority = 1
                      - selection    = {
                          - countNumber    = 10
                          - countType      = "imageCountMoreThan"
                          - tagPatternList = [
                              - "20*-*",
                            ]
                          - tagStatus      = "tagged"
                        }
                    },
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Expire images older than 30 days"
                      - rulePriority = 2
                      - selection    = {
                          - countNumber    = 30
                          - countType      = "sinceImagePushed"
                          - countUnit      = "days"
                          - tagPatternList = [
                              - "*",
                            ]
                          - tagStatus      = "tagged"
                        }
                    },
                  - {
                      - action       = {
                          - type = "expire"
                        }
                      - description  = "Keep last 5 images, delete older"
                      - rulePriority = 3
                      - selection    = {
                          - countNumber = 5
                          - countType   = "imageCountMoreThan"
                          - tagStatus   = "any"
                        }
                    },
                ]
            }
        ) -> null
      - registry_id = "050451382758" -> null
      - repository  = "sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
    }

  # module.ecr_repos["llm-serve-cpu-replica"].aws_ecr_repository.this will be destroyed
  # (because aws_ecr_repository.this is not in configuration)
  - resource "aws_ecr_repository" "this" {
      - arn                  = "arn:aws:ecr:ap-northeast-1:050451382758:repository/sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - id                   = "sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - image_tag_mutability = "MUTABLE" -> null
      - name                 = "sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - registry_id          = "050451382758" -> null
      - repository_url       = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-engine-ray-prd/llm-serve-cpu" -> null
      - tags                 = {} -> null
      - tags_all             = {
          - "Env"       = "prd"
          - "Project"   = "reimei-engine-ray"
          - "Terraform" = "true"
        } -> null

      - encryption_configuration {
          - encryption_type = "AES256" -> null
            # (1 unchanged attribute hidden)
        }

      - image_scanning_configuration {
          - scan_on_push = false -> null
        }
    }

Plan: 0 to add, 0 to change, 4 to destroy.

Changes to Outputs:
  - ecr_repository_url = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/reimei-engine-ray-prd/llm-serve-cpu" -> null

───────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take
exactly these actions if you run "terraform apply" now.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod (ray/update-enviroments_ray-prod-terraform)
$ cd sbkk

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ terraform init
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing modules...
- ec2_instance_ray_head in ..\..\..\modules\ec2-instance
- ray_serve_config in ..\..\..\modules\ray-serve-config
Initializing provider plugins...
- terraform.io/builtin/terraform is built in to Terraform
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/cloudinit from the dependency lock file
- Installing hashicorp/aws v5.93.0...
- Installed hashicorp/aws v5.93.0 (signed by HashiCorp)
- Installing hashicorp/cloudinit v2.3.7...
- Installed hashicorp/cloudinit v2.3.7 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ terraform plan -var-file="../terraform.tfvars"
data.terraform_remote_state.common: Reading...
data.aws_ecr_repository.cpu: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Reading...
data.aws_security_group.reimei_rag_sg_relay_subnet: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Reading...
data.aws_vpc.reimei_rag_main_vpc: Reading...
data.aws_security_group.reimei_rag_sg_relay_subnet: Read complete after 0s [id=sg-081ae7e5679bbb12f]
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Read complete after 0s [id=subnet-0a1d36335207cb4f4]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Read complete after 0s [id=subnet-07eaa5c2b02e5b427]
module.ec2_instance_ray_head["sbkk-01"].data.aws_ssm_parameter.al2023: Reading...
module.ec2_instance_ray_head["sbkk-02"].data.aws_ssm_parameter.al2023: Reading...
module.ec2_instance_ray_head["sbkk-02"].aws_cloudwatch_log_group.ec2_logs: Refreshing state... [id=/ec2/reimei-engine-ray-prd/llm-serve/ec2-instance-sbkk-02]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role.ec2_role: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01]
module.ec2_instance_ray_head["sbkk-01"].aws_cloudwatch_log_group.ec2_logs: Refreshing state... [id=/ec2/reimei-engine-ray-prd/llm-serve/ec2-instance-sbkk-01]
aws_lb.app: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role.ec2_role: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02]
data.aws_ecr_repository.cpu: Read complete after 0s [id=sbint-services/reimei-engine-ray-stg/llm-serve-cpu]
module.ec2_instance_ray_head["sbkk-01"].data.aws_ssm_parameter.al2023: Read complete after 1s [id=/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64]
module.ec2_instance_ray_head["sbkk-02"].data.aws_ssm_parameter.al2023: Read complete after 1s [id=/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
aws_lb_target_group.ray_workers["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc]
aws_lb_target_group.ray_workers["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd]
aws_lb_target_group.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f]
aws_lb_target_group.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428]
aws_lb_listener.http["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/ff41704975310935]
aws_lb_listener.http["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/e58012962ae7b748]
aws_lb_target_group_attachment.ray_workers["10.120.113.16"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-20251107040951758200000007]
aws_lb_target_group_attachment.ray_workers["10.120.113.15"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951747700000006]
aws_lb_target_group_attachment.ray_workers["10.120.113.11"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951762800000008]
aws_lb_target_group_attachment.ray_workers["10.120.113.12"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-2025110704095197500000000c]
aws_lb_target_group_attachment.ray_workers["10.120.113.14"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-20251107040951738300000005]
aws_lb_target_group_attachment.ray_workers["10.120.113.17"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951790900000009]
aws_lb_target_group_attachment.ray_workers["10.120.113.18"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-2025110704095182040000000b]
aws_lb_target_group_attachment.ray_workers["10.120.113.13"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-2025110704095182040000000a]
aws_lb_listener_rule.ray_workers["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/ff41704975310935/cc02ed79a3bcc7c4]
aws_lb_listener_rule.ray_workers["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/e58012962ae7b748/b788be45f9cf5db6]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.cw_agent_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040952905500000012]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.ssm_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-2025110704095245540000000e]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_instance_profile.ec2_profile: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-instance-profile-sbkk-01]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPullOnly"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040953150700000015]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.cw_agent_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040952874500000011]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.ssm_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040952685000000010]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_instance_profile.ec2_profile: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-instance-profile-sbkk-02]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040953162500000016]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPullOnly"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-2025110704095243730000000d]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-2025110704095268500000000f]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040953138900000014]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040952924500000013]

Planning failed. Terraform encountered an error while generating this plan.

╷
│ Error: Unable to access object "terraform.tfstate" in S3 bucket "reimei-engine-ray-prd-tfstate": operation error S3: HeadObject, https response error StatusCode: 403, RequestID: 87JQ8H9ADTMQTV8A, HostID: ek3zHj6C4DA2hhoPRAY+gr98+dZ8jMTYhSuEKRPG72dau56qXXGZUcDA31FGZg5hwKrAkHLpun6EWrM+BNBl9WwTzw8F/f7KEPY4HAMsTcs=, api error Forbidden: Forbidden
│
│
╵

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ aws sts get-caller-identity
{
    "UserId": "AROAQ4J5YKOXHLLZNIN6Q:i-0678347b7d9ad32a0",
    "Account": "060795933614",
    "Arn": "arn:aws:sts::060795933614:assumed-role/AmazonSSMRoleForInstancesQuickSetup/i-0678347b7d9ad32a0"
}


prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ export AWS_PROFILE=AWSAdministratorAccess-050451382758

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ aws sso login
Attempting to automatically open the SSO authorization page in your default browser.
If the browser does not open or you wish to use a different device to authorize this request, open the following URL:

https://oidc.ap-northeast-1.amazonaws.com/authorize?response_type=code&client_id=QjmBw_97_POQ0UZv3sH6hWFwLW5vcnRoZWFzdC0x&redirect_uri=http%3A%2F%2F127.0.0.1%3A51504%2Foauth%2Fcallback&state=48f514b7-1947-4a18-ae78-9d8819ac493d&code_challenge_method=S256&scopes=sso%3Aaccount%3Aaccess&code_challenge=O3U2LnjpsI4VllU58YhVyGzKiiDVzfSALnlpJVQ468c
Successfully logged into Start URL: https://d-95675fea1b.awsapps.com/start/#

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ aws sts get-caller-identity
{
    "UserId": "AROAQXPZDAHTI6GVGVNIB:prod.shogo.kagami@sbintuitions.co.jp",
    "Account": "050451382758",
    "Arn": "arn:aws:sts::050451382758:assumed-role/AWSReservedSSO_AWSAdministratorAccess_ae9aca933fa0ced2/prod.shogo.kagami@sbintuitions.co.jp"
}


prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$ terraform plan -var-file="../terraform.tfvars"
data.terraform_remote_state.common: Reading...
data.aws_vpc.reimei_rag_main_vpc: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Reading...
data.aws_ecr_repository.cpu: Reading...
data.aws_security_group.reimei_rag_sg_relay_subnet: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.terraform_remote_state.common: Read complete after 1s
data.aws_security_group.reimei_rag_sg_relay_subnet: Read complete after 0s [id=sg-081ae7e5679bbb12f]
data.aws_subnet.reimei_rag_vpc_subnet_relay03: Read complete after 0s [id=subnet-0a1d36335207cb4f4]
data.aws_subnet.reimei_rag_vpc_subnet_relay02: Read complete after 0s [id=subnet-07eaa5c2b02e5b427]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
module.ec2_instance_ray_head["sbkk-01"].data.aws_ssm_parameter.al2023: Reading...
module.ec2_instance_ray_head["sbkk-02"].data.aws_ssm_parameter.al2023: Reading...
aws_lb.app: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role.ec2_role: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01]
aws_s3_object.serve_config["sbkk-02"]: Refreshing state... [id=sbkk/ray-serve-config-sbkk-02/latest.yaml]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role.ec2_role: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02]
aws_s3_object.serve_config["sbkk-01"]: Refreshing state... [id=sbkk/ray-serve-config-sbkk-01/latest.yaml]
module.ec2_instance_ray_head["sbkk-02"].aws_cloudwatch_log_group.ec2_logs: Refreshing state... [id=/ec2/reimei-engine-ray-prd/llm-serve/ec2-instance-sbkk-02]
data.aws_ecr_repository.cpu: Read complete after 0s [id=sbint-services/reimei-engine-ray-stg/llm-serve-cpu]
module.ec2_instance_ray_head["sbkk-01"].aws_cloudwatch_log_group.ec2_logs: Refreshing state... [id=/ec2/reimei-engine-ray-prd/llm-serve/ec2-instance-sbkk-01]
module.ec2_instance_ray_head["sbkk-01"].data.aws_ssm_parameter.al2023: Read complete after 0s [id=/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64]
module.ec2_instance_ray_head["sbkk-02"].data.aws_ssm_parameter.al2023: Read complete after 0s [id=/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-default-x86_64]
aws_s3_object.ray_worker_config["sbkk-01"]: Refreshing state... [id=sbkk/ray-worker-config-sbkk-01/latest.json]
aws_s3_object.ray_worker_config["sbkk-02"]: Refreshing state... [id=sbkk/ray-worker-config-sbkk-02/latest.json]
data.cloudinit_config.init["sbkk-01"]: Reading...
data.cloudinit_config.init["sbkk-01"]: Read complete after 0s [id=3440050512]
data.cloudinit_config.init["sbkk-02"]: Reading...
data.cloudinit_config.init["sbkk-02"]: Read complete after 0s [id=935742845]
aws_lb_listener.http["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/e58012962ae7b748]
aws_lb_listener.http["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/ff41704975310935]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 0s [id=vpc-07758e1658c4c2149]
aws_lb_target_group.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428]
aws_lb_target_group.ray_workers["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd]
aws_lb_target_group.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f]
aws_lb_target_group.ray_workers["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc]
aws_lb_listener.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157/747f5b8606ebbe97]
aws_lb_listener.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157/a4c5a80fb6493b1f]
aws_lb_target_group_attachment.ray_workers["10.120.113.13"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-2025110704095182040000000a]
aws_lb_target_group_attachment.ray_workers["10.120.113.18"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-2025110704095182040000000b]
aws_lb_target_group_attachment.ray_workers["10.120.113.11"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951762800000008]
aws_lb_target_group_attachment.ray_workers["10.120.113.17"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951790900000009]
aws_lb_target_group_attachment.ray_workers["10.120.113.16"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-20251107040951758200000007]
aws_lb_target_group_attachment.ray_workers["10.120.113.15"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950752000000003/0d4fda674bc3bdcd-20251107040951747700000006]
aws_lb_target_group_attachment.ray_workers["10.120.113.14"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-20251107040951738300000005]
aws_lb_target_group_attachment.ray_workers["10.120.113.12"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/llmsrv20251107040950753100000004/e3c2c8981ad0c0dc-2025110704095197500000000c]
aws_lb_listener_rule.ray_workers["80"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/e58012962ae7b748/b788be45f9cf5db6]
aws_lb_listener_rule.ray_workers["8000"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-engine-ray-prd-sbkk/75ad91a3e5ed54c0/ff41704975310935/cc02ed79a3bcc7c4]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_instance_profile.ec2_profile: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-instance-profile-sbkk-01]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_instance_profile.ec2_profile: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-instance-profile-sbkk-02]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.cw_agent_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040952905500000012]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.cw_agent_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040952874500000011]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.ssm_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040952685000000010]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.ssm_managed: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-2025110704095245540000000e]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPullOnly"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040953150700000015]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040953162500000016]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-20251107040952924500000013]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-20251107040953138900000014]
module.ec2_instance_ray_head["sbkk-01"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-01-2025110704095268500000000f]
module.ec2_instance_ray_head["sbkk-02"].aws_iam_role_policy_attachment.custom_policies["arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPullOnly"]: Refreshing state... [id=reimei-engine-ray-prd-llm-serve-role-sbkk-02-2025110704095243730000000d]
module.ec2_instance_ray_head["sbkk-01"].aws_instance.this: Refreshing state... [id=i-0788076184947ed20]
module.ec2_instance_ray_head["sbkk-02"].aws_instance.this: Refreshing state... [id=i-04b6260094c7469f1]
aws_lb_target_group_attachment.ray_dashboard["sbkk-02"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428-20251107041014219700000019]
aws_lb_target_group_attachment.ray_dashboard["sbkk-01"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f-2025110704101428600000001a]

Terraform used the selected providers to generate the following execution plan. Resource actions
are indicated with the following symbols:
-/+ destroy and then create replacement

Terraform will perform the following actions:

  # aws_lb_target_group_attachment.ray_dashboard["sbkk-01"] must be replaced
-/+ resource "aws_lb_target_group_attachment" "ray_dashboard" {
      ~ id               = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f-2025110704101428600000001a" -> (known after apply)
      ~ target_id        = "i-0788076184947ed20" -> (known after apply) # forces replacement
        # (2 unchanged attributes hidden)
    }

  # aws_lb_target_group_attachment.ray_dashboard["sbkk-02"] must be replaced
-/+ resource "aws_lb_target_group_attachment" "ray_dashboard" {
      ~ id               = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428-20251107041014219700000019" -> (known after apply)
      ~ target_id        = "i-04b6260094c7469f1" -> (known after apply) # forces replacement
        # (2 unchanged attributes hidden)
    }

  # module.ec2_instance_ray_head["sbkk-01"].aws_instance.this must be replaced
-/+ resource "aws_instance" "this" {
      ~ ami                                  = (sensitive value) # forces replacement
      ~ arn                                  = "arn:aws:ec2:ap-northeast-1:050451382758:instance/i-0788076184947ed20" -> (known after apply)
      ~ associate_public_ip_address          = false -> (known after apply)
      ~ availability_zone                    = "ap-northeast-1a" -> (known after apply)
      ~ cpu_core_count                       = 2 -> (known after apply)
      ~ cpu_threads_per_core                 = 2 -> (known after apply)
      ~ disable_api_stop                     = false -> (known after apply)
      ~ disable_api_termination              = false -> (known after apply)
      ~ ebs_optimized                        = false -> (known after apply)
      + enable_primary_ipv6                  = (known after apply)
      - hibernation                          = false -> null
      + host_id                              = (known after apply)
      + host_resource_group_arn              = (known after apply)
      ~ id                                   = "i-0788076184947ed20" -> (known after apply)
      ~ instance_initiated_shutdown_behavior = "stop" -> (known after apply)
      + instance_lifecycle                   = (known after apply)
      ~ instance_state                       = "running" -> (known after apply)
      ~ ipv6_address_count                   = 0 -> (known after apply)
      ~ ipv6_addresses                       = [] -> (known after apply)
      + key_name                             = (known after apply)
      ~ monitoring                           = false -> (known after apply)
      + outpost_arn                          = (known after apply)
      + password_data                        = (known after apply)
      + placement_group                      = (known after apply)
      ~ placement_partition_number           = 0 -> (known after apply)
      ~ primary_network_interface_id         = "eni-04478db4d950a36b2" -> (known after apply)
      ~ private_dns                          = "ip-10-121-128-123.ap-northeast-1.compute.internal" -> (known after apply)
      + public_dns                           = (known after apply)
      + public_ip                            = (known after apply)
      ~ secondary_private_ips                = [] -> (known after apply)
      ~ security_groups                      = [] -> (known after apply)
      + spot_instance_request_id             = (known after apply)
        tags                                 = {
            "Name" = "reimei-engine-ray-prd-llm-serve-sbkk-01"
        }
      ~ tenancy                              = "default" -> (known after apply)
      + user_data_base64                     = (known after apply)
        # (10 unchanged attributes hidden)

      ~ capacity_reservation_specification (known after apply)
      - capacity_reservation_specification {
          - capacity_reservation_preference = "open" -> null
        }

      ~ cpu_options (known after apply)
      - cpu_options {
          - core_count       = 2 -> null
          - threads_per_core = 2 -> null
            # (1 unchanged attribute hidden)
        }

      ~ ebs_block_device (known after apply)

      ~ enclave_options (known after apply)
      - enclave_options {
          - enabled = false -> null
        }

      ~ ephemeral_block_device (known after apply)

      ~ instance_market_options (known after apply)

      ~ maintenance_options (known after apply)
      - maintenance_options {
          - auto_recovery = "default" -> null
        }

      ~ metadata_options (known after apply)
      - metadata_options {
          - http_endpoint               = "enabled" -> null
          - http_protocol_ipv6          = "disabled" -> null
          - http_put_response_hop_limit = 2 -> null
          - http_tokens                 = "required" -> null
          - instance_metadata_tags      = "disabled" -> null
        }

      ~ network_interface (known after apply)

      ~ private_dns_name_options (known after apply)
      - private_dns_name_options {
          - enable_resource_name_dns_a_record    = false -> null
          - enable_resource_name_dns_aaaa_record = false -> null
          - hostname_type                        = "ip-name" -> null
        }

      ~ root_block_device {
          ~ device_name           = "/dev/xvda" -> (known after apply)
          ~ encrypted             = false -> (known after apply)
          ~ iops                  = 3000 -> (known after apply)
          + kms_key_id            = (known after apply)
          - tags                  = {} -> null
          ~ tags_all              = {
              - "Env"       = "prd"
              - "Project"   = "reimei-engine-ray"
              - "Terraform" = "true"
            } -> (known after apply)
          ~ throughput            = 125 -> (known after apply)
          ~ volume_id             = "vol-027af8232d5313af0" -> (known after apply)
            # (3 unchanged attributes hidden)
        }
    }

  # module.ec2_instance_ray_head["sbkk-02"].aws_instance.this must be replaced
-/+ resource "aws_instance" "this" {
      ~ ami                                  = (sensitive value) # forces replacement
      ~ arn                                  = "arn:aws:ec2:ap-northeast-1:050451382758:instance/i-04b6260094c7469f1" -> (known after apply)
      ~ associate_public_ip_address          = false -> (known after apply)
      ~ availability_zone                    = "ap-northeast-1c" -> (known after apply)
      ~ cpu_core_count                       = 2 -> (known after apply)
      ~ cpu_threads_per_core                 = 2 -> (known after apply)
      ~ disable_api_stop                     = false -> (known after apply)
      ~ disable_api_termination              = false -> (known after apply)
      ~ ebs_optimized                        = false -> (known after apply)
      + enable_primary_ipv6                  = (known after apply)
      - hibernation                          = false -> null
      + host_id                              = (known after apply)
      + host_resource_group_arn              = (known after apply)
      ~ id                                   = "i-04b6260094c7469f1" -> (known after apply)
      ~ instance_initiated_shutdown_behavior = "stop" -> (known after apply)
      + instance_lifecycle                   = (known after apply)
      ~ instance_state                       = "running" -> (known after apply)
      ~ ipv6_address_count                   = 0 -> (known after apply)
      ~ ipv6_addresses                       = [] -> (known after apply)
      + key_name                             = (known after apply)
      ~ monitoring                           = false -> (known after apply)
      + outpost_arn                          = (known after apply)
      + password_data                        = (known after apply)
      + placement_group                      = (known after apply)
      ~ placement_partition_number           = 0 -> (known after apply)
      ~ primary_network_interface_id         = "eni-0cb0f9a7074420020" -> (known after apply)
      ~ private_dns                          = "ip-10-121-132-113.ap-northeast-1.compute.internal" -> (known after apply)
      + public_dns                           = (known after apply)
      + public_ip                            = (known after apply)
      ~ secondary_private_ips                = [] -> (known after apply)
      ~ security_groups                      = [] -> (known after apply)
      + spot_instance_request_id             = (known after apply)
        tags                                 = {
            "Name" = "reimei-engine-ray-prd-llm-serve-sbkk-02"
        }
      ~ tenancy                              = "default" -> (known after apply)
      + user_data_base64                     = (known after apply)
        # (10 unchanged attributes hidden)

      ~ capacity_reservation_specification (known after apply)
      - capacity_reservation_specification {
          - capacity_reservation_preference = "open" -> null
        }

      ~ cpu_options (known after apply)
      - cpu_options {
          - core_count       = 2 -> null
          - threads_per_core = 2 -> null
            # (1 unchanged attribute hidden)
        }

      ~ ebs_block_device (known after apply)

      ~ enclave_options (known after apply)
      - enclave_options {
          - enabled = false -> null
        }

      ~ ephemeral_block_device (known after apply)

      ~ instance_market_options (known after apply)

      ~ maintenance_options (known after apply)
      - maintenance_options {
          - auto_recovery = "default" -> null
        }

      ~ metadata_options (known after apply)
      - metadata_options {
          - http_endpoint               = "enabled" -> null
          - http_protocol_ipv6          = "disabled" -> null
          - http_put_response_hop_limit = 2 -> null
          - http_tokens                 = "required" -> null
          - instance_metadata_tags      = "disabled" -> null
        }

      ~ network_interface (known after apply)

      ~ private_dns_name_options (known after apply)
      - private_dns_name_options {
          - enable_resource_name_dns_a_record    = false -> null
          - enable_resource_name_dns_aaaa_record = false -> null
          - hostname_type                        = "ip-name" -> null
        }

      ~ root_block_device {
          ~ device_name           = "/dev/xvda" -> (known after apply)
          ~ encrypted             = false -> (known after apply)
          ~ iops                  = 3000 -> (known after apply)
          + kms_key_id            = (known after apply)
          - tags                  = {} -> null
          ~ tags_all              = {
              - "Env"       = "prd"
              - "Project"   = "reimei-engine-ray"
              - "Terraform" = "true"
            } -> (known after apply)
          ~ throughput            = 125 -> (known after apply)
          ~ volume_id             = "vol-0b19802dcb6893d17" -> (known after apply)
            # (3 unchanged attributes hidden)
        }
    }

Plan: 4 to add, 0 to change, 4 to destroy.

───────────────────────────────────────────────────────────────────────────────────────────────────

Note: You didn't use the -out option to save this plan, so Terraform can't guarantee to take
exactly these actions if you run "terraform apply" now.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251111/reimei_RAG/terraform/environments_ray/prod/sbkk (ray/update-enviroments_ray-prod-terraform)
$
