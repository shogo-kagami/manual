            "served_model_name":
            - "sarashina-embedding-v2-1b"
          "server_kwargs": {}
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sarashina2.2-0.5b-reranker-toy-0523"
            "num_replicas": 4
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 0.25
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 0.25
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.225
            "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
            "served_model_name":
            - "sarashina2.2-0.5b-reranker-toy-0523"
          "server_kwargs": {}
      "import_path": "llm_serve.app.builder:build_openai_app"
      "name": "llm-inference-app"
      "route_prefix": "/"
      "runtime_env":
        "env_vars":
          "RAY_LOG_TO_DRIVER": "1"
          "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
          "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
          "VLLM_NO_USAGE_STATS": "1"
    "http_options":
      "host": "0.0.0.0"
      "keep_alive_timeout_s": 200
      "port": 8008
      "request_timeout_s": null
    "logging_config":
      "enable_access_log": true
      "encoding": "JSON"
      "log_level": "INFO"
      "logs_dir": null
    "proxy_location": "EveryNode"

    EOT
    "content_base64" = tostring(null)
    "content_disposition" = ""
    "content_encoding" = ""
    "content_language" = ""
    "content_type" = "application/yaml"
    "etag" = "a59232ecd5990f5fa24c70f1dcf560e6"
    "force_destroy" = false
    "id" = "sbkk/ray-serve-config-sbkk-01/latest.yaml"
    "key" = "sbkk/ray-serve-config-sbkk-01/latest.yaml"
    "kms_key_id" = tostring(null)
    "metadata" = tomap({})
    "object_lock_legal_hold_status" = ""
    "object_lock_mode" = ""
    "object_lock_retain_until_date" = ""
    "override_provider" = tolist([])
    "server_side_encryption" = "AES256"
    "source" = tostring(null)
    "source_hash" = tostring(null)
    "storage_class" = "STANDARD"
    "tags" = tomap({})
    "tags_all" = tomap({
      "Env" = "prd"
      "Project" = "reimei-engine-ray"
      "Terraform" = "true"
    })
    "version_id" = "cwvI9yXEQdHzQX_CerS6qw6flw_JsINx"
    "website_redirect" = ""
  }
  "sbkk-02" = {
    "acl" = tostring(null)
    "arn" = "arn:aws:s3:::reimei-engine-ray-prd-llm-serve-config/sbkk/ray-serve-config-sbkk-02/latest.yaml"
    "bucket" = "reimei-engine-ray-prd-llm-serve-config"
    "bucket_key_enabled" = false
    "cache_control" = ""
    "checksum_algorithm" = tostring(null)
    "checksum_crc32" = ""
    "checksum_crc32c" = ""
    "checksum_crc64nvme" = ""
    "checksum_sha1" = ""
    "checksum_sha256" = ""
    "content" = <<-EOT
    "applications":
    - "args":
        "deployment_options":
          "max_ongoing_requests": 256
          "max_replicas_per_node": 16
          "name": "llm-server-router"
          "num_replicas": 32
          "ray_actor_options":
            "accelerator_type": "H100"
            "num_cpus": 1
        "llm_server_configs":
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sbint-instruct-2025-11-25:70b-sft"
            "num_replicas": 2
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 1
            - "CPU": 1
              "GPU": 1
            - "CPU": 1
              "GPU": 1
            - "CPU": 1
              "GPU": 1
            - "CPU": 1
              "accelerator_type:H100": 0.001
            "placement_group_strategy": "PACK"
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
          "engine": "vllm"
          "engine_kwargs":
            "distributed_executor_backend": "ray"
            "model": "/lustre/share/sbint_models/finetuned/release/sbint-2025-11-25/sbint-2025-11-25-70b-sft/"
            "override_generation_config":
              "repetition_penalty": 1.05
              "temperature": 0.7
              "top_p": 0.9
            "served_model_name":
            - "sbint-instruct-2025-11-25:70b-sft"
            - "sarashina2-mini"
            - "sarashina-mini"
            "tensor_parallel_size": 4
          "server_kwargs":
            "enable_auto_tool_choice": true
            "tool_call_parser": "sarashina2_json"
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sbint-translation-2025-10-20:7b-dpo"
            "num_replicas": 2
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 1
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 1
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.9
            "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-10-20/sbint-translation-2025-10-20-dpo/"
            "override_generation_config":
              "repetition_penalty": 1.05
              "temperature": 0.7
              "top_p": 0.9
            "served_model_name":
            - "sbint-translation-2025-10-20:7b-dpo"
          "server_kwargs": {}
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sbint-translation-2025-12-22:7b-dpo"
            "num_replicas": 2
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 1
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 1
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.9
            "model": "/lustre/share/sbint_models/translation/release/sbint-translation-2025-12-22/sbint-translation-2025-12-22-dpo/"
            "override_generation_config":
              "repetition_penalty": 1.05
              "temperature": 0.7
              "top_p": 0.9
            "served_model_name":
            - "sbint-translation-2025-12-22:7b-dpo"
          "server_kwargs": {}
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sarashinaguard-7b-20250508"
            "num_replicas": 2
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 1
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 1
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.9
            "model": "/lustre/share/sbint_models/guardrail/sarashinaguard-7b-20250508/"
            "served_model_name":
            - "sarashinaguard-7b-20250508"
            - "sarashinaguard-v2.0.1"
            - "sarashina2-guard"
          "server_kwargs": {}
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sarashina-embedding-v2-1b"
            "num_replicas": 4
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 0.25
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 0.25
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.225
            "model": "/lustre/teams/text_embeddings/experiments/model_merge/sarashina2.2-1B/test_merge_PROTO_sarashina2.2-1B__multistage_20250610_stg1_v1__stg2_base1_gecko_all_forbes_cl_classsification_base2_gecko_ruri-v3-ft_jsnli_nq_nu-mnli_mr-tydi/"
            "served_model_name":
            - "sarashina-embedding-v2-1b"
          "server_kwargs": {}
        - "deployment_options":
            "max_ongoing_requests": 512
            "name": "sarashina2.2-0.5b-reranker-toy-0523"
            "num_replicas": 4
            "placement_group_bundles":
            - "CPU": 1
              "GPU": 0.25
              "accelerator_type:H100": 0.001
            "ray_actor_options":
              "accelerator_type": "H100"
              "num_cpus": 1
              "num_gpus": 0.25
          "engine": "vllm"
          "engine_kwargs":
            "gpu_memory_utilization": 0.225
            "model": "/lustre/share/sbint_models/reranker/sarashina2.2-0.5b-reranker-toy-0523/"
            "served_model_name":
            - "sarashina2.2-0.5b-reranker-toy-0523"
          "server_kwargs": {}
      "import_path": "llm_serve.app.builder:build_openai_app"
      "name": "llm-inference-app"
      "route_prefix": "/"
      "runtime_env":
        "env_vars":
          "RAY_LOG_TO_DRIVER": "1"
          "RAY_LOG_TO_DRIVER_EVENT_LEVEL": "INFO"
          "VLLM_CACHE_ROOT": "/lustre/applications/reimei-engine-llm-serve/.cache/vllm"
          "VLLM_NO_USAGE_STATS": "1"
    "http_options":
      "host": "0.0.0.0"
      "keep_alive_timeout_s": 200
      "port": 8008
      "request_timeout_s": null
    "logging_config":
      "enable_access_log": true
      "encoding": "JSON"
      "log_level": "INFO"
      "logs_dir": null
    "proxy_location": "EveryNode"

    EOT
    "content_base64" = tostring(null)
    "content_disposition" = ""
    "content_encoding" = ""
    "content_language" = ""
    "content_type" = "application/yaml"
    "etag" = "a59232ecd5990f5fa24c70f1dcf560e6"
    "force_destroy" = false
    "id" = "sbkk/ray-serve-config-sbkk-02/latest.yaml"
    "key" = "sbkk/ray-serve-config-sbkk-02/latest.yaml"
    "kms_key_id" = tostring(null)
    "metadata" = tomap({})
    "object_lock_legal_hold_status" = ""
    "object_lock_mode" = ""
    "object_lock_retain_until_date" = ""
    "override_provider" = tolist([])
    "server_side_encryption" = "AES256"
    "source" = tostring(null)
    "source_hash" = tostring(null)
    "storage_class" = "STANDARD"
    "tags" = tomap({})
    "tags_all" = tomap({
      "Env" = "prd"
      "Project" = "reimei-engine-ray"
      "Terraform" = "true"
    })
    "version_id" = "R8OFGfnpqZpdLTvuE4BBVN5u_1GhwY4h"
    "website_redirect" = ""
  }
}
tenant_name = "sbkk"
tg_for_raydsh = {
  "sbkk-01" = {
    "arn" = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f"
    "arn_suffix" = "targetgroup/raydsh20251107040950750900000001/10327360e41dea1f"
    "connection_termination" = false
    "deregistration_delay" = "300"
    "health_check" = tolist([
      {
        "enabled" = true
        "healthy_threshold" = 2
        "interval" = 30
        "matcher" = "200"
        "path" = "/cluster_id"
        "port" = "traffic-port"
        "protocol" = "HTTP"
        "timeout" = 5
        "unhealthy_threshold" = 3
      },
    ])
    "id" = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000001/10327360e41dea1f"
    "ip_address_type" = "ipv4"
    "lambda_multi_value_headers_enabled" = false
    "load_balancer_arns" = toset([
      "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157",
    ])
    "load_balancing_algorithm_type" = tostring(null)
    "load_balancing_anomaly_mitigation" = tostring(null)
    "load_balancing_cross_zone_enabled" = "use_load_balancer_configuration"
    "name" = "raydsh20251107040950750900000001"
    "name_prefix" = "raydsh"
    "port" = 8012
    "preserve_client_ip" = "false"
    "protocol" = "TCP"
    "protocol_version" = tostring(null)
    "proxy_protocol_v2" = false
    "slow_start" = 0
    "stickiness" = tolist([
      {
        "cookie_duration" = 0
        "cookie_name" = ""
        "enabled" = false
        "type" = "source_ip"
      },
    ])
    "tags" = tomap({
      "Env" = "prd"
      "Name" = "reimei-engine-ray-prd-sbkk-raydsh-tg"
      "Project" = "reimei-engine-ray"
      "Tenant" = "sbkk"
    })
    "tags_all" = tomap({
      "Env" = "prd"
      "Name" = "reimei-engine-ray-prd-sbkk-raydsh-tg"
      "Project" = "reimei-engine-ray"
      "Tenant" = "sbkk"
      "Terraform" = "true"
    })
    "target_failover" = tolist([
      {
        "on_deregistration" = tostring(null)
        "on_unhealthy" = tostring(null)
      },
    ])
    "target_group_health" = tolist([
      {
        "dns_failover" = tolist([
          {
            "minimum_healthy_targets_count" = "1"
            "minimum_healthy_targets_percentage" = "off"
          },
        ])
        "unhealthy_state_routing" = tolist([
          {
            "minimum_healthy_targets_count" = 1
            "minimum_healthy_targets_percentage" = "off"
          },
        ])
      },
    ])
    "target_health_state" = tolist([
      {
        "enable_unhealthy_connection_termination" = true
        "unhealthy_draining_interval" = 0
      },
    ])
    "target_type" = "instance"
    "vpc_id" = "vpc-07758e1658c4c2149"
  }
  "sbkk-02" = {
    "arn" = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428"
    "arn_suffix" = "targetgroup/raydsh20251107040950750900000002/0e8293b01092a428"
    "connection_termination" = false
    "deregistration_delay" = "300"
    "health_check" = tolist([
      {
        "enabled" = true
        "healthy_threshold" = 2
        "interval" = 30
        "matcher" = "200"
        "path" = "/cluster_id"
        "port" = "traffic-port"
        "protocol" = "HTTP"
        "timeout" = 5
        "unhealthy_threshold" = 3
      },
    ])
    "id" = "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/raydsh20251107040950750900000002/0e8293b01092a428"
    "ip_address_type" = "ipv4"
    "lambda_multi_value_headers_enabled" = false
    "load_balancer_arns" = toset([
      "arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-engine-ray-prd-nlb4ext/f22c743e4d82e157",
    ])
    "load_balancing_algorithm_type" = tostring(null)
    "load_balancing_anomaly_mitigation" = tostring(null)
    "load_balancing_cross_zone_enabled" = "use_load_balancer_configuration"
    "name" = "raydsh20251107040950750900000002"
    "name_prefix" = "raydsh"
    "port" = 8012
    "preserve_client_ip" = "false"
    "protocol" = "TCP"
    "protocol_version" = tostring(null)
    "proxy_protocol_v2" = false
    "slow_start" = 0
    "stickiness" = tolist([
      {
        "cookie_duration" = 0
        "cookie_name" = ""
        "enabled" = false
        "type" = "source_ip"
      },
    ])
    "tags" = tomap({
      "Env" = "prd"
      "Name" = "reimei-engine-ray-prd-sbkk-raydsh-tg"
      "Project" = "reimei-engine-ray"
      "Tenant" = "sbkk"
    })
    "tags_all" = tomap({
      "Env" = "prd"
      "Name" = "reimei-engine-ray-prd-sbkk-raydsh-tg"
      "Project" = "reimei-engine-ray"
      "Tenant" = "sbkk"
      "Terraform" = "true"
    })
    "target_failover" = tolist([
      {
        "on_deregistration" = tostring(null)
        "on_unhealthy" = tostring(null)
      },
    ])
    "target_group_health" = tolist([
      {
        "dns_failover" = tolist([
          {
            "minimum_healthy_targets_count" = "1"
            "minimum_healthy_targets_percentage" = "off"
          },
        ])
        "unhealthy_state_routing" = tolist([
          {
            "minimum_healthy_targets_count" = 1
            "minimum_healthy_targets_percentage" = "off"
          },
        ])
      },
    ])
    "target_health_state" = tolist([
      {
        "enable_unhealthy_connection_termination" = true
        "unhealthy_draining_interval" = 0
      },
    ])
    "target_type" = "instance"
    "vpc_id" = "vpc-07758e1658c4c2149"
  }
}

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224/reimei_RAG/terraform/environments_ray/prod/sbkk ((sbkk-prod-ray-release-20251224-1))
$ cd ~

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ pwd
/c/Users/prod.shogo.kagami

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ ls -l
total 3501
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14 '3D Objects'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Aug 19  2021  AppData/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      42 Jul  4 11:14 'Application Data' -> /c/Users/prod.shogo.kagami/AppData/Roaming/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Contacts/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      70 Jul  4 11:14  Cookies -> /c/Users/prod.shogo.kagami/AppData/Local/Microsoft/Windows/INetCookies/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 15:49  Desktop/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 23 15:46  Documents/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 19 11:36  Downloads/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Favorites/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Links/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      40 Jul  4 11:14 'Local Settings' -> /c/Users/prod.shogo.kagami/AppData/Local/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Music/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      36 Jul  4 11:14 'My Documents' -> /c/Users/prod.shogo.kagami/Documents/
-rw-r--r-- 1 prod.shogo.kagami 1049089 1310720 Dec 23 15:17  NTUSER.DAT
-rw-r--r-- 1 prod.shogo.kagami 1049089   65536 Jul  4 11:54  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TM.blf
-rw-r--r-- 1 prod.shogo.kagami 1049089  524288 Jul  4 11:14  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TMContainer00000000000000000001.regtrans-ms
-rw-r--r-- 1 prod.shogo.kagami 1049089  524288 Jul  4 11:14  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TMContainer00000000000000000002.regtrans-ms
lrwxrwxrwx 1 prod.shogo.kagami 1049089      78 Jul  4 11:14  NetHood -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Network Shortcuts'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Pictures/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      78 Jul  4 11:14  PrintHood -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Printer Shortcuts'/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      67 Jul  4 11:14  Recent -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Recent/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14 'Saved Games'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Searches/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      67 Jul  4 11:14  SendTo -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/SendTo/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      70 Jul  4 11:14  Templates -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Templates/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Videos/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 10 15:09  WINDOWS/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 10 17:44  bin/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 24 18:29  deploy_20250724/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Sep 17 19:01  deploy_20250917/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Oct 27 18:52  deploy_20251027/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov  7 17:07  deploy_20251107/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 11 14:36  deploy_20251111/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 21 10:23  deploy_20251121-1/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 21 13:43  deploy_20251121-2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 25 15:25  deploy_20251125/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 26 17:04  deploy_20251126/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 17:29  deploy_20251127/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 17:30  deploy_20251127-2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 18:21  deploy_20251127-3/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 19:48  deploy_20251127-4/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 20:36  deploy_20251127_sbkk_ext/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 20:49  deploy_20251127_sbkk_ray/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 22:42  deploy_20251127_sbkk_ray-2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  2 14:26  deploy_20251202/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 11:02  deploy_20251204/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 15:34  deploy_20251204-1/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 16:32  deploy_20251204−2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  8 18:30  deploy_20251208/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 10 13:03  deploy_20251210/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 15 13:51  deploy_20251215/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 16 18:43  deploy_20251216/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 23 13:06  deploy_20251223/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 14:03  deploy_20251224/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 21:47  deploy_revert20251127/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 21:54  deploy_revert20251127-2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 22:05  deploy_revert20251127-3/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 16 20:28  deploy_revert20251216/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  1 17:20  deploy_test/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 15:43  log/
-rw-r--r-- 1 prod.shogo.kagami 1049089  396800 Oct 30 14:09  material.tar
-rw-r--r-- 1 prod.shogo.kagami 1049089  421888 Jul  4 11:14  ntuser.dat.LOG1
-rw-r--r-- 1 prod.shogo.kagami 1049089  262144 Jul  4 11:14  ntuser.dat.LOG2
-rw-r--r-- 1 prod.shogo.kagami 1049089      20 Aug 19  2021  ntuser.ini
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 18 15:28  reimei_RAG/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      71 Jul  4 11:14 'スタート メニュー' -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Start Menu'/

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ du -sh deploy_20251224
2.9G    deploy_20251224

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ rm -rf deploy_202511*

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ rm -rf deploy_202510*

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ rm -rf deploy_202509*

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ rm -rf deploy_202508*

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ rm -rf deploy_202507*

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ ls -l
total 3573
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14 '3D Objects'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Aug 19  2021  AppData/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      42 Jul  4 11:14 'Application Data' -> /c/Users/prod.shogo.kagami/AppData/Roaming/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Contacts/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      70 Jul  4 11:14  Cookies -> /c/Users/prod.shogo.kagami/AppData/Local/Microsoft/Windows/INetCookies/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 15:49  Desktop/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 23 15:46  Documents/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 19 11:36  Downloads/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Favorites/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Links/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      40 Jul  4 11:14 'Local Settings' -> /c/Users/prod.shogo.kagami/AppData/Local/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Music/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      36 Jul  4 11:14 'My Documents' -> /c/Users/prod.shogo.kagami/Documents/
-rw-r--r-- 1 prod.shogo.kagami 1049089 1310720 Dec 23 15:17  NTUSER.DAT
-rw-r--r-- 1 prod.shogo.kagami 1049089   65536 Jul  4 11:54  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TM.blf
-rw-r--r-- 1 prod.shogo.kagami 1049089  524288 Jul  4 11:14  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TMContainer00000000000000000001.regtrans-ms
-rw-r--r-- 1 prod.shogo.kagami 1049089  524288 Jul  4 11:14  NTUSER.DAT{cb2c9905-007c-11ec-b8ea-cc31a8606de8}.TMContainer00000000000000000002.regtrans-ms
lrwxrwxrwx 1 prod.shogo.kagami 1049089      78 Jul  4 11:14  NetHood -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Network Shortcuts'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Pictures/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      78 Jul  4 11:14  PrintHood -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Printer Shortcuts'/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      67 Jul  4 11:14  Recent -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Recent/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14 'Saved Games'/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Searches/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      67 Jul  4 11:14  SendTo -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/SendTo/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      70 Jul  4 11:14  Templates -> /c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Templates/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul  4 11:14  Videos/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 10 15:09  WINDOWS/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 10 17:44  bin/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  2 14:26  deploy_20251202/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 11:02  deploy_20251204/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 15:34  deploy_20251204-1/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  4 16:32  deploy_20251204−2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  8 18:30  deploy_20251208/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 10 13:03  deploy_20251210/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 15 13:51  deploy_20251215/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 16 18:43  deploy_20251216/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 23 13:06  deploy_20251223/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 14:03  deploy_20251224/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 21:47  deploy_revert20251127/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 21:54  deploy_revert20251127-2/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Nov 27 22:05  deploy_revert20251127-3/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 16 20:28  deploy_revert20251216/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec  1 17:20  deploy_test/
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Dec 24 15:43  log/
-rw-r--r-- 1 prod.shogo.kagami 1049089  396800 Oct 30 14:09  material.tar
-rw-r--r-- 1 prod.shogo.kagami 1049089  421888 Jul  4 11:14  ntuser.dat.LOG1
-rw-r--r-- 1 prod.shogo.kagami 1049089  332800 Jul  4 11:14  ntuser.dat.LOG2
-rw-r--r-- 1 prod.shogo.kagami 1049089      20 Aug 19  2021  ntuser.ini
drwxr-xr-x 1 prod.shogo.kagami 1049089       0 Jul 18 15:28  reimei_RAG/
lrwxrwxrwx 1 prod.shogo.kagami 1049089      71 Jul  4 11:14 'スタート メニュー' -> '/c/Users/prod.shogo.kagami/AppData/Roaming/Microsoft/Windows/Start Menu'/

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ pwd
/c/Users/prod.shogo.kagami

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ mkdir deploy_20251224_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd deploy_20251224_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251224_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ git clone https://github.com/sbintuitions/reimei_RAG
Cloning into 'reimei_RAG'...
remote: Enumerating objects: 28771, done.
remote: Counting objects: 100% (63/63), done.
remote: Compressing objects: 100% (47/47), done.
remote: Total 28771 (delta 24), reused 34 (delta 16), pack-reused 28708 (from 2)
Receiving objects: 100% (28771/28771), 65.50 MiB | 24.16 MiB/s, done.
Resolving deltas: 100% (19170/19170), done.
Updating files: 100% (1310/1310), done.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ ls
reimei_RAG/

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ ls -l
total 4
drwxr-xr-x 1 prod.shogo.kagami 1049089 0 Dec 24 15:56 reimei_RAG/

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ aws sso login
Attempting to open your default browser.
If the browser does not open, open the following URL:

https://oidc.ap-northeast-1.amazonaws.com/authorize?response_type=code&client_id=5V_8Uzhxuzrp-VLg2lu6IGFwLW5vcnRoZWFzdC0x&redirect_uri=http%3A%2F%2F127.0.0.1%3A60431%2Foauth%2Fcallback&state=2a78d469-4c94-4e7f-8c79-956b10592b4d&code_challenge_method=S256&scopes=sso%3Aaccount%3Aaccess&code_challenge=TBnpdpIcKaRChf9jSlGjA-R1VMr8H1oJO7QaLwMeksI
Successfully logged into Start URL: https://d-95675fea1b.awsapps.com/start/#

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app (main)
$ cd ~

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd /deploy_20251224_app
bash: cd: /deploy_20251224_app: No such file or directory

commit affac193c26e04e246ec822b2571a60bbb465eb3 (HEAD, tag: stg-20251223-nightly, tag: sbkk-prod-release-20251224-1, tag: b2b-fc1-prod-ray-release-20251223-2)
Merge: 11a0bc32 d14b9e62
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 16:48:16 2025 +0900

    Merge pull request #783 from sbintuitions/ray/deploy-sbint-translation-2025-12-22-7b-dpo

    ray: `sbint-translation-2025-12-22:7b-dpo` を sbkk staging/prod にデ
プロイ

commit d14b9e6238e60f420fa8ede092a42c30d1cb13e4
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 15:45:56 2025 +0900

    feat: add sbint-translation-2025-12-22:7b-dpo to sbkk staging/prod

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 11a0bc329722e676239de90a93e541fde3e851c7
:...skipping...
commit affac193c26e04e246ec822b2571a60bbb465eb3 (HEAD, tag: stg-20251223-nightly, tag: sbkk-prod-release-20251224-1, tag: b2b-fc1-prod-ray-release-20251223-2)
Merge: 11a0bc32 d14b9e62
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 16:48:16 2025 +0900

    Merge pull request #783 from sbintuitions/ray/deploy-sbint-translation-2025-12-22-7b-dpo

    ray: `sbint-translation-2025-12-22:7b-dpo` を sbkk staging/prod にデプロイ

commit d14b9e6238e60f420fa8ede092a42c30d1cb13e4
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 15:45:56 2025 +0900

    feat: add sbint-translation-2025-12-22:7b-dpo to sbkk staging/prod

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 11a0bc329722e676239de90a93e541fde3e851c7
Merge: 1708d973 7bb92972
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 15:11:56 2025 +0900

    Merge pull request #777 from sbintuitions/ray/fix-serve-config-b2b-fc1

    ray: fix variables for serve config in b2b-fc1

commit 7bb92972f812d78a9fbbce3ddaa5fc7aafd461bc
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 13:40:32 2025 +0900

    chore: fix variables for serve config in b2b-fc1

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 1708d97389c83e6ea06e8f16b60b28ecfde51792
Merge: d8b20a71 93584e33
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 11:47:59 2025 +0900

    Merge pull request #765 from sbintuitions/ray/auto-set-ray-actor-options

    ray: デプロイが失敗する問題の緩和 + serve configの一部をmodule外から隠蔽

commit 93584e331e5fcead13318ce9929f863cce5c6db7
Merge: 95d12ae8 d8b20a71
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 22 11:09:49 2025 +0900

    Merge branch 'main' into ray/auto-set-ray-actor-options

commit d8b20a71fc24d82d3c53ae9f0072b731181ee9c9
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Mon Dec 22 10:53:22 2025 +0900

    fix: main tests to match output (#776)

commit 8b71a0af3740d10cd2d0423aab98e1f1f338526d (tag: prd-ray-b2b-fc1-release-20251223-1, tag: b2b-fc1-prod-ray-release-20251223-1)
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Mon Dec 22 09:46:48 2025 +0900

    Add datadog log forwarder ext env (#771)

    Add datadog log forwarder in ext environments

commit d02f22861a47da6dd1f065d706119dc07b0fb5c8
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Mon Dec 22 09:46:30 2025 +0900

    fix: Unified plan keys to a single API key (#774)

    * fix: Unified plan keys to a single API key

    * Fix: Universal Usage key for all dedicated users

    * fix: removed dedicated plan condition

    fix:fmt

    fix: removed comment

    * feat: basic plan comment

    rm space

commit 6de8b719cd56888d7c667b71cbd208919e233d24 (tag: stg-20251222-nightly)
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 19 18:07:39 2025 +0900

    fix: hashするpropertyに誤りがあったため修正 (#772)

    * fix: hashするpropertyに誤りがあったため修正

    * fileの変更を検知できていなかったので修正

commit 684f40aa313fbbfc9476d243ff50195c0a4d06fc
Merge: 7c546833 efb8c132
Author: Yugo Omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 17:51:27 2025 +0900

    Merge pull request #764 from sbintuitions/feat/update-gh-actions-checks-for-b2b-demo

    feat: update GH Actions checks for b2b demo

commit efb8c1329e0e107e45d24818a0dddf92432b5d19
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 17:40:40 2025 +0900

    fix: update `.terraform.lock.hcl`

commit 393267cc849254ec0188b91dc3be2906d19ce701
Merge: 64c6f965 7c546833
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 17:35:32 2025 +0900

    Merge branch 'main' into feat/update-gh-actions-checks-for-b2b-demo

commit 7c5468337034ccf4505d784032fae897078b384f
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Fri Dec 19 17:07:06 2025 +0900

    feat: replication prefix for dev (#759)

    ecr repo prefix

    fix: replication

    fix: removed slash from module naming

    feat: matched naming and modularization with dev

    feat: added var

    fix: fmt

    fix: added versions to modules

    feat: backwards module compatibility for stg

    fix: TODO comment

    fix: target err

    rm: target

    fix: lock

    feat: add modularndependency

    feat: target var

    fix: ecr module versions

    feat: lock file changed

    feat: API auth containers for stg and prd

    feat: removed for prod

    fix: removed repo sub for prod ext

    fix:tfvars

commit d2b53e0a39472a143130449818da70bdbe9db56d
Merge: 5da35797 8aab1dcd
Author: Yugo Omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 17:04:01 2025 +0900

    Merge pull request #763 from sbintuitions/feat/add-b2b-demo-minimal-envs

    Feat/add b2b demo minimal envs

commit 5da357970f46d51577ec65c8fb5403ddc48fecf6
Merge: 4488abf3 a9003395
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Fri Dec 19 16:59:26 2025 +0900

    Merge pull request #754 from sbintuitions/ray-add-b2b_fc1

    ray:b2b-fc1テナントの追加

commit a900339503e31ef26f5882e23c885d031f759a8a
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Fri Dec 19 16:43:52 2025 +0900

    b2b-fc1 change no_proxy from sr to fc and fix subnet_id_map

commit 4488abf33b3a0a227526e0564e7c02a0e94090b6
Merge: 02803b6c 36169d82
Author: Yugo Omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 16:30:49 2025 +0900

    Merge pull request #770 from sbintuitions/fix/update-deploy-lambda-to-change-its-name-prefix

    Fix/update deploy lambda to change its name prefix

commit 36169d824db38ca1146c67a758080cf03e2c5d1c
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 16:21:01 2025 +0900

    refactor: fixed by terraform fmt

commit 356a2b543064e04f377c1acb989e804296b03561
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 19 16:20:40 2025 +0900

    feat: update deploy-lambda to change its name prefix

commit 02803b6ce8c51d6a21b8589b05aaace4bf33c6d4
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 19 16:19:41 2025 +0900

    [b2b]冬季休業期間中の定常desired_countを下げる

commit 98e22d3c8611b995fc1bb5653c18dab192a8420f
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Fri Dec 19 15:53:47 2025 +0900

    feat: ray dashboard tenants for fc1 (#768)

commit ddc4e0749ac451c51c2aa21521b3a3bb8f22aeff
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 19 15:52:38 2025 +0900

    [検証][API Gateway] タイムアウトを10分に延長 (#766)

    * 検証: app-routerのタイムアウトを延長

    * 検証: rayのタイムアウトを延長

    * 検証: ALB, NLBのタイムアウトを延長

    * 検証: service connectのタイムアウトを延長

    * 負荷試験用にタスク数を一時的に増加

    * 検証: API Gatewayのタイムアウトを仕様に合わせる

    * fix: tcp_idle_timeoutの指定方法が間違っていたため修正

commit 031ce090af4155a87a9a3fded280acb35ba4e4b1 (tag: dev-20251219-1)
Merge: e333c06e e6e69443
Author: Hiroyuki Shigeta <hiroyuki.shigeta@sbintuitions.co.jp>
Date:   Fri Dec 19 12:18:12 2025 +0900

    Merge pull request #760 from sbintuitions/feat/fix_path_translation_backend

    翻訳依頼エンドポイントのパスを修正

commit e333c06e78e9543f46e7f821f845803e2b106d5c
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 19 12:08:33 2025 +0900

    [bugfix][apigw][b2b] stagingでapi gateway以降と疎通できない不具合を修正 (#755)

    * fix: private_linkのinboundを評価しない

    * comment: prefixについてコメントを追加

commit 3be0b3ab66bc74717b8dd785858d31afff35a9e1
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 19 12:08:11 2025 +0900

    API GatewayにTLS versionを指定。 (#762)

    * カスタムドメインのTLS versionを指定

    * カスタムドメイン以外からの実行を拒否

commit 7d17b5a1ff586c818776b45aa524f914225b1f0b
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Fri Dec 19 11:02:25 2025 +0900

    Add User UUID to http header (#753)

    API gatewayはAPI keyを識別できるUUIDをx-caller-serviceヘッダーに入れる

commit 95d12ae8dcd3c8ce3db77581fe6a2dc160a559c1
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Fri Dec 19 03:33:51 2025 +0900

    refactor: hide serve config details into module

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 91e747afda858d333af70aa377fa9edbc5ed8979
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Thu Dec 18 18:37:24 2025 +0900

    change from b2b_fc1 to b2b-fc1

commit 64c6f9659432ff7b859fa3afeda440274835fe98
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 18:11:35 2025 +0900

    feat: update GH Actions checks for b2b demo

commit 5e947e7c09e0401e223b9d8f20444aca123eeedb (tag: stg-20251219-nightly)
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Thu Dec 18 17:56:10 2025 +0900

    Add Datadog headers for APM tracing (#758)

commit 8aab1dcdcb0c43ceb82a264af5b53d4bd2bda361
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 17:50:57 2025 +0900

    feat: add prd

commit 37b9ed1710d00c18e5ba7ee363ee205325f503ec
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 17:50:24 2025 +0900

    feat: add stg

commit 84867a16488f5353893019ee7d26768881084631
Merge: 26df0df9 07718ef5
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Thu Dec 18 17:50:43 2025 +0900

    Merge pull request #761 from sbintuitions/toura-fix-vector-dimension

    Fix vector dimension

commit 07718ef57fe01d0ae5d47b06ac5a00dd770db7cf
Merge: bb696729 26df0df9
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 18 17:13:28 2025 +0900

    Merge branch 'main' of github.com:sbintuitions/reimei_RAG into toura-fix-vector-dimension

commit bb696729796a81bd8dbe3dc4b81fd6b429f1d1ca
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 18 17:13:24 2025 +0900

    Fix vector dimension

commit 26df0df94a7febc9c0c637fcd2f6dbd9164ea972
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Thu Dec 18 17:07:04 2025 +0900

    Update API gateway logging contents (#757)

    - API gatewayのログに必要な情報を付与する
      - WAF
      - latency情報
      - user情報

commit 7949ee9736323c9091e2fb77fb9d8213ac4d5c1b
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 16:46:11 2025 +0900

    feat: add dev

commit e6e69443bfe37de8b07a897c9a85e92780d87037 (tag: dev-20251218-1)
Author: Hiroyuki Shigeta <hiroyuki.shigeta@sbintuitions.co.jp>
Date:   Thu Dec 18 16:48:05 2025 +0900

    翻訳依頼エンドポイントのパスを修正

commit e91e98c44da1997a76aae897e6d5f50cb404e14d
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 16:42:43 2025 +0900

    feat: update "shared-config" to use valid keys/values in b2b-demo environments

commit d5f05f6900f7b74e5358a1c3ef7fd41db02fae78
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Thu Dec 18 15:58:47 2025 +0900

    change ray config for b2b_fc1

commit cfa1779558ae9e4c14a76c8819d47b3d36a46dd9
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 18 15:46:48 2025 +0900

    feat: copy shared-config-for-{dev,stg,prd}.json to shared-config-for-b2b-demo-{dev,stg,prd}.json

commit ec8ae76e674e544563576ed0c57b48683a36d657
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Thu Dec 18 14:22:43 2025 +0900

    fix: added prefix path to api auth container (#751)

    * fix: added prefix path to api auth container

    * fix: unified prefix to sbint-services

    fix: added lambda

    * feat: rm tags

commit 394e90ce799c18a7649bb30f0d915bb34ccad715
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Thu Dec 18 11:18:12 2025 +0900

    add-b2b_fc1-tenant

commit c26b895965df633b5d42aeff24da8ab00e0cca87
Merge: 8c3ceacf 39612069
Author: kawai020 <nobuo.kawai@sbintuitions.co.jp>
Date:   Thu Dec 18 09:32:18 2025 +0900

    Merge pull request #752 from sbintuitions/feat/api_test_for_1128

    Feat/api test for 1128

commit 39612069d2e568f608431f7363b000a23b80f95b
Author: 丁 乾 <qian.ding@sbintuitions.co.jp>
Date:   Thu Dec 18 09:27:53 2025 +0900

    output report to html

commit 8c3ceacf8d47c6cb8e3aa7747259020b9558409a (tag: stg-20251218-nightly)
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Wed Dec 17 18:27:58 2025 +0900

    fix: techdev再発行 (#750)

commit 0a79293edb28028138678b74cee39aafb6113f4e
Merge: 57d7dcfa 3a87fd0d
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Wed Dec 17 15:50:58 2025 +0900

    Merge pull request #748 from sbintuitions/toura-similar-news-staging-prod

    類似ニュース推薦/ソフトバンクニュースに必要なリソースをstaging/prod環境に設定

commit 3a87fd0ddeb1fe2766f601dd5a568709ca11d1a5
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 15:41:57 2025 +0900

    Remove todo because it is resolved already

commit 0dcd91b84d64bbd8c12c4bfb2b7e8d6ae385b99c
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 15:26:39 2025 +0900

    Add softbank related configurations

commit acc1b8fcd3aa379e78aca61949858c7f5b36fefe
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 15:21:36 2025 +0900

    Add softbank related configurations

commit 254cf0d02582c31ffbf549a6f599d1e669db0513
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 15:14:45 2025 +0900

    Add softbank news settings

commit 6de9fe3f052cc444548a395c6e2af483bea4e161
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 14:58:22 2025 +0900

    Add resources for similar news search in staging/prod

commit 57d7dcfac59065ba0160314369dffd10809d91d6
Merge: 23d8ba3d b7d72b57
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Wed Dec 17 14:40:29 2025 +0900

    Merge pull request #735 from sbintuitions/toura-s3-vector-bucket

    S3 vector bucketをterraform managedにする

commit 23d8ba3d12b8a39cb4995316248836813a82363f
Merge: 306e9fa8 be208aa4
Author: yasushi-kanaya-sbint <yasushi.kanaya@sbintuitions.co.jp>
Date:   Wed Dec 17 13:47:58 2025 +0900

    Merge pull request #747 from sbintuitions/feat/loadtest_add_user

    トークン作成用スクリプトの追加

commit 306e9fa8ce0b367ff39c4873c7778a209d365c69
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Wed Dec 17 12:12:09 2025 +0900

    Fix/auth tests (#746)

commit be208aa49f39bcffc419f5a63db060fd0871bce2
Author: nobuo-kawai <nobuo.kawai@sbintuitions.co.jp>
Date:   Wed Dec 17 11:33:54 2025 +0900

    トークン作成用スクリプトの追加

commit 57064b439a14d5142e24e7634ec423ddc9f556bb
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Wed Dec 17 10:47:28 2025 +0900

    [B2B]正規化されたAPI Key prefixとdedicated testの追加 (#745)

    * [b2b]dev/stgのAPI Keyを追加

    * prodのreservedをdedicated for qaに変更

commit b7d72b5787060049aff76f7de4e63085e0beba63
Merge: a9626880 be90113c
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 17 09:35:13 2025 +0900

    Merge branch 'main' of github.com:sbintuitions/reimei_RAG into toura-s3-vector-bucket

commit be90113c716686474e97da4ae32a601ff481d7f9
Merge: c4d3a152 998a5e3f
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Wed Dec 17 09:30:50 2025 +0900

    Merge pull request #720 from sbintuitions/toura-deploy-from-lambda-lambda

    Remove iam-role-for-github-actions-to-deploy-lambda

commit c4d3a152d060a164b660697f08b9f98fef7e0e03
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Wed Dec 17 09:22:04 2025 +0900

    feat: auth logic with dynamo (#742)

    * feat: auth logic with dynamo

    * fix: removed comment

    * fix: early return

    * feat: compiler optimization and removed config

commit 8c2c46781750ab0f1b7f8f33335e9b37992cf319 (tag: stg-20251217-nightly)
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Tue Dec 16 19:18:45 2025 +0900

    stg, prdにdynamodbを実装 (#744)

commit f3737e5236d3b5ef0e3b5c15cedd5f2f874f24f6
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Tue Dec 16 19:03:35 2025 +0900

    feat: infrastructure deployment for DynamoDB key management (#741)

    * feat: infrastructure deployment for DynamoDB key management

    * feat: added comment to tell why there are only 1 api key for dedicated

    * fix: prefix

    * feat: Spec upgrade for lambd

    * fix: auth

commit f26032c4f12bc44a07105709d2ce0ff179c9aa9b
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Tue Dec 16 18:59:46 2025 +0900

    [b2b][stg/prd] API Gatewayを使用した構成の実装 (#740)

    * [stg][prd] b2b apigw 環境の実装

    * devでもdataを経由しない

    * feat: devにもコメントを追加

    * fix: 参照が散って見づらい

    * ドメインを追加

commit 7f2a31ef2536fc0dcc5651f7d9d63111fce35287
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Tue Dec 16 18:52:48 2025 +0900

    仕様外のAPIは閉じる (#743)

commit a962688033e77d7543e5d30ae65482a2e28fc738
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 17:22:28 2025 +0900

    Add a space between open brackent and resourcename

commit 8496e66a54bbedbbff868639c57afae3e1793792
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 17:20:46 2025 +0900

    Use reference instead of direct use of variable

commit 9b6e22b203885b3ca40a00312a5c957a8e0fae61
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 16:38:11 2025 +0900

    Add description

commit 13fa1695959dcea72451478f1cf42e87fff4b8d8
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 16:15:30 2025 +0900

    Update lock file

commit 6924efc385a288af45cb72cccab0c6010a0bd2a8
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 16:10:37 2025 +0900

    Update lock file

commit 4f68533f530e2bb42383b2017894c34c0fba6dfe
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 15:54:21 2025 +0900

    Use aws provider instead of awscc

commit ad3b9d4a6810b2727eae12f5dc2f9a89958f736f
Merge: 610a4257 dde2ad98
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 15:45:31 2025 +0900

    Merge branch 'main' of github.com:sbintuitions/reimei_RAG into toura-s3-vector-bucket

commit 998a5e3fd6def61f067beb79b2456ccb34745a0a
Merge: 11d2b9b6 dde2ad98
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 16 15:43:16 2025 +0900

    Merge branch 'main' of github.com:sbintuitions/reimei_RAG into toura-deploy-from-lambda-lambda

commit dde2ad987bcd9051522860989e830936c6488051
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Tue Dec 16 15:31:14 2025 +0900

    Feat/auth containerization (#738)

    * WIP: Lambda authorizer containerization

    * fix: containerizaition

    fix: pick up new images

    fix:readme

    fix: removed redundancy in readme doc

    * fix: go version

    fix: update go version

commit 817b869a9f207f4b858e6e44a8aebabc6faba9f0 (tag: sbkk-stg-ray-release-20251216-1)
Merge: 3bf91cf7 87543c65
Author: HirokiOgawa061 <hiroki.ogawa@sbintuitions.co.jp>
Date:   Tue Dec 16 14:03:07 2025 +0900

    Merge pull request #739 from sbintuitions/ray/relax-deployment-constraint

    ray: stagingのリソース要求削減および配置制限の緩和

commit 87543c65c2a3da2d6d0868275a8e1bfb612159d0
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Tue Dec 16 13:52:54 2025 +0900

    chore: relax placement constraint

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit c4144bba0c3054ebf6d9757907460c525514394d
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Tue Dec 16 13:52:38 2025 +0900

    chore: reduce resource requirement

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 3bf91cf7f7115377e48a78e4f557d69da056b70a
Merge: 1ad93491 a31e6a00
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Tue Dec 16 11:23:47 2025 +0900

    Merge pull request #722 from sbintuitions/toura-remove-old-member

    存在しないメンバをCODEOWNERから削除する。CODEOWNERで制限する対象ディレクトリを狭
める

commit 1ad93491b09b553afbfdbbb6d785def514c16d3c
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Tue Dec 16 10:36:34 2025 +0900

    [dev_ext]poc dirをdev_extにマージ (#737)

    * dev_extにapigatewayを実装

    * poc dirを削除

    * NLBがprivate linkでinbound ruleを評価しないようにする。

    * configの定義場所を移動しpocの文言を削除

    * global_rate_limitに移譲

commit 6e0eecdf02380b927e95b1d69ca0a7bfa69d9ab3
Merge: 736321ba f9493e76
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Tue Dec 16 09:36:06 2025 +0900

    Merge pull request #728 from sbintuitions/feat/manage-backend-terraform

    Feat:Manage backend.tf by terraform

commit 736321ba89c63ba362e50c9d0f6fdf396ba9a159 (tag: stg-20251216-nightly, tag: sbkk-prod-ray-release-20251216-1)
Merge: 6b82f81b 17000d77
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Mon Dec 15 16:21:53 2025 +0900

    Merge pull request #731 from sbintuitions/separate-jsonupload-sbkk

    separate json gen for sbkk

commit 610a4257fbf31e2e6c62d48d8f8af85c09282e39
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Mon Dec 15 15:15:22 2025 +0900

    Fix wrong place holder

commit 6b82f81bba25052fb71314446cea33366561b2a2
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Mon Dec 15 14:26:21 2025 +0900

    feat: iam roles for github actions in dev ext poc (#734)

    added iam roles for github action module

    fix: length limit

    fix: moved iam role to devext main

    fix: CI check

commit 9da1171501f2ff33a5e006a9f7107acfdac53182
Merge: f57617a2 5e67c146
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 15 13:50:21 2025 +0900

    Merge pull request #736 from sbintuitions/ray/update-no-proxy

    ray: no_proxyのlink-local addressをcidrでなく個別に書くように戻す

commit 5e67c146d7612059bad85780272c089b6f5d82a1
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 15 13:29:44 2025 +0900

    chore: expanc cidr

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 7a58fc50ca3b46433febf093128d62246e99e76c
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Mon Dec 15 13:10:47 2025 +0900

    Do not construct arn

commit c267798fa2193774327057a1e93b36ed40918c39
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Mon Dec 15 12:08:54 2025 +0900

    Rename resources not to use the word reuters

commit 2874eb09912094ecdc9f23f6d0ea6a2050150f5a
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Mon Dec 15 12:05:10 2025 +0900

    Rename reuters-news-embeddings-uploader -> news-embeddings-uploader because the module support any news source

commit f9493e767e5dccfef81d54cd81471d858218d93b
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 15 11:47:30 2025 +0900

    Revert "externalに対する変更を削除"

commit f57617a213913f434c588fa692ee704375461417
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Mon Dec 15 11:12:32 2025 +0900

    [dev_ext][apigw]使用量プラン実装の改善 && キャッシュロジックの修正 (#732)

    * API Gatewayのメソッド定義を細分化

    * 使用量プランを統一

    * fix: キャッシュのせいで他のパスにアクセスできなかった

    * fix: パスごとのレートリミット

    * fix: waf requiredにした

    * fix: 他のdirと合わせてoutput.tfは消す。

    * fix: tflint

    * fix: misspell

    * fix: comment

    * fix: lint

commit c39d448a4fa4779e54e36d0d5e8bf465c03427e4
Author: 丁 乾 <qian.ding@sbintuitions.co.jp>
Date:   Mon Dec 15 09:48:54 2025 +0900

    Delete api keys

commit 9931e0dde434f2460b224fb1db0ed40e3c8fefda (tag: stg-20251215-nightly)
Merge: 04f1404f 0dc8afa3
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Fri Dec 12 19:18:13 2025 +0900

    Merge pull request #729 from sbintuitions/ray/update-dgx-ip-list

    ray: 府中検証環境のDGX移行

commit 04f1404f21d2c5e972646cbe5e9fee05ad0f2472
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Fri Dec 12 18:22:39 2025 +0900

    Feat/api key management for poc (#730)

    * feat: create 10 API keys for each usage plan

    * WIP: api key management for devext gw poc

    * config path cmds in readme

    fix: devext

    * fix: merge error

    * feat: API key stablization

    fix: API Usage keys

    fix: stablize api key in api gw module

    fix: removed unused api key count logic

    * fix: update zip

    * fix: updated burst limit

    * fix: added comment

    * fix: removed fn

commit 9374a9a55da680aa626cbe5acd26df3c1be8d222
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 17:20:54 2025 +0900

    change:s3バケット名の修正

commit 17461b3d2f7c605a57fc0b62d9f4f79ce00ae19e
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 17:14:09 2025 +0900

    feat:externalのbackendもterraform管理

commit 6c954e87ebd6cd9e4b039725bc94b760436629d1
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 16:53:28 2025 +0900

    chnage:moduleが参照するproviderを変更

commit bad1852dfa07fd27c343f1b27adc06a1495c406e
Merge: e28b99b9 562edbfe
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 16:52:40 2025 +0900

    Merge branch 'main' into feat/manage-backend-terraform

commit 17000d7795d1a120949aa77817eabf85d0e24307
Author: shinya-goto <shinya.goto@sbintuitions.co.jp>
Date:   Fri Dec 12 15:09:43 2025 +0900

    separate json gen for sbkk

commit 0dc8afa385e5a9124f8112737161886af9330001
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Fri Dec 12 14:47:32 2025 +0900

    chore: fix vpc cidr for prod

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit bbdb2d2f0ee218ee33fd3fd3f6b8c22da4ce13ea
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Fri Dec 12 14:45:06 2025 +0900

    chore: update dgx ip list

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 562edbfec98b4675942fcfb05471e30a55c1d35e (tag: b2b-prod-ray-release-20251215-1)
Merge: 07c434e1 2cca9405
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Fri Dec 12 14:04:49 2025 +0900

    Merge pull request #725 from sbintuitions/toura-bump-aws-provider

    Bump aws provider version to 6.24.0

commit 07c434e11f47c30229b715c99f97651120021697
Merge: 1dc24458 8384d8e2
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Fri Dec 12 14:03:44 2025 +0900

    Merge pull request #724 from sbintuitions/toura-change-news-env

    News関連環境変数名の変更

commit 2cca94050cdce831fbae9f6d017a44dc4c93609f
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 12 12:34:00 2025 +0900

    fix: update prod .terraform.lock.hcl with the one generated by `terraform providers lock`

commit cab644993c9162a489f0fe89b3f1b0b9140eaccf
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 12 12:26:50 2025 +0900

    fix: update prod .terraform.lock.hcl

commit 1dc24458e8714afbc38f0a347cdc6c504a877e66
Merge: 9fe7d8b5 fc0d7c5f
Author: Yugo Omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 12 11:35:35 2025 +0900

    Merge pull request #726 from sbintuitions/feat/add-component-tag-for-b2b-dev

    Feat/add component tag for b2b dev

commit fc0d7c5f8f3dbb78c18b05174b07fc023b9ef0b2
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 12 10:38:43 2025 +0900

    feat: add comments on moved blocks

commit e28b99b9f19b4ef5dc7063769014745b798219b6
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 10:04:26 2025 +0900

    change:lockファイルの変更

commit b85ed6b72235d3ba90ca1f95677456c297fb9880
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 10:04:16 2025 +0900

    change:environments/stagingのbackendに含まれるコメントアウトを削除

commit cf7398da79a1fd60090c6a4fd28f75f3d6cb80d8
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 09:49:42 2025 +0900

    change:lockファイルの更新

commit a37cd44291ba235268bb2a5778e36bdb7315697a
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 09:34:02 2025 +0900

    feat/environments_b2bのbackendをterraformで管理

commit 37a924208845bac86e9ed7675de3bad9b0c77b13
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 12 09:33:26 2025 +0900

    feat:environmentsのbackendをterraform管理

commit 9fe7d8b589b92975c24612669f123584f20fe293
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 12 09:06:26 2025 +0900

    API Gatewayのカスタムドメインを実装 (#727)

    * feat: カスタムドメインを実装

    * fix: バージョンアップでtimeoutを延長

commit 1daef1c75abc58d5e8476b79ee3ca634c1b2b397
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:20:20 2025 +0900

    feat: enable the ECS-related modules to accept additional provider `aws.internal-observability`

commit e4bd9117ff5609c6fc28d43c11f00392532e12ab
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:15:46 2025 +0900

    feat: enable module `kinesis-firehose-s3-pipeline` to accept additional provider `aws.internal-observability`

commit 2ac37613a49fd70fbadaf89474d21b32c10a420f
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:12:23 2025 +0900

    feat: update the resource name of aws_secretsmanager_secret

commit a2603b12549c0e78138cec305b6879e7f820d31c
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:11:05 2025 +0900

    feat: update data.tf

commit 56282f376f8d472875eec60de377646ee8809b9b
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:09:22 2025 +0900

    feat: update all the resources/modules except for the ones related to CloudWatch Logs

commit 7d6b87ca11aa019b19031b2b6470a359406b0349
Author: yugo.omura <yugo.omura@sbintuitions.co.jp>
Date:   Thu Dec 11 20:04:10 2025 +0900

    feat: move providers to providers.tf

commit daf942dcd35b23e7afe36ee24162fa4b2a4972c5
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:53:09 2025 +0900

    Update lockfile with multiple platforms

commit 07003c9e6c397047d09225505e2ea0758a622929
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:46:29 2025 +0900

    Update lockfile with multiple platforms

commit 0d049be68347d08d263600ff0500dabe92488a75
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:42:20 2025 +0900

    Update lockfile with darwin_arm64 -platform=windows_amd64

commit e7c7a09d6ae31217e7304500454995420f9ff875
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:37:27 2025 +0900

    Update lock file

commit 54be9c873b85e4a5ea635fc439f5e751f2e9183c
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:37:17 2025 +0900

    Do pin aws provider version to follow top level version

commit f6c58cd23e6da798c9069696e5fccef8eae1ec19
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 18:20:19 2025 +0900

    Bump aws provider version to 6.24.0

commit 8384d8e235457b306fcfa0152b91aade726c891e
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 16:50:40 2025 +0900

    Change env format for news and leave old env as is for compatibility

commit c3e388a3960034637265b4d99a8be399f9127637 (tag: stg-ray-b2b-release-20251211-2,
 tag: stg-20251212-nightly)
Merge: 0ddabb27 9bf4f489
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Thu Dec 11 15:46:14 2025 +0900

    Merge pull request #723 from sbintuitions/ray/update-image-tag-20251211-1

    chore: update image tag to 20251211-1

commit 9bf4f489062f44c92a7c8ebc44583672109860e9
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Thu Dec 11 15:18:51 2025 +0900

    chore: update image tag to 20251211-1

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit a31e6a00f7e61a7a9c4f58eeed803f08bb131804
Merge: 3cbc3fa7 0ddabb27
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 10:33:48 2025 +0900

    Merge branch 'main' of github.com:sbintuitions/reimei_RAG into toura-remove-old-member

commit 3cbc3fa785ab9a0a3c7aa4c081133578bdb804bc
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Thu Dec 11 10:33:02 2025 +0900

    Remove a resigned member, narrow directories to restrict

commit 0ddabb27ef65c7b2bfc6e9792fd2f62248b9024b (tag: stg-ray-b2b-release-20251211-1,
 tag: b2b-prod-release-20251211-1)
Merge: fed27647 c9902910
Author: kawai020 <nobuo.kawai@sbintuitions.co.jp>
Date:   Thu Dec 11 09:52:12 2025 +0900

    Merge pull request #517 from sbintuitions/feat/add-regression-test-of-upload-and-translation

    add regression test of upload and tranlation

commit c9902910cfac1a4df41bb459a73386e66bf1b346
Author: 丁 乾 <qian.ding@sbintuitions.co.jp>
Date:   Thu Nov 6 14:40:07 2025 +0900

    add regression test of upload and tranlation

commit fed27647d5fa58e08dba0845cc1cd211a62bb074 (tag: stg-20251211-nightly)
Merge: d3848553 03256dc8
Author: Takeshi Oura <takoika@users.noreply.github.com>
Date:   Wed Dec 10 17:55:21 2025 +0900

    Merge pull request #721 from sbintuitions/toura-remove-old-envs

    Compatibilityのための古い環境変数を削除

commit d38485530d2c6ebcc67e3384c7d5fc407bfed5e7
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Wed Dec 10 15:18:01 2025 +0900

    feat: add PR template for Reimei RAG (#655)

    * feat: add PR template for Reimei RAG

    * feat: generalized ticket task

    * feat/ added context and objective section

    * feat: code review

commit 03256dc8ab8aef5ca39e7e65c6eea9fbf048283f
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Wed Dec 10 12:18:10 2025 +0900

    Remove old envs for compatibility

commit 5b4692a4c261eaf1de1c85ccfdc406fafc98863b
Merge: aeb14511 018eb2f8
Author: twaka <twaka@users.noreply.github.com>
Date:   Wed Dec 10 10:16:32 2025 +0900

    Merge pull request #719 from sbintuitions/twaka/update-image-tag-to-20251209-1

    ray: update image tag to 20251209-1

commit aeb145113d4b098521808b8d8b652ac58c43562f
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Wed Dec 10 09:57:09 2025 +0900

    Feat/lambda auth integration to gw (#718)

    * refactor: api auth

    * feat: added authorizer module to api gw

    feat: information hiding for lambda in lambda module

    * feat: enabled api key required for poc gateway

    * fis: api key organization

    fix: config layer zip path

    fix: deployment trigger

    * feat: updated Loc

    * fix: requestpath matching

    * fix:lock

    * fix: config layer zip path

    fix: triggers

    * feat:removed null rsc

    fix: auth removed from depends on

    * fix: auth logic for suffix

    * feat: add zip files

commit 11d2b9b6835b7fa43a2f5e3dc07ce5fe5414a955
Author: takoika <16839037+takoika@users.noreply.github.com>
Date:   Tue Dec 9 17:40:01 2025 +0900

    Remove iam-role-for-github-actions-to-deploy-lambda

commit 018eb2f8f52650539d94d53b27ebdd6bba498076
Author: twaka <twaka@users.noreply.github.com>
Date:   Tue Dec 9 16:52:29 2025 +0900

    update image tag to 20251209-1

commit 7dfc894365b66959e763beabe4976220e7708964 (tag: stg-20251210-nightly, tag: prod-ray-b2b-release-20251210-1, tag: prd-ray-b2b-release-20251210-1)
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Tue Dec 9 12:36:04 2025 +0900

    Fix service connect timeout (#717)

commit a30a903ccd90a9c6eebfa0eebbccb162479af2d8
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Tue Dec 9 11:37:49 2025 +0900

    API key AuthN by lambda authorizer (#514)

    * WIP

    * fix: added usage plan parameter to auth

    * feat: added null resource for when  the COnfig and Lambda code
    gets changed

    feat: null rsc ver

    * fix: set username as x-caller-service

    * feat: placeholder API usage key in config yaml

    * fix: updated test function to include x-caller-service

    * feat: auth logic to handle 3 usage plans and test

    * feat: main logic and test

    * feat: updated config

    * fix: changed from premium to dedicated

    ---------

    Co-authored-by: hosnoint <roka.hosono@sbintuitions.co.jp>

commit 2098e75f8473e2e9f8260d087ed187464509e9de
Author: hosnoint <roka.hosono@sbintuitions.co.jp>
Date:   Tue Dec 9 10:02:36 2025 +0900

    feat: adjusted API Gateway Parameters to match the requirements for lambda authorization (#715)

    * feat: adjusted API Gateway Parameters to match the requirements for the Lambda Authorizer

    * fix: made api key required to false

commit aed48fb2c5f0de446588455a1500792d7d42779a (tag: stg-20251209-nightly)
Merge: 59a59e26 80d58568
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 8 17:59:28 2025 +0900

    Merge pull request #714 from sbintuitions/feat/release-notes-auto-b2b

    feat:自動ワークフローをトリガーするタグ名の修正

commit 59a59e266c0c2a3e1fe1967a30f1892755a9f739 (tag: stg-ray-sbkk-release-20251208-1
)
Merge: 93b6d49d 0bde3e13
Author: Hiroyuki Shigeta <hiroyuki.shigeta@sbintuitions.co.jp>
Date:   Mon Dec 8 16:06:02 2025 +0900

    Merge pull request #694 from sbintuitions/feature/add_datadog_sidecar_translation_backend

    chat-backend, translation-backend: ECSタスク定義にdatadog-agentコンテナを追加

commit 93b6d49de3234aa71b83009bb4ceda7816017405
Merge: 12220f08 dba82de4
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 8 15:56:07 2025 +0900

    Merge pull request #713 from sbintuitions/ray/add-sbint-translation-2025-12-04

    ray: `sbint-translation-2025-12-04:7b-sft` を stg に追加

commit 12220f083e7403c0ff37fc9dc458751a46caa699
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Mon Dec 8 15:32:57 2025 +0900

    【PoC】CloudFront→API Gateway移行  (#711)

    * PoC: CloudFront→API Gateway移行

    * fix: バージョンアップしてSTREAMに対応した。

commit 1004129cd8b5b05e9560c9f52e9826ed8a1ef9cc
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Mon Dec 8 15:25:49 2025 +0900

    fix: backup_planの変数指定が不十分でdiffが出ていたため修正 (#712)

commit 80d585681f484d5225830274cad722882dcf0749
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 8 15:09:03 2025 +0900

    add:自動ワークフローをトリガーするタグ名の追加

commit dba82de46d37ac359a7d24709bf2016f9f98f18e
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 8 15:04:58 2025 +0900

    feat: add sbint-translation-2025-12-04:7b-sft

    Signed-off-by: Junichi Sato <junichi.sato@sbintuitions.co.jp>

commit 9756ff587ac940679817706ad7760e25f9e1b76b (tag: sbkk-prod-release-20251208-1)
Merge: 4e6d291e 3622e9eb
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 8 11:39:23 2025 +0900

    Merge pull request #707 from sbintuitions/feat/control-backend

    feat:devのbackend.tfをterraformで管理

commit 4e6d291eb078b660b01a162fb7c54c5c5e62fc4d
Merge: f8bd0160 d4047277
Author: Junichi Sato <junichi.sato@sbintuitions.co.jp>
Date:   Mon Dec 8 11:14:52 2025 +0900

    Merge pull request #696 from sbintuitions/ray/scaledown-ray-head

    ray: Ray head用EC2 instanceをスケールダウン

commit 3622e9eb1240cfdf591b56febe00a40a4dbe9f64
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 8 10:14:56 2025 +0900

    change:pathの参照方法を変更

commit bb161a6aeebce223943a2f30b477ac6ce1ca1d44
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Mon Dec 8 10:14:38 2025 +0900

    remove:不要なvariablesを削除

commit f8bd0160f4f4b0d190cb28ea57d21fe2c01e39d5 (tag: b2b-prod-ext-release-20251208-2)
Merge: 0c446492 6c8c3d4d
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Mon Dec 8 10:08:02 2025 +0900

    Merge pull request #709 from sbintuitions/fix/client_secret

    [vdev, stg][ray-dashboard] client secret を更新

commit 0c4464922f63772589505a672405de03f6f1aaa0
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Mon Dec 8 10:05:38 2025 +0900

    Update B2B API keys (#706)

    - Stageと同じ2つのAPI keyを廃止
    - QA team向けのAPI keyを30追加
      - 負荷試験のために必要とのこと
      - 将来的にはrate limit無制限でテストできるようにしたいが、
        急ぎとのことなのでkeyを発行して対応する
    - Infra team向けのAPI keyを1つ追加
    - 今後、monitoringなどの目的でAPI keyが使われるのを見越して
      事前に4つの内部利用向けAPI keyを追加

commit fe2cff40077fd73658d84034d72648e8e62ac8a4
Author: tatsuya-hayashino <tatsuya.hayashino@sbintuitions.co.jp>
Date:   Mon Dec 8 09:56:25 2025 +0900

    Fix app-router desired_count in B2B prod (#710)

commit 39a2665532b6b8aa1fbf9605e20e64bb7484724a
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 14:43:45 2025 +0900

    remove:不要なvariableは削除

commit 0d263ece825d7917baa624db4b6d82bdc7632192
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 14:40:52 2025 +0900

    feat:backend.tf管理をmodule化

commit f803fea6bdea4549c23c5c403f33dfe1eb02ada0 (tag: stg-20251208-nightly, tag: sbkk-prod-ext-release-20251208-1)
Merge: f345c9b3 cecbe54f
Author: Yuya Kusuzawa <100104413+YuyaKUSUZAWA@users.noreply.github.com>
Date:   Fri Dec 5 14:31:59 2025 +0900

    Merge pull request #701 from sbintuitions/feat/dev_ext_b2b_api

    [dev_ext][b2b] APIサーバーの構築

commit 6c8c3d4de21fb69fe688cb7f6e3eb1291a4895bc
Author: YuyaKUSUZAWA <yuya.kusuzawa@sbintuitions.co.jp>
Date:   Fri Dec 5 14:29:11 2025 +0900

    client secret を更新

commit cecbe54f0b6311e5f3b5a25d8a08bd79cdc8dd62
Author: YuyaKUSUZAWA <yuya.kusuzawa@sbintuitions.co.jp>
Date:   Wed Dec 3 18:58:58 2025 +0900

    fix: embedding rate limit

commit c78eaa07dc370c54749f2ecc887e36b8fefb2e1c
Author: YuyaKUSUZAWA <yuya.kusuzawa@sbintuitions.co.jp>
Date:   Wed Dec 3 18:31:52 2025 +0900

    fix: proxy ip intr

commit 6b1a4486cc620354a6deab63544b8e95ceba9e6d
Author: YuyaKUSUZAWA <yuya.kusuzawa@sbintuitions.co.jp>
Date:   Wed Dec 3 18:13:22 2025 +0900

    [ext]dev b2b api環境の構築

commit aad62dd9d6c5596a61a6a6375cb4d2bddd15460a
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 13:55:27 2025 +0900

    refactor:ブロックのローカル名を変更

commit ceb539e593a8918ecce4cba08ed55da226fdefb0
Merge: 11db15ac f345c9b3
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 13:45:30 2025 +0900

    Merge branch 'main' into feat/control-backend

commit 11db15ac0ec83f2458f445cf05fd2847652c1a46
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 13:42:21 2025 +0900

    change:lockファイルの更新

commit 8181029447aefa91444524002fd54c6e885fc519
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 13:39:38 2025 +0900

    add:local用のproviders設定を追加

commit 481ccc8792ff004650c67cffd6c19b339e89d551
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 13:39:16 2025 +0900

    fix:フォーマットの修正

commit 1507cc413cb052e937a709027ae42ee2487467f4
Author: KyotaroNakajima <kyotaro.nakajima@sbintuitions.co.jp>
Date:   Fri Dec 5 10:49:55 2025 +0900

    feat:devのbackend.tfをterraformで管理

commit f345c9b3f7cbc9a8cfb36f49d670494127795ccf
Merge: 4ceb6c14 5fe3c08d
Author: Yugo Omura <yugo.omura@sbintuitions.co.jp>
Date:   Fri Dec 5 10:01:49 2025 +0900

    Merge pull request #704 from sbintuitions/feat/format-json-tftpl

    refactor: format `*.json.tftpl` with JSON format

commit 9c51df3120e067d0114c8509ae44b0853268c6a2
Author: 丁 乾 <qian.ding@sbintuitions.co.jp>
Date:   Fri Dec 5 09:28:15 2025 +0900

    load test

commit 4ceb6c14a92fe0957c0e32534a9e22d8990dfc91 (tag: stg-20251205-nightly)

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ terraform init
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing modules...
- conversation_media_s3 in ..\..\modules\conversation-media-s3
- coversation_media_meta_dynamo_db in ..\..\modules\coversation-media-meta-dynamo-db
- dynamo_db in ..\..\modules\dynamo-db
- ecr in ..\..\modules\stack-ecr
- ecr.ecr_repos_for_application in ..\..\modules\ecr-repo
- ecr.ecr_repos_for_datadog in ..\..\modules\ecr-repo
- ecr.ecr_repos_for_lambda in ..\..\modules\ecr-repo
- ecr_replication_event_handler in ..\..\modules\stack-ecr-replication-event-handler
- ecr_replication_event_handler.event_bridge_for_ecr_replication in ..\..\modules\event-bridge-for-ecr-replication
- ecs_cluster in ..\..\modules\ecs-cluster
- ecs_cron_task in ..\..\modules\ecs-cron-task
- iam_roles_for_github_actions_for_main in ..\..\modules\stack-iam-roles-for-github-actions-for-main
- iam_roles_for_github_actions_for_main.iam_role_for_github_actions_to_update_infrastructure in ..\..\modules\iam-role-for-github-actions
- iam_roles_for_github_actions_for_main.iam_role_for_github_actions_to_update_s3 in ..\..\modules\iam-role-for-github-actions
- internal_albs in ..\..\modules\lb
- internal_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_ext_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_ext_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_ext_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_lb_listener_rules in ..\..\modules\lb-listener-rule
- kinesis_firehose_datadog_log_forwarder in ..\..\modules\kinesis-firehose-datadog-log-forwarder
- kinesis_firehose_s3_pipeline in ..\..\modules\kinesis-firehose-s3-pipeline
- lambda_ecr_event_handler in ..\..\modules\event-bridge-for-lambda-ecr-push-replication
- news_embeddings_uploader in ..\..\modules\news-embeddings-uploader
- private_ecs_services in ..\..\modules\ecs-service
- public_ecs_services in ..\..\modules\ecs-service
- s3_buckets_for_web in ..\..\modules\stack-s3-buckets-for-web
- s3_tfstate in ..\..\modules\s3-bucket-tfstate
- startup_task_dynamo_db in ..\..\modules\startup-task-dynamo-db
Initializing provider plugins...
- Reusing previous version of hashicorp/external from the dependency lock file
- Reusing previous version of hashicorp/local from the dependency lock file
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/archive from the dependency lock file
- Installing hashicorp/local v2.6.1...
- Installed hashicorp/local v2.6.1 (signed by HashiCorp)
- Installing hashicorp/aws v6.24.0...
- Installed hashicorp/aws v6.24.0 (signed by HashiCorp)
- Installing hashicorp/archive v2.7.1...
- Installed hashicorp/archive v2.7.1 (signed by HashiCorp)
- Installing hashicorp/external v2.3.5...
- Installed hashicorp/external v2.3.5 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-1
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-050451382758-tfstate]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-050451382758-tfstate]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
data.aws_vpc.reimei_rag_main_vpc: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 1s [id=subnet-0f352bd385624c1d6]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 0s [id=3839833292]
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_function.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-handler]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_target.events_target: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_permission.event_bridge_can_invoke_lambda: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-for-ecr-replication]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan.
Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform planned the following actions, but then encountered a problem:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known afterapply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

Plan: 18 to add, 6 to change, 4 to destroy.
╷
│ Error: Cannot import non-existent remote object
│
│ While attempting to import an existing object to
│ "module.s3_tfstate.aws_s3_bucket.tfstate_bucket", the provider detected that no
│ object exists with the given id. Only pre-existing objects can be imported; check
│ that the id is correct and that it is associated with the provider's configured
│ region or endpoint, or use "terraform apply" to create a new remote object for
│ this resource.
╵

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ export AWS_PROFILE=AWSAdministratorAccess-050451382758

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-1
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-050451382758-tfstate]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-050451382758-tfstate]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
data.aws_vpc.reimei_rag_main_vpc: Reading...
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 0s [id=vpc-07758e1658c4c2149]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 1s [id=3839833292]
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_function.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-handler]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 0s [id=1647662257]
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_target.events_target: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_permission.event_bridge_can_invoke_lambda: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-for-ecr-replication]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan.
Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform planned the following actions, but then encountered a problem:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known afterapply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

Plan: 18 to add, 6 to change, 4 to destroy.
╷
│ Error: Cannot import non-existent remote object
│
│ While attempting to import an existing object to
│ "module.s3_tfstate.aws_s3_bucket.tfstate_bucket", the provider detected that no
│ object exists with the given id. Only pre-existing objects can be imported; check
│ that the id is correct and that it is associated with the provider's configured
│ region or endpoint, or use "terraform apply" to create a new remote object for
│ this resource.
╵

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ aws configure sso
SSO session name [prod]: prod
There are 2 AWS accounts available to you.
Using the account ID 050451382758
The only role available to you is: AWSAdministratorAccess
Using the role name "AWSAdministratorAccess"
Default client Region [None]:
CLI default output format (json if not specified) [None]:
To use this profile, specify the profile name using --profile, as shown:

aws sts get-caller-identity --profile AWSAdministratorAccess-050451382758

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ aws s3 ls
2025-05-07 19:10:27 cs-summ-prod-internal-alb-access-log
2025-05-07 19:10:45 cs-summ-prod-internal-alb-connection-log
2025-11-05 04:47:17 datadog-firehose-backup-prd-050451382758
2025-11-05 05:48:33 infra-sensitive-log-filter-prd-tfstate
2025-11-28 11:42:43 reimei-b2b-dp-prd-snowflake
2025-11-21 14:32:04 reimei-b2b-prd-050451382758-tfstate
2025-11-27 20:01:12 reimei-b2b-prd-log-analyzer-output
2025-12-03 14:18:59 reimei-b2b-prd-user-action-log
2025-11-04 09:11:10 reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image
2025-11-04 19:43:38 reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result
2025-08-04 16:20:33 reimei-chat-data-pf-prd-tfstate
2025-11-05 03:10:58 reimei-chat-prd-050451382758-frontend-dist
2025-11-04 18:58:52 reimei-chat-prd-050451382758-notes-dist
2025-11-04 08:54:36 reimei-chat-prd-conversation-media
2025-11-04 10:53:22 reimei-chat-prd-dp-snowflake
2025-11-05 04:20:06 reimei-chat-prd-log-analyzer-output
2025-05-09 14:46:12 reimei-chat-prd-tfstate
2025-11-05 05:24:56 reimei-chat-prd-user-action-log
2025-11-04 18:42:13 reimei-chat-snowflake-data-linkage-prd-tfstate
2025-05-09 21:07:34 reimei-engine-prd-hf-models
2025-11-07 10:52:20 reimei-engine-ray-prd-llm-serve-config
2025-05-22 19:52:18 reimei-engine-ray-prd-tfstate
2025-11-04 10:21:05 reimei-web-prd-tfstate
2025-04-09 19:46:02 sbint-kusuzawatest-prod
2025-05-26 15:54:23 sbint-lb-logs
2025-11-05 04:07:32 sbint-service-prd-network-tfstate
2025-06-01 14:59:32 sbint-service-prod-vpc-flow-log

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-1
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-050451382758-tfstate]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
data.aws_vpc.reimei_rag_main_vpc: Reading...
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-050451382758-tfstate]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 1s [id=subnet-069e61778a428e032]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 1s [id=subnet-07a1e2ac6b7f74854]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 0s [id=3839833292]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_function.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-handler]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_target.events_target: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_permission.event_bridge_can_invoke_lambda: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-for-ecr-replication]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan.
Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform planned the following actions, but then encountered a problem:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known afterapply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

Plan: 18 to add, 6 to change, 4 to destroy.
╷
│ Error: Cannot import non-existent remote object
│
│ While attempting to import an existing object to
│ "module.s3_tfstate.aws_s3_bucket.tfstate_bucket", the provider detected that no
│ object exists with the given id. Only pre-existing objects can be imported; check
│ that the id is correct and that it is associated with the provider's configured
│ region or endpoint, or use "terraform apply" to create a new remote object for
│ this resource.
╵

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ env | grep AWS
AWS_EXECUTION_ENV=EC2
AWS_PROFILE=AWSAdministratorAccess-050451382758
ORIGINAL_PATH=/mingw64/bin:/usr/bin:/c/Users/prod.shogo.kagami/bin:/c/Windows/system32:/c/Windows:/c/Windows/System32/Wbem:/c/Windows/System32/WindowsPowerShell/v1.0:/c/Windows/System32/OpenSSH:/c/Program Files/Amazon/cfn-bootstrap:/c/Program Files/PuTTY:/cmd:/c/Program Files/WinMerge:/c/Program Files/Amazon/AWSCLIV2:/c/Users/prod.shogo.kagami/AppData/Local/Microsoft/WindowsApps
PATH=/c/Users/prod.shogo.kagami/bin:/mingw64/bin:/usr/local/bin:/usr/bin:/bin:/mingw64/bin:/usr/bin:/c/Users/prod.shogo.kagami/bin:/c/Windows/system32:/c/Windows:/c/Windows/System32/Wbem:/c/Windows/System32/WindowsPowerShell/v1.0:/c/Windows/System32/OpenSSH:/c/Program Files/Amazon/cfn-bootstrap:/c/Program Files/PuTTY:/cmd:/c/Program Files/WinMerge:/c/Program Files/Amazon/AWSCLIV2:/c/Users/prod.shogo.kagami/AppData/Local/Microsoft/WindowsApps:/usr/bin/vendor_perl:/usr/bin/core_perl

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ aws s3 ls
2025-05-07 19:10:27 cs-summ-prod-internal-alb-access-log
2025-05-07 19:10:45 cs-summ-prod-internal-alb-connection-log
2025-11-05 04:47:17 datadog-firehose-backup-prd-050451382758
2025-11-05 05:48:33 infra-sensitive-log-filter-prd-tfstate
2025-11-28 11:42:43 reimei-b2b-dp-prd-snowflake
2025-11-21 14:32:04 reimei-b2b-prd-050451382758-tfstate
2025-11-27 20:01:12 reimei-b2b-prd-log-analyzer-output
2025-12-03 14:18:59 reimei-b2b-prd-user-action-log
2025-11-04 09:11:10 reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image
2025-11-04 19:43:38 reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result
2025-08-04 16:20:33 reimei-chat-data-pf-prd-tfstate
2025-11-05 03:10:58 reimei-chat-prd-050451382758-frontend-dist
2025-11-04 18:58:52 reimei-chat-prd-050451382758-notes-dist
2025-11-04 08:54:36 reimei-chat-prd-conversation-media
2025-11-04 10:53:22 reimei-chat-prd-dp-snowflake
2025-11-05 04:20:06 reimei-chat-prd-log-analyzer-output
2025-05-09 14:46:12 reimei-chat-prd-tfstate
2025-11-05 05:24:56 reimei-chat-prd-user-action-log
2025-11-04 18:42:13 reimei-chat-snowflake-data-linkage-prd-tfstate
2025-05-09 21:07:34 reimei-engine-prd-hf-models
2025-11-07 10:52:20 reimei-engine-ray-prd-llm-serve-config
2025-05-22 19:52:18 reimei-engine-ray-prd-tfstate
2025-11-04 10:21:05 reimei-web-prd-tfstate
2025-04-09 19:46:02 sbint-kusuzawatest-prod
2025-05-26 15:54:23 sbint-lb-logs
2025-11-05 04:07:32 sbint-service-prd-network-tfstate
2025-06-01 14:59:32 sbint-service-prod-vpc-flow-log

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ ls
README.md   deploy_prod_infra.sh*                    moved-by-alb-added.tf                 secrets.json      versions.tf
backend.tf  lambda_function_for_ecr_replication.zip  moved-by-lb-listener-rule-changes.tf  terraform.tfvars
data.tf     main.tf                                  moved-by-lb-refactoring.tf            variables.tf

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ vi  main.tf

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-1
❌ ERROR: Working directory has changes since tag 'sbkk-prod-release-20251224-1'.
Please ensure you are deploying from a clean state that matches the tag.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ terraform init
Initializing the backend...
Initializing modules...
Initializing provider plugins...
- Reusing previous version of hashicorp/external from the dependency lock file
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/local from the dependency lock file
- Reusing previous version of hashicorp/archive from the dependency lock file
- Using previously-installed hashicorp/external v2.3.5
- Using previously-installed hashicorp/aws v6.24.0
- Using previously-installed hashicorp/local v2.6.1
- Using previously-installed hashicorp/archive v2.7.1

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ terraform plan
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.data.external.build[0]: Reading...
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-tfstate]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-tfstate]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
data.aws_vpc.reimei_rag_main_vpc: Reading...
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 0s [id=3839833292]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform planned the following actions, but then encountered a problem:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known afterapply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

  # module.s3_tfstate.aws_s3_bucket.tfstate_bucket must be replaced
  # (imported from "reimei-chat-prd-tfstate")
  # Warning: this will destroy the imported resource
-/+ resource "aws_s3_bucket" "tfstate_bucket" {
      + acceleration_status         = (known after apply)
      + acl                         = (known after apply)
      ~ arn                         = "arn:aws:s3:::reimei-chat-prd-tfstate" -> (known after apply)
      ~ bucket                      = "reimei-chat-prd-tfstate" -> "reimei-chat-prd-050451382758-tfstate" # forces replacement
      ~ bucket_domain_name          = "reimei-chat-prd-tfstate.s3.amazonaws.com" -> (known after apply)
      + bucket_prefix               = (known after apply)
      ~ bucket_region               = "ap-northeast-1" -> (known after apply)
      ~ bucket_regional_domain_name = "reimei-chat-prd-tfstate.s3.ap-northeast-1.amazonaws.com" -> (known after apply)
        force_destroy               = false
      ~ hosted_zone_id              = "Z2M4EHUR26P7ZW" -> (known after apply)
      ~ id                          = "reimei-chat-prd-tfstate" -> (known after apply)
      ~ object_lock_enabled         = false -> (known after apply)
      + policy                      = (known after apply)
        region                      = "ap-northeast-1"
      ~ request_payer               = "BucketOwner" -> (known after apply)
      - tags                        = {} -> null
      ~ tags_all                    = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + website_domain              = (known after apply)
      + website_endpoint            = (known after apply)

      ~ cors_rule (known after apply)

      ~ grant (known after apply)
      - grant {
          - id          = "aba2623a7e748e27b1f7d715c83e5307c9773c6b5c706fa453e238831b00e4e3" -> null
          - permissions = [
              - "FULL_CONTROL",
            ] -> null
          - type        = "CanonicalUser" -> null
            uri         = null
        }

      ~ lifecycle_rule (known after apply)

      ~ logging (known after apply)

      ~ object_lock_configuration (known after apply)

      ~ replication_configuration (known after apply)

      ~ server_side_encryption_configuration (known after apply)
      - server_side_encryption_configuration {
          - rule {
              - bucket_key_enabled = true -> null

              - apply_server_side_encryption_by_default {
                    kms_master_key_id = null
                  - sse_algorithm     = "AES256" -> null
                }
            }
        }

      ~ versioning (known after apply)
      - versioning {
          - enabled    = true -> null
          - mfa_delete = false -> null
        }

      ~ website (known after apply)
    }

  # module.s3_tfstate.aws_s3_bucket_versioning.versioning_tfstate_bucket will be created
  + resource "aws_s3_bucket_versioning" "versioning_tfstate_bucket" {
      + bucket = (known after apply)
      + id     = (known after apply)
      + region = "ap-northeast-1"

      + versioning_configuration {
          + mfa_delete = (known after apply)
          + status     = "Enabled"
        }
    }

  # module.s3_tfstate.local_file.backend will be created
  + resource "local_file" "backend" {
      + content              = (known after apply)
      + content_base64sha256 = (known after apply)
      + content_base64sha512 = (known after apply)
      + content_md5          = (known after apply)
      + content_sha1         = (known after apply)
      + content_sha256       = (known after apply)
      + content_sha512       = (known after apply)
      + directory_permission = "0777"
      + file_permission      = "0644"
      + filename             = "./backend.tf"
      + id                   = (known after apply)
    }

Plan: 1 to import, 21 to add, 6 to change, 5 to destroy.
╷
│ Error: Invalid value for variable
│
│   on variables.tf line 49:
│   49: variable "is_deploying_on_shell_script" {
│     ├────────────────
│     │ var.is_deploying_on_shell_script is false
│
│ Run script `deploy_prod_infra.sh` to execute `terraform apply`
│
│ This was checked by the validation rule at variables.tf:53,3-13.
╵
╷
│ Error: External Program Execution Failed
│
│   with module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.data.external.build[0],
│   on ..\..\modules\event-bridge-for-ecr-replication\main.tf line 62, in data "external" "build":
│   62:   program     = ["sh", "build.sh"]
│
│ The data source received an unexpected error while attempting to execute the program.
│
│ Program: C:\Program Files\Git\usr\bin\sh.exe
│ Error Message: build.sh: line 3: uv: command not found
│
│ State: exit status 1
╵

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224_app/reimei_RAG/terraform/environments/prod ((b2b-fc1-prod-ray-release-20251223-2))
$ cd ~

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ mkdir deploy_20251224-2_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd deploy_20251224-2_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251224-2_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app (main)
$ git clone https://github.com/sbintuitions/reimei_RAG
Cloning into 'reimei_RAG'...
remote: Enumerating objects: 28791, done.
remote: Counting objects: 100% (83/83), done.
remote: Compressing objects: 100% (63/63), done.
remote: Total 28791 (delta 34), reused 41 (delta 20), pack-reused 28708 (from 2)
Receiving objects: 100% (28791/28791), 65.50 MiB | 24.42 MiB/s, done.
Resolving deltas: 100% (19177/19177), done.
Updating files: 100% (1310/1310), done.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app (main)
$ cd reimei_RAG/terraform/environments/prod

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod (main)
$ git switch -d sbkk-prod-release-20251224-2
HEAD is now at 53aa1fa9 fix: terraform backendのtfstate idを修正。

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-2))
$ terraform init
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing modules...
- conversation_media_s3 in ..\..\modules\conversation-media-s3
- coversation_media_meta_dynamo_db in ..\..\modules\coversation-media-meta-dynamo-db
- dynamo_db in ..\..\modules\dynamo-db
- ecr in ..\..\modules\stack-ecr
.\..\modules\iam-role-for-github-actions
- internal_albs in ..\..\modules\lb
- internal_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_ext_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_ext_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_ext_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_lb_listener_rules in ..\..\modules\lb-listener-rule
- kinesis_firehose_datadog_log_forwarder in ..\..\modules\kinesis-firehose-datadog-log-forwarder
- kinesis_firehose_s3_pipeline in ..\..\modules\kinesis-firehose-s3-pipeline
- lambda_ecr_event_handler in ..\..\modules\event-bridge-for-lambda-ecr-push-replication
- news_embeddings_uploader in ..\..\modules\news-embeddings-uploader
- private_ecs_services in ..\..\modules\ecs-service
- public_ecs_services in ..\..\modules\ecs-service
- s3_buckets_for_web in ..\..\modules\stack-s3-buckets-for-web
- s3_tfstate in ..\..\modules\s3-bucket-tfstate
- startup_task_dynamo_db in ..\..\modules\startup-task-dynamo-db
Initializing provider plugins...
- Reusing previous version of hashicorp/local from the dependency lock file
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/external from the dependency lock file
- Reusing previous version of hashicorp/archive from the dependency lock file
- Installing hashicorp/external v2.3.5...
- Installed hashicorp/external v2.3.5 (signed by HashiCorp)
- Installing hashicorp/archive v2.7.1...
- Installed hashicorp/archive v2.7.1 (signed by HashiCorp)
- Installing hashicorp/local v2.6.1...
- Installed hashicorp/local v2.6.1 (signed by HashiCorp)
- Installing hashicorp/aws v6.24.0...
- Installed hashicorp/aws v6.24.0 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-2))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-2
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-tfstate]
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-tfstate]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
data.aws_vpc.reimei_rag_main_vpc: Reading...
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 0s [id=3839833292]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 0s [id=vpc-07758e1658c4c2149]
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 0s [id=subnet-069e61778a428e032]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_function.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-handler]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_target.events_target: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_permission.event_bridge_can_invoke_lambda: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-for-ecr-replication]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform will perform the following actions:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

  # module.s3_tfstate.aws_s3_bucket.tfstate_bucket must be replaced
  # (imported from "reimei-chat-prd-tfstate")
  # Warning: this will destroy the imported resource
-/+ resource "aws_s3_bucket" "tfstate_bucket" {
      + acceleration_status         = (known after apply)
      + acl                         = (known after apply)
      ~ arn                         = "arn:aws:s3:::reimei-chat-prd-tfstate" -> (known after apply)
      ~ bucket                      = "reimei-chat-prd-tfstate" -> "reimei-chat-prd-050451382758-tfstate" # forces replacement
      ~ bucket_domain_name          = "reimei-chat-prd-tfstate.s3.amazonaws.com" -> (known after apply)
      + bucket_prefix               = (known after apply)
      ~ bucket_region               = "ap-northeast-1" -> (known after apply)
      ~ bucket_regional_domain_name = "reimei-chat-prd-tfstate.s3.ap-northeast-1.amazonaws.com" -> (known after apply)
        force_destroy               = false
      ~ hosted_zone_id              = "Z2M4EHUR26P7ZW" -> (known after apply)
      ~ id                          = "reimei-chat-prd-tfstate" -> (known after apply)
      ~ object_lock_enabled         = false -> (known after apply)
      + policy                      = (known after apply)
        region                      = "ap-northeast-1"
      ~ request_payer               = "BucketOwner" -> (known after apply)
      - tags                        = {} -> null
      ~ tags_all                    = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + website_domain              = (known after apply)
      + website_endpoint            = (known after apply)

      ~ cors_rule (known after apply)

      ~ grant (known after apply)
      - grant {
          - id          = "aba2623a7e748e27b1f7d715c83e5307c9773c6b5c706fa453e238831b00e4e3" -> null
          - permissions = [
              - "FULL_CONTROL",
            ] -> null
          - type        = "CanonicalUser" -> null
            uri         = null
        }

      ~ lifecycle_rule (known after apply)

      ~ logging (known after apply)

      ~ object_lock_configuration (known after apply)

      ~ replication_configuration (known after apply)

      ~ server_side_encryption_configuration (known after apply)
      - server_side_encryption_configuration {
          - rule {
              - bucket_key_enabled = true -> null

              - apply_server_side_encryption_by_default {
                    kms_master_key_id = null
                  - sse_algorithm     = "AES256" -> null
                }
            }
        }

      ~ versioning (known after apply)
      - versioning {
          - enabled    = true -> null
          - mfa_delete = false -> null
        }

      ~ website (known after apply)
    }

  # module.s3_tfstate.aws_s3_bucket_versioning.versioning_tfstate_bucket will be created
  + resource "aws_s3_bucket_versioning" "versioning_tfstate_bucket" {
      + bucket = (known after apply)
      + id     = (known after apply)
      + region = "ap-northeast-1"

      + versioning_configuration {
          + mfa_delete = (known after apply)
          + status     = "Enabled"
        }
    }

  # module.s3_tfstate.local_file.backend will be created
  + resource "local_file" "backend" {
      + content              = (known after apply)
      + content_base64sha256 = (known after apply)
      + content_base64sha512 = (known after apply)
      + content_md5          = (known after apply)
      + content_sha1         = (known after apply)
      + content_sha256       = (known after apply)
      + content_sha512       = (known after apply)
      + directory_permission = "0777"
      + file_permission      = "0644"
      + filename             = "./backend.tf"
      + id                   = (known after apply)
    }

Plan: 1 to import, 21 to add, 6 to change, 5 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: no

Apply cancelled.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-2_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-2))
$ cd ~

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ mkdir deploy_20251224-3_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~ (main)
$ cd deploy_20251224-3_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251224-3_app

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app (main)
$ git clone https://github.com/sbintuitions/reimei_RAG
Cloning into 'reimei_RAG'...
remote: Enumerating objects: 28797, done.
remote: Counting objects: 100% (89/89), done.
remote: Compressing objects: 100% (64/64), done.
remote: Total 28797 (delta 39), reused 50 (delta 25), pack-reused 28708 (from 2)
Receiving objects: 100% (28797/28797), 65.51 MiB | 15.83 MiB/s, done.
Resolving deltas: 100% (19181/19181), done.
Updating files: 100% (1310/1310), done.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app (main)
$ cd reimei_RAG/terraform/environments/prod

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod (main)
$ pwd
/c/Users/prod.shogo.kagami/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod (main)
$ git switch -d sbkk-prod-release-20251224-3
HEAD is now at 38ce403f fix: fix tfstate bucket id.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-3))
$ terraform init
Initializing the backend...

Successfully configured the backend "s3"! Terraform will automatically
use this backend unless the backend configuration changes.
Initializing modules...
- conversation_media_s3 in ..\..\modules\conversation-media-s3
- coversation_media_meta_dynamo_db in ..\..\modules\coversation-media-meta-dynamo-db
- dynamo_db in ..\..\modules\dynamo-db
- ecr in ..\..\modules\stack-ecr
- ecr.ecr_repos_for_application in ..\..\modules\ecr-repo
- ecr.ecr_repos_for_datadog in ..\..\modules\ecr-repo
- ecr.ecr_repos_for_lambda in ..\..\modules\ecr-repo
- ecr_replication_event_handler in ..\..\modules\stack-ecr-replication-event-handler
- ecr_replication_event_handler.event_bridge_for_ecr_replication in ..\..\modules\event-bridge-for-ecr-replication
- ecs_cluster in ..\..\modules\ecs-cluster
- ecs_cron_task in ..\..\modules\ecs-cron-task
- iam_roles_for_github_actions_for_main in ..\..\modules\stack-iam-roles-for-github-actions-for-main
- iam_roles_for_github_actions_for_main.iam_role_for_github_actions_to_update_infrastructure in ..\..\modules\iam-role-for-github-actions
- iam_roles_for_github_actions_for_main.iam_role_for_github_actions_to_update_s3 in ..\..\modules\iam-role-for-github-actions
- internal_albs in ..\..\modules\lb
- internal_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway in ..\..\modules\stack-internal-api-gateway
- internal_ext_api_gateway.external_to_ecs_lb in ..\..\modules\lb-listener-rule
- internal_ext_api_gateway.lb_attached_to_ecs in ..\..\modules\lb
- internal_ext_api_gateway.lb_faced_to_external in ..\..\modules\lb
- internal_ext_api_gateway.listener_rules_to_ecs in ..\..\modules\lb-listener-rule
- internal_lb_listener_rules in ..\..\modules\lb-listener-rule
- kinesis_firehose_datadog_log_forwarder in ..\..\modules\kinesis-firehose-datadog-log-forwarder
- kinesis_firehose_s3_pipeline in ..\..\modules\kinesis-firehose-s3-pipeline
- lambda_ecr_event_handler in ..\..\modules\event-bridge-for-lambda-ecr-push-replication
- news_embeddings_uploader in ..\..\modules\news-embeddings-uploader
- private_ecs_services in ..\..\modules\ecs-service
- public_ecs_services in ..\..\modules\ecs-service
- s3_buckets_for_web in ..\..\modules\stack-s3-buckets-for-web
- s3_tfstate in ..\..\modules\s3-bucket-tfstate
- startup_task_dynamo_db in ..\..\modules\startup-task-dynamo-db
Initializing provider plugins...
- Reusing previous version of hashicorp/aws from the dependency lock file
- Reusing previous version of hashicorp/external from the dependency lock file
- Reusing previous version of hashicorp/archive from the dependency lock file
- Reusing previous version of hashicorp/local from the dependency lock file
- Installing hashicorp/aws v6.24.0...
- Installed hashicorp/aws v6.24.0 (signed by HashiCorp)
- Installing hashicorp/external v2.3.5...
- Installed hashicorp/external v2.3.5 (signed by HashiCorp)
- Installing hashicorp/archive v2.7.1...
- Installed hashicorp/archive v2.7.1 (signed by HashiCorp)
- Installing hashicorp/local v2.6.1...
- Installed hashicorp/local v2.6.1 (signed by HashiCorp)

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-3))
$ ./deploy_prod_infra.sh --tag sbkk-prod-release-20251224-3
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
data.aws_iam_policy_document.image_bucket_policy[0]: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_repository.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.ecs_cluster.data.aws_iam_policy_document.assume_events_role: Read complete after 0s [id=2084274819]
module.kinesis_firehose_s3_pipeline.aws_s3_bucket.bucket: Refreshing state... [id=reimei-chat-prd-user-action-log]
module.s3_buckets_for_web.aws_s3_bucket.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.conversation_media_s3.aws_s3_bucket.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
data.aws_iam_policy_document.image_bucket_policy[0]: Read complete after 0s [id=1286698931]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role]
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.main_account: Read complete after 0s [id=3060718730]
data.aws_subnet.reimei_rag_vpc_subnet_private02: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Reading...
module.s3_tfstate.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
data.aws_subnet.reimei_rag_vpc_subnet_private03: Reading...
data.aws_vpc.reimei_rag_main_vpc: Reading...
module.kinesis_firehose_s3_pipeline.aws_iam_role.firehose_role: Refreshing state... [id=reimei-chat-prd-firehose-role]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private02: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["app-router"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["backend"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_group.firehose: Refreshing state... [id=/aws/kinesisfirehose/DatadogCWLogsforwarder]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.assume_firehose: Read complete after 0s [id=414810265]
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_application["conversation-history"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Reading...
aws_s3_bucket.log_analyzer_output: Refreshing state... [id=reimei-chat-prd-log-analyzer-output]
module.news_embeddings_uploader.data.aws_iam_policy_document.assume_role_policy: Read complete after 0s [id=2690255455]
module.conversation_media_s3.aws_iam_role.guardduty_malware_role: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket.backup: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
module.ecr.module.ecr_repos_for_application["log-analyzer"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
data.aws_subnet.reimei_rag_vpc_subnet_private01: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
aws_iam_policy.reuters_news_s3_read_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
data.aws_subnet.reimei_rag_vpc_subnet_relay01: Read complete after 1s [id=subnet-069e61778a428e032]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Reading...
data.aws_subnet.reimei_rag_vpc_subnet_private03: Read complete after 1s [id=subnet-07a1e2ac6b7f74854]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_policy.github_actions_policies["terraform-execution"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-terraform-execution-policy-to-update-infrastructure]
module.news_embeddings_uploader.data.aws_s3_bucket.news_bucket: Read complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.ecs_cron_task.aws_iam_role.eventbridge_scheduler_role: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role]
data.aws_subnet.reimei_rag_vpc_subnet_private01: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_group.this: Refreshing state... [id=/kinesisfirehose/reimei-chat-prd/fluentbit-to-s3]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.startup_task_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=CompletedStartupTask]
module.dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationHistory]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication]
data.aws_vpc.reimei_rag_main_vpc: Read complete after 1s [id=vpc-07758e1658c4c2149]
module.ecr.aws_ecr_pull_through_cache_rule.datadog: Refreshing state... [id=reimei-chat-prd/datadog]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Reading...
module.ecs_cluster.aws_service_discovery_http_namespace.this: Refreshing state... [id=ns-cosw6lqiwsvhia4o]
module.lambda_ecr_event_handler.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.lambda_ecr_event_handler.aws_iam_role.lambda_exec: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda]
module.coversation_media_meta_dynamo_db.aws_dynamodb_table.this: Refreshing state... [id=ConversationMediaMeta]
data.aws_vpc_endpoint_service.kinesis_firehose: Reading...
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Preparing import... [id=reimei-chat-prd-tfstate]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Refreshing state... [id=reimei-chat-prd-tfstate]
module.news_embeddings_uploader.data.aws_caller_identity.current: Reading...
module.news_embeddings_uploader.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
aws_secretsmanager_secret.this: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1]
module.conversation_media_s3.data.aws_caller_identity.current: Reading...
module.conversation_media_s3.data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Reading...
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].data.aws_ecr_lifecycle_policy_document.this: Read complete after 0s
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_repository.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecs_cluster.aws_iam_role.eventbridge_to_monitoring_role: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role]
aws_s3_bucket_policy.cf_access[0]: Refreshing state... [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-image]
data.aws_vpc_endpoint_service.kinesis_firehose: Read complete after 1s [id=3839833292]
module.ecr_replication_event_handler.aws_iam_role.deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment]
module.conversation_media_s3.aws_s3_bucket_lifecycle_configuration.s3_bucket_lifecycle: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_public_access_block.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.aws_s3_bucket_ownership_controls.conversation_media: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Reading...
module.conversation_media_s3.data.aws_iam_policy_document.conversation_media_cf[0]: Read complete after 0s [id=2037906730]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role.firehose_role: Refreshing state... [id=firehose-to-datadog-log-forwarder-role]
module.kinesis_firehose_s3_pipeline.aws_iam_policy.firehose_to_s3_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-firehose-to-s3-policy]
module.kinesis_firehose_datadog_log_forwarder.aws_cloudwatch_log_stream.firehose: Refreshing state... [id=Delivery]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
module.s3_buckets_for_web.aws_s3_bucket_public_access_block.dist_buckets["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecr.module.ecr_repos_for_datadog["datadog/agent"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=reimei-chat-prd/datadog/agent]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure]
module.kinesis_firehose_s3_pipeline.aws_cloudwatch_log_stream.this: Refreshing state... [id=S3Delivery]
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Reading...
module.kinesis_firehose_datadog_log_forwarder.data.aws_iam_policy_document.firehose_policy: Read complete after 0s [id=1985362322]
module.kinesis_firehose_datadog_log_forwarder.aws_s3_bucket_lifecycle_configuration.expire: Refreshing state... [id=datadog-firehose-backup-prd-050451382758]
aws_security_group.vpc_endpoint_sg: Refreshing state... [id=sg-0e3582fcaedd7bb81]
module.ecs_cluster.aws_ecs_cluster.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:cluster/reimei-chat-prd]
aws_secretsmanager_secret_version.latest: Refreshing state... [id=arn:aws:secretsmanager:ap-northeast-1:050451382758:secret:reimei-chat-prd-VY7zh1|terraform-20250930095317748000000001]
module.ecr.module.ecr_repos_for_lambda["lambda/file-parser"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/file-parser]
module.ecr.module.ecr_repos_for_lambda["lambda/deploy-lambda"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/deploy-lambda]
module.ecr.module.ecr_repos_for_lambda["lambda/news-embeddings-uploader"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader]
module.ecr.module.ecr_repos_for_application["conversation-history"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/conversation-history]
module.ecr.module.ecr_repos_for_application["fluent-bit"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/fluent-bit]
module.ecr.module.ecr_repos_for_application["log-analyzer"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/log-analyzer]
module.ecr.module.ecr_repos_for_application["app-router"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/app-router]
module.ecr.module.ecr_repos_for_application["backend"].aws_ecr_lifecycle_policy.this: Refreshing state... [id=sbint-services/reimei-chat-prd/backend]
module.conversation_media_s3.aws_s3_bucket_policy.conversation_media[0]: Refreshing state... [id=reimei-chat-prd-conversation-media]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094412697100000001]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.lambda_basic_execution: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole]
data.aws_iam_policy_document.s3_main_policies["frontend"]: Reading...
data.aws_iam_policy_document.s3_main_policies["frontend"]: Read complete after 0s [id=171918781]
data.aws_iam_policy_document.s3_main_policies["notes"]: Reading...
data.aws_iam_policy_document.s3_main_policies["notes"]: Read complete after 0s [id=886276654]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this_v2: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3-v2]
module.kinesis_firehose_s3_pipeline.aws_kinesis_firehose_delivery_stream.this: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/fluentbit-to-s3]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_policy.firehose_policy: Refreshing state... [id=arn:aws:iam::050451382758:policy/firehose-to-datadog-log-forwarder-policy]
module.conversation_media_s3.aws_guardduty_malware_protection_plan.conversation_media: Refreshing state... [id=aeccab947287da18df14]
module.conversation_media_s3.aws_iam_role_policy.guardduty_malware_policy: Refreshing state... [id=reimei-chat-prd-guardduty-malware-role:terraform-20250828104005347700000001]
aws_vpc_endpoint.firehose: Refreshing state... [id=vpce-01f5204f12ecf6758]
module.ecs_cluster.aws_cloudwatch_log_group.ecs_deployment_status: Refreshing state... [id=/ecs/reimei-chat-prd/deployment-status/]
module.ecs_cluster.aws_cloudwatch_event_rule.ecs_deployment_status_change: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change]
module.kinesis_firehose_s3_pipeline.aws_iam_role_policy_attachment.attach_firehose_policy: Refreshing state... [id=reimei-chat-prd-firehose-role-20250520071608819800000002]
aws_s3_bucket_policy.dist_policies["notes"]: Refreshing state... [id=reimei-chat-prd-050451382758-notes-dist]
aws_s3_bucket_policy.dist_policies["frontend"]: Refreshing state... [id=reimei-chat-prd-050451382758-frontend-dist]
module.ecs_cluster.aws_iam_role_policy.allow_put_events_to_monitoring: Refreshing state... [id=reimei-chat-prd-eventbridge-to-monitoring-role:reimei-chat-prd-allow-put-events-to-monitoring]
module.kinesis_firehose_datadog_log_forwarder.aws_kinesis_firehose_delivery_stream.datadog: Refreshing state... [id=arn:aws:firehose:ap-northeast-1:050451382758:deliverystream/DatadogCWLogsforwarder]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Reading...
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Reading...
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_policy.assume_role: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-lambda-assume-role-for-ecr-replication]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_function.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-handler]
module.internal_ext_api_gateway["tenant"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecs_cluster.aws_cloudwatch_event_target.cloud_watch_logs: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250604065054759500000001]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-07a1e2ac6b7f74854"]: Read complete after 0s [id=subnet-07a1e2ac6b7f74854]
module.ecs_cluster.aws_cloudwatch_event_target.forward_target: Refreshing state... [id=reimei-chat-prd-capture-ecs-deployment-status-change-terraform-20250805101205571600000001]
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Reading...
module.ecs_cluster.data.aws_iam_policy_document.cloudwatch_logs: Read complete after 0s [id=2948898747]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_infrastructure.aws_iam_role_policy_attachment.github_ecr_attachment["terraform-execution"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-infrastructure-20250805101205862600000002]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-051ac932c7f0b27c6"]: Read complete after 0s [id=subnet-051ac932c7f0b27c6]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_policy.github_actions_policies["update-s3"]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-github-actions-update-s3-policy-to-update-s3]
module.internal_ext_api_gateway["tenant"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role.github_actions_role: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3]
module.internal_api_gateway["api"].data.aws_subnet.this["subnet-0f352bd385624c1d6"]: Read complete after 0s [id=subnet-0f352bd385624c1d6]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy.cwl_to_firehose: Refreshing state... [id=cwl-to-firehose-role:terraform-20250828104036396400000002]
module.internal_api_gateway["api"].module.external_to_ecs_lb.aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_replicate[0]: Read complete after 1s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.replication[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Reading...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.describe_ecr_images_for_push: Read complete after 0s [id=1647662257]
module.lambda_ecr_event_handler.aws_cloudwatch_event_rule.push: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda]
module.lambda_ecr_event_handler.aws_lambda_function.this: Refreshing state... [id=deploy-lambda]
module.ecs_cluster.aws_cloudwatch_log_resource_policy.ecs_development_status_publishing: Refreshing state... [id=reimei-chat-prd-ecs-development-status-publishing-policy]
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Reading...
module.ecr_replication_event_handler.data.aws_iam_policy_document.list_ecr_images: Read complete after 0s [id=404591031]
module.kinesis_firehose_datadog_log_forwarder.aws_iam_role_policy_attachment.firehose_attach: Refreshing state... [id=firehose-to-datadog-log-forwarder-role-20250828104005857400000001]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_replicate[0]: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.lambda_ecr_event_handler.aws_iam_policy.describe_ecr_images_for_push: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_rule.this: Refreshing state... [id=reimei-chat-prd-ecr-replication-events]
module.ecr_replication_event_handler.aws_iam_policy.list_ecr_images: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-list-ecr-images]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-02b0f8721a370b47c]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-097e172093682fc66]
module.internal_albs["app-router"].aws_security_group.lb: Refreshing state... [id=sg-063e087c1e23a31ef]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_security_group.lb: Refreshing state... [id=sg-06cf7f7e59ca5eb01]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_security_group.lb: Refreshing state... [id=sg-0cd9f11b7dc9cf9d6]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_cloudwatch_event_target.events_target: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-reimei-chat-prd-ecr-replication-events-target]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_lambda_permission.event_bridge_can_invoke_lambda: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-for-ecr-replication]
module.ecr_replication_event_handler.module.event_bridge_for_ecr_replication.aws_iam_role_policy_attachment.allow_lambda_to_update_ecs_service: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-ecr-replication-20250626094413866500000003]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Refreshing state... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Refreshing state... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Refreshing state... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-ea-i/541046a0fa42b5bc]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-ea-e/c215ff052437ce9e]
module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/net/reimei-chat-prd-api-e/673df6e0b29c1c19]
module.internal_albs["app-router"].aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-int-ar/28c25a33b18f4184]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb.this: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:loadbalancer/app/reimei-chat-prd-api-i/f521f7be0d231461]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_push: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-push]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_describe_ecr_images_for_replicate[0]: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-describe-ecr-images-for-replicate]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_list_ecr_images: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094412704400000002]
module.iam_roles_for_github_actions_for_main.module.iam_role_for_github_actions_to_update_s3[0].aws_iam_role_policy_attachment.github_ecr_attachment["update-s3"]: Refreshing state... [id=reimei-chat-prd-github-actions-to-update-s3-20250821091155548400000001]
module.internal_ext_api_gateway["tenant"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-ea-e/c215ff052437ce9e/aede997ab1c9232e]
module.internal_api_gateway["api"].module.lb_faced_to_external.aws_lb_listener.basic["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/net/reimei-chat-prd-api-e/673df6e0b29c1c19/f079698298e290f3]
module.internal_ext_api_gateway["tenant"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ext2ecs-prim/09e4b9922da87ad3-20251121102007560700000001]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388]
module.internal_ext_api_gateway["tenant"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289]
module.internal_api_gateway["api"].module.lb_attached_to_ecs.aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128]
module.internal_api_gateway["api"].aws_lb_target_group_attachment.external_to_ecs_lb: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-ext2ecs-prim/33b71d6d0c1e113b-20251121102007589200000002]
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Reading...
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["log-analyzer"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["app-router"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Reading...
module.private_ecs_services["conversation-history"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4]
module.internal_albs["app-router"].aws_lb_listener.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-prim/0957e729a933c87e]
module.internal_lb_listener_rules["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-int-ar-alt/a9ecfb7008acc9ab]
module.private_ecs_services["log-analyzer"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/app-router]
module.private_ecs_services["conversation-history"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/conversation-history]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution]
module.private_ecs_services["app-router"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution]
module.private_ecs_services["app-router"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task]
module.private_ecs_services["log-analyzer"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task]
module.private_ecs_services["app-router"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task]
module.private_ecs_services["app-router"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-alt/991226401e0067d2]
module.private_ecs_services["log-analyzer"].data.aws_iam_policy.blue_green_policy: Read complete after 1s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-ea-ar-prim/abb02af94f128c30]
module.lambda_ecr_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_lambda_function: Refreshing state... [id=reimei-chat-prd-lambda-exec-role-for-deploy-lambda/arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function]
module.private_ecs_services["conversation-history"].aws_security_group.this: Refreshing state... [id=sg-0fda2b55faa253ded]
module.private_ecs_services["app-router"].aws_security_group.this: Refreshing state... [id=sg-044cd67181d59b4f2]
module.private_ecs_services["log-analyzer"].aws_security_group.this: Refreshing state... [id=sg-0e32e2b457b1d9b98]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/38946e523a06c388/b172f01266ff7c99]
module.internal_ext_api_gateway["tenant"].module.listener_rules_to_ecs["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-ea-i/541046a0fa42b5bc/3f2ab3b133dd237e/821eedc6c8b5d8ee]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/6a78564a4ab85d9c/51431882a72f328d]
module.internal_lb_listener_rules["app-router"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-int-ar/28c25a33b18f4184/79fbd94be9dc0fd4/62865bb6be5fffc7]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution:reimei-chat-prd-ecs-secrets]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-2025050907325071280000000b]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025306789500000002]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-20250509073250430600000008]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-app-router-ecs-execution-2025050907325068750000000a]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-execution-20250509073250647000000009]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-execution-20250530025307025300000003]
module.private_ecs_services["app-router"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["conversation-history"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.private_ecs_services["app-router"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-ecs-session-manager]
module.ecs_cron_task.aws_iam_role_policy.scheduler_run_ecs: Refreshing state... [id=reimei-chat-prd-log-analyzer-scheduler-role:reimei-chat-prd-log-analyzer-scheduler-run-ecs-task-policy]
aws_iam_role_policy.allow_log_analyzer_access_input_bucket: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-log-analyzer-access-input-bucket]
module.private_ecs_services["log-analyzer"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-log-analyzer-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["log-analyzer"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-log-analyzer]
module.private_ecs_services["conversation-history"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-ecs-session-manager]
module.private_ecs_services["app-router"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-app-router]
module.private_ecs_services["conversation-history"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-conversation-history]
aws_iam_role_policy.allow_ecs_dynamo_db: Refreshing state... [id=reimei-chat-prd-conversation-history-ecs-task:reimei-chat-prd-conversation-history-ecs-dynamo-db]
module.private_ecs_services["conversation-history"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/conversation-history]
module.ecs_cron_task.aws_scheduler_schedule.this: Refreshing state... [id=default/reimei-chat-prd-run-ecs-task-log-analyzer-via-scheduler]
module.private_ecs_services["log-analyzer"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/log-analyzer]
module.private_ecs_services["app-router"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Reading...
module.public_ecs_services["backend"].data.aws_caller_identity.current: Reading...
module.public_ecs_services["backend"].aws_cloudwatch_log_group.this: Refreshing state... [id=/ecs/reimei-chat-prd/backend]
module.public_ecs_services["backend"].aws_iam_role.ecs_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["alt"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-alt/1b05a7d30e95fbbb]
module.public_ecs_services["backend"].aws_iam_role.ecs_blue_green_role[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_target_group.this["prim"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:targetgroup/reimei-chat-prd-api-be-prim/55e3441bad78dfa4]
module.public_ecs_services["backend"].aws_iam_role.ecs_task: Refreshing state... [id=reimei-chat-prd-backend-ecs-task]
module.public_ecs_services["backend"].aws_security_group.this: Refreshing state... [id=sg-0c129765d0e4e1166]
module.public_ecs_services["backend"].data.aws_caller_identity.current: Read complete after 0s [id=050451382758]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["production"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/e1ceb70f9ae13128/79af99126b5d4efa]
module.internal_api_gateway["api"].module.listener_rules_to_ecs["backend"].aws_lb_listener_rule.blue_green_deployment["test"]: Refreshing state... [id=arn:aws:elasticloadbalancing:ap-northeast-1:050451382758:listener-rule/app/reimei-chat-prd-api-i/f521f7be0d231461/13355033b9c24289/b1b6ca8c19154f5f]
module.public_ecs_services["backend"].data.aws_iam_policy.blue_green_policy: Read complete after 0s [id=arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.ecs_blue_green_policy[0]: Refreshing state... [id=reimei-chat-prd-backend-ecs-control-lb-role/arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForLoadBalancers]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution:reimei-chat-prd-ecs-secrets]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_secrets: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343069900000010]
module.public_ecs_services["backend"].aws_iam_role_policy_attachment.allow_ecs_execution_task_execution: Refreshing state... [id=reimei-chat-prd-backend-ecs-execution-20250509074343087000000011]
module.public_ecs_services["backend"].aws_iam_role_policy.allow_ecs_task_session_manager: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-ecs-session-manager]
aws_iam_role_policy.allow_backend_access_coversation_media_meta_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-coversation-media-meta-dynamo-db]
aws_iam_role_policy_attachment.attach_reuters_news_access_policy: Refreshing state... [id=reimei-chat-prd-backend-ecs-task-20250805101204929000000001]
aws_iam_role_policy.allow_backend_access_startup_task_dynamo_db: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-startup-task-dynamo-db]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Refreshing state... [id=reimei-chat-prd-backend]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["app-router"]: Refreshing state... [id=reimei-chat-prd-app-router-ecs-task:reimei-chat-prd-app-router-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_v2_log_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-v2-log-ecs-kinesis]
aws_iam_role_policy.allow_ecs_service_send_to_kinesis["backend"]: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-ecs-kinesis]
module.conversation_media_s3.aws_iam_role_policy.backend_s3_conversation_media: Refreshing state... [id=reimei-chat-prd-backend-ecs-task:reimei-chat-prd-backend-s3-conversation-media]
module.public_ecs_services["backend"].aws_ecs_service.this: Refreshing state... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Reading...
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/app-router"]: Refreshing state... [id=cwlsf-2383437302]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/backend"]: Refreshing state... [id=cwlsf-2951878674]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/conversation-history"]: Refreshing state... [id=cwlsf-1647357105]
module.ecr_replication_event_handler.data.aws_iam_policy_document.deploy_ecs_service: Read complete after 0s [id=3552976742]
aws_cloudwatch_log_subscription_filter.to_firehose["/ecs/reimei-chat-prd/log-analyzer"]: Refreshing state... [id=cwlsf-3414211378]
module.ecr_replication_event_handler.aws_iam_policy.deploy_ecs_service: Refreshing state... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-ecs-service]
module.ecr_replication_event_handler.aws_iam_role_policy_attachment.allow_to_deploy_ecs_service: Refreshing state... [id=reimei-chat-prd-force-ecs-deployment-20250626094414032900000004]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement
 <= read (data resources)

Terraform will perform the following actions:

  # aws_iam_policy.news_embeddings_query_policy will be created
  + resource "aws_iam_policy" "news_embeddings_query_policy" {
      + arn              = (known after apply)
      + attachment_count = (known after apply)
      + id               = (known after apply)
      + name             = "reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy"
      + name_prefix      = (known after apply)
      + path             = "/"
      + policy           = jsonencode(
            {
              + Statement = [
                  + {
                      + Action   = [
                          + "s3vectors:QueryVectors",
                        ]
                      + Effect   = "Allow"
                      + Resource = [
                          + "*",
                        ]
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + policy_id        = (known after apply)
      + tags_all         = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
    }

  # aws_iam_policy.reuters_news_s3_read_policy will be updated in-place
  ~ resource "aws_iam_policy" "reuters_news_s3_read_policy" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
        name             = "reimei-chat-prd-ecs-access-to-s3-reuters-news-policy"
      ~ policy           = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Resource = [
                            # (1 unchanged element hidden)
                            "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/news/*",
                          + "arn:aws:s3:::reimei-chat-dp-prd-050451382758-sbnews-to-s3-result/latest.jsonl",
                        ]
                        # (2 unchanged attributes hidden)
                    },
                ]
                # (1 unchanged attribute hidden)
            }
        )
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # aws_iam_role_policy_attachment.attach_news_embeddings_query_policy will be created
  + resource "aws_iam_role_policy_attachment" "attach_news_embeddings_query_policy" {
      + id         = (known after apply)
      + policy_arn = (known after apply)
      + role       = "reimei-chat-prd-backend-ecs-task"
    }

  # module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function will be read during apply
  # (depends on a resource or a module with changes pending)
 <= data "aws_iam_policy_document" "deploy_lambda_function" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "lambda:UpdateFunctionCode",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:lambda:ap-northeast-1:050451382758:function:*",
            ]
        }
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "push_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0] will be updated in-place
  ~ resource "aws_cloudwatch_event_target" "replication_target" {
      ~ arn            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
        id             = "reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target"
        # (8 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_iam_policy.deploy_lambda_function will be updated in-place
  ~ resource "aws_iam_policy" "deploy_lambda_function" {
        id               = "arn:aws:iam::050451382758:policy/reimei-chat-prd-deploy-lambda-function"
        name             = "reimei-chat-prd-deploy-lambda-function"
      ~ policy           = jsonencode(
            {
              - Statement = [
                  - {
                      - Action   = "lambda:UpdateFunctionCode"
                      - Effect   = "Allow"
                      - Resource = "arn:aws:lambda:ap-northeast-1:050451382758:function:*"
                    },
                ]
              - Version   = "2012-10-17"
            }
        ) -> (known after apply)
        tags             = {}
        # (7 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_function.this must be replaced
-/+ resource "aws_lambda_function" "this" {
      ~ architectures                  = [
          - "x86_64",
        ] -> (known after apply)
      ~ arn                            = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda" -> (known after apply)
      ~ code_sha256                    = "db35abee9dd09ed96c479fed24d770118bb71c75118afa6541697cdf7187cc70" -> (known after apply)
      ~ function_name                  = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                             = "deploy-lambda" -> (known after apply)
      ~ invoke_arn                     = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda/invocations" -> (known after apply)
      ~ last_modified                  = "2025-12-08T09:58:30.140+0000" -> (known after apply)
      - layers                         = [] -> null
      ~ qualified_arn                  = "arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1" -> (known after apply)
      ~ qualified_invoke_arn           = "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:050451382758:function:deploy-lambda:1/invocations" -> (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + source_code_hash               = (known after apply)
      ~ source_code_size               = 0 -> (known after apply)
      - tags                           = {} -> null
      ~ version                        = "1" -> (known after apply)
        # (16 unchanged attributes hidden)

      ~ ephemeral_storage (known after apply)
      - ephemeral_storage {
          - size = 512 -> null
        }

      ~ logging_config (known after apply)
      - logging_config {
          - log_format            = "Text" -> null
          - log_group             = "/aws/lambda/deploy-lambda" -> null
            # (2 unchanged attributes hidden)
        }

      ~ tracing_config (known after apply)
      - tracing_config {
          - mode = "PassThrough" -> null
        }

        # (1 unchanged block hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_push" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0] must be replaced
-/+ resource "aws_lambda_permission" "event_bridge_can_invoke_lambda_for_ecr_replication" {
      ~ function_name       = "deploy-lambda" -> "reimei-chat-prd-deploy-lambda" # forces replacement
      ~ id                  = "reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication" -> (known after apply)
      + statement_id_prefix = (known after apply)
        # (6 unchanged attributes hidden)
    }

  # module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy will be read during apply
  # (config refers to values not yet known)
 <= data "aws_iam_policy_document" "lambda_exec_policy" {
      + id            = (known after apply)
      + json          = (known after apply)
      + minified_json = (known after apply)

      + statement {
          + actions   = [
              + "logs:CreateLogGroup",
              + "logs:CreateLogStream",
              + "logs:PutLogEvents",
            ]
          + effect    = "Allow"
          + resources = [
              + "*",
            ]
          + sid       = "Logs"
        }
      + statement {
          + actions   = [
              + "sqs:ChangeMessageVisibility",
              + "sqs:DeleteMessage",
              + "sqs:GetQueueAttributes",
              + "sqs:ReceiveMessage",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "SqsIngest"
        }
      + statement {
          + actions   = [
              + "s3:GetObject",
            ]
          + effect    = "Allow"
          + resources = [
              + "arn:aws:s3:::reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result/*",
            ]
          + sid       = "AllowFetchNews"
        }
      + statement {
          + actions   = [
              + "s3vectors:PutVectors",
            ]
          + effect    = "Allow"
          + resources = [
              + (known after apply),
            ]
          + sid       = "AllowUploadIndexToS3Vector"
        }
    }

  # module.news_embeddings_uploader.aws_iam_role.this will be created
  + resource "aws_iam_role" "this" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "lambda.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "reimei-chat-prd-embeddings-uploader-exec-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags_all              = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy.this will be created
  + resource "aws_iam_role_policy" "this" {
      + id          = (known after apply)
      + name        = "reimei-chat-prd-news-embeddings-uploader-exec-policy"
      + name_prefix = (known after apply)
      + policy      = (known after apply)
      + role        = (known after apply)
    }

  # module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access will be created
  + resource "aws_iam_role_policy_attachment" "lambda_vpc_access" {
      + id         = (known after apply)
      + policy_arn = "arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole"
      + role       = "reimei-chat-prd-embeddings-uploader-exec-role"
    }

  # module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs will be created
  + resource "aws_lambda_event_source_mapping" "from_sqs" {
      + arn                                = (known after apply)
      + batch_size                         = 10
      + enabled                            = true
      + event_source_arn                   = (known after apply)
      + function_arn                       = (known after apply)
      + function_name                      = (known after apply)
      + function_response_types            = [
          + "ReportBatchItemFailures",
        ]
      + id                                 = (known after apply)
      + last_modified                      = (known after apply)
      + last_processing_result             = (known after apply)
      + maximum_batching_window_in_seconds = 1
      + maximum_record_age_in_seconds      = (known after apply)
      + maximum_retry_attempts             = (known after apply)
      + parallelization_factor             = (known after apply)
      + region                             = "ap-northeast-1"
      + state                              = (known after apply)
      + state_transition_reason            = (known after apply)
      + tags_all                           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + uuid                               = (known after apply)

      + amazon_managed_kafka_event_source_config (known after apply)

      + self_managed_kafka_event_source_config (known after apply)
    }

  # module.news_embeddings_uploader.aws_lambda_function.this will be created
  + resource "aws_lambda_function" "this" {
      + architectures                  = (known after apply)
      + arn                            = (known after apply)
      + code_sha256                    = (known after apply)
      + function_name                  = "reimei-chat-prd-news-embeddings-uploader"
      + id                             = (known after apply)
      + image_uri                      = "050451382758.dkr.ecr.ap-northeast-1.amazonaws.com/sbint-services/reimei-chat-prd/lambda/news-embeddings-uploader:edge"
      + invoke_arn                     = (known after apply)
      + last_modified                  = (known after apply)
      + memory_size                    = 512
      + package_type                   = "Image"
      + publish                        = false
      + qualified_arn                  = (known after apply)
      + qualified_invoke_arn           = (known after apply)
      + region                         = "ap-northeast-1"
      + reserved_concurrent_executions = -1
      + role                           = (known after apply)
      + signing_job_arn                = (known after apply)
      + signing_profile_version_arn    = (known after apply)
      + skip_destroy                   = false
      + source_code_hash               = (known after apply)
      + source_code_size               = (known after apply)
      + tags_all                       = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + timeout                        = 60
      + version                        = (known after apply)

      + environment {
          + variables = {
              + "EMBEDDINGS_ENDPOINT"  = "http://internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com/internal/v1/embeddings"
              + "EMBEDDINGS_MODEL"     = "sarashina-embedding-v2-1b"
              + "HTTPS_PROXY"          = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "HTTP_PROXY"           = "http://SBINT-NLB-DEEPRESEARCH-PROXY-e47376a3534555ad.elb.ap-northeast-1.amazonaws.com:8080"
              + "LOG_LEVEL"            = "INFO"
              + "NO_PROXY"             = "internal-reimei-chat-prd-int-ar-65931021.ap-northeast-1.elb.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
              + "VECTOR_BUCKET_NAME"   = "reimei-chat-prd-050451382758-news-vector"
              + "VECTOR_BUCKET_REGION" = "ap-northeast-1"
              + "VECTOR_INDEX_NAME"    = "news-index"
            }
        }

      + ephemeral_storage (known after apply)

      + logging_config (known after apply)

      + tracing_config (known after apply)

      + vpc_config {
          + ipv6_allowed_for_dual_stack = false
          + security_group_ids          = (known after apply)
          + subnet_ids                  = [
              + "subnet-051ac932c7f0b27c6",
              + "subnet-07a1e2ac6b7f74854",
              + "subnet-0f352bd385624c1d6",
            ]
          + vpc_id                      = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3_bucket_notification.this will be created
  + resource "aws_s3_bucket_notification" "this" {
      + bucket      = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
      + eventbridge = false
      + id          = (known after apply)
      + region      = "ap-northeast-1"

      + queue {
          + events        = [
              + "s3:ObjectCreated:Put",
            ]
          + filter_prefix = "news/"
          + id            = (known after apply)
          + queue_arn     = (known after apply)
        }
    }

  # module.news_embeddings_uploader.aws_s3vectors_index.this will be created
  + resource "aws_s3vectors_index" "this" {
      + creation_time      = (known after apply)
      + data_type          = "float32"
      + dimension          = 1792
      + distance_metric    = "cosine"
      + index_arn          = (known after apply)
      + index_name         = "news-index"
      + region             = "ap-northeast-1"
      + tags_all           = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_name = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this will be created
  + resource "aws_s3vectors_vector_bucket" "this" {
      + creation_time            = (known after apply)
      + encryption_configuration = (known after apply)
      + force_destroy            = false
      + region                   = "ap-northeast-1"
      + tags_all                 = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vector_bucket_arn        = (known after apply)
      + vector_bucket_name       = "reimei-chat-prd-050451382758-news-vector"
    }

  # module.news_embeddings_uploader.aws_security_group.this will be created
  + resource "aws_security_group" "this" {
      + arn                    = (known after apply)
      + description            = "Allow outbound traffic from Lambda"
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + "0.0.0.0/0",
                ]
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = "-1"
              + security_groups  = []
              + self             = false
              + to_port          = 0
                # (1 unchanged attribute hidden)
            },
        ]
      + id                     = (known after apply)
      + ingress                = (known after apply)
      + name                   = "reimei-chat-prd-embeddings-uploader-sg-group"
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + region                 = "ap-northeast-1"
      + revoke_rules_on_delete = false
      + tags_all               = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + vpc_id                 = "vpc-07758e1658c4c2149"
    }

  # module.news_embeddings_uploader.aws_sqs_queue.dlq will be created
  + resource "aws_sqs_queue" "dlq" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-news-to-embeddings-dlq"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 30
    }

  # module.news_embeddings_uploader.aws_sqs_queue.this will be created
  + resource "aws_sqs_queue" "this" {
      + arn                               = (known after apply)
      + content_based_deduplication       = false
      + deduplication_scope               = (known after apply)
      + delay_seconds                     = 0
      + fifo_queue                        = false
      + fifo_throughput_limit             = (known after apply)
      + id                                = (known after apply)
      + kms_data_key_reuse_period_seconds = (known after apply)
      + max_message_size                  = 262144
      + message_retention_seconds         = 345600
      + name                              = "reimei-chat-prd-ingest-news-to-embeddings"
      + name_prefix                       = (known after apply)
      + policy                            = (known after apply)
      + receive_wait_time_seconds         = 0
      + redrive_allow_policy              = (known after apply)
      + redrive_policy                    = (known after apply)
      + region                            = "ap-northeast-1"
      + sqs_managed_sse_enabled           = (known after apply)
      + tags_all                          = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }
      + url                               = (known after apply)
      + visibility_timeout_seconds        = 180
    }

  # module.news_embeddings_uploader.aws_sqs_queue_policy.this will be created
  + resource "aws_sqs_queue_policy" "this" {
      + id        = (known after apply)
      + policy    = (known after apply)
      + queue_url = (known after apply)
      + region    = "ap-northeast-1"
    }

  # module.private_ecs_services["app-router"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router"
        name                               = "app-router"
        tags                               = {}
        # (20 unchanged attributes hidden)

      ~ service_connect_configuration {
            # (2 unchanged attributes hidden)

          ~ service {
                # (3 unchanged attributes hidden)

              ~ timeout {
                  ~ per_request_timeout_seconds = 180 -> 660
                    # (1 unchanged attribute hidden)
                }

                # (1 unchanged block hidden)
            }

            # (1 unchanged block hidden)
        }

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_service.this will be updated in-place
  ~ resource "aws_ecs_service" "this" {
        id                                 = "arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend"
        name                               = "backend"
        tags                               = {}
      ~ task_definition                    = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
        # (19 unchanged attributes hidden)

        # (6 unchanged blocks hidden)
    }

  # module.public_ecs_services["backend"].aws_ecs_task_definition.this must be replaced
-/+ resource "aws_ecs_task_definition" "this" {
      ~ arn                      = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend:50" -> (known after apply)
      ~ arn_without_revision     = "arn:aws:ecs:ap-northeast-1:050451382758:task-definition/reimei-chat-prd-backend" -> (known after apply)
      ~ container_definitions    = jsonencode(
          ~ [
              ~ {
                  ~ environment      = [
                        # (20 unchanged elements hidden)
                        {
                            name  = "LOGLEVEL"
                            value = "INFO"
                        },
                      ~ {
                          ~ name  = "NEWS__BUCKET" -> "NEWS__ALLOWED_NEWS_SOURCE"
                          ~ value = "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result" -> jsonencode(
                                [
                                  + "reuters",
                                ]
                            )
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_ENDPOINT" -> "NEWS__REUTERS__BUCKET"
                          ~ value = "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings" -> "reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result"
                        },
                      ~ {
                          ~ name  = "NEWS__EMBEDDINGS_MODEL" -> "NEWS__REUTERS__EMBEDDINGS_ENDPOINT"
                          ~ value = "sarashina-embedding-v2-1b" -> "http://http-server-app-router.reimei-chat-prd:80/internal/v1/embeddings"
                        },
                      ~ {
                          ~ name  = "NEWS__IMAGE_URL_BASE" -> "NEWS__REUTERS__EMBEDDINGS_MODEL"
                          ~ value = "https://sarashina.sbintuitions.com" -> "sarashina-embedding-v2-1b"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET" -> "NEWS__REUTERS__IMAGE_URL_BASE"
                          ~ value = "" -> "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_BUCKET_REGION" -> "NEWS__REUTERS__S3_VECTOR_BUCKET"
                          ~ value = "us-west-2" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                          ~ name  = "NEWS__S3_VECTOR_INDEX" -> "NEWS__REUTERS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "" -> "ap-northeast-1"
                        },
                      ~ {
                          ~ name  = "NEWS__TOP_K" -> "NEWS__REUTERS__S3_VECTOR_INDEX"
                          ~ value = "3" -> "news-index"
                        },
                      + {
                          + name  = "NEWS__REUTERS__TOP_K"
                          + value = "3"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__BUCKET"
                          + value = "reimei-chat-dp-prd-050451382758-sbnews-to-s3-result"
                        },
                      + {
                          + name  = "NEWS__SOFTBANK__KEY"
                          + value = "latest.jsonl"
                        },
                        {
                            name  = "NO_PROXY"
                            value = "localhost,http-server-app-router.reimei-chat-prd,http-server-conversation-history.reimei-chat-prd,169.254.170.2,dynamodb.ap-northeast-1.amazonaws.com,s3.ap-northeast-1.amazonaws.com"
                        },
                        # (4 unchanged elements hidden)
                        {
                            name  = "REUTERS_NEWS__IMAGE_URL_BASE"
                            value = "https://sarashina.sbintuitions.com"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET"
                          ~ value = "" -> "reimei-chat-prd-050451382758-news-vector"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_BUCKET_REGION"
                          ~ value = "us-west-2" -> "ap-northeast-1"
                        },
                      ~ {
                            name  = "REUTERS_NEWS__S3_VECTOR_INDEX"
                          ~ value = "" -> "news-index"
                        },
                        {
                            name  = "REUTERS_NEWS__TOP_K"
                            value = "3"
                        },
                        # (13 unchanged elements hidden)
                    ]
                    name             = "backend"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
              ~ {
                    name             = "datadog-agent"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (12 unchanged attributes hidden)
                },
              ~ {
                    name             = "fluent-bit"
                  - systemControls   = []
                  - volumesFrom      = []
                    # (10 unchanged attributes hidden)
                },
            ] # forces replacement
        )
      ~ enable_fault_injection   = false -> (known after apply)
      ~ id                       = "reimei-chat-prd-backend" -> (known after apply)
      ~ revision                 = 50 -> (known after apply)
      - tags                     = {} -> null
        # (13 unchanged attributes hidden)

      - volume {
          - configure_at_launch = false -> null
          - name                = "dd-sockets" -> null
            # (1 unchanged attribute hidden)
        }
      + volume {
          + configure_at_launch = (known after apply)
          + name                = "dd-sockets"
            # (1 unchanged attribute hidden)
        }
    }

  # module.s3_tfstate.aws_s3_bucket.tfstate_bucket will be updated in-place
  # (imported from "reimei-chat-prd-tfstate")
  ~ resource "aws_s3_bucket" "tfstate_bucket" {
        acceleration_status         = null
        arn                         = "arn:aws:s3:::reimei-chat-prd-tfstate"
        bucket                      = "reimei-chat-prd-tfstate"
        bucket_domain_name          = "reimei-chat-prd-tfstate.s3.amazonaws.com"
        bucket_prefix               = null
        bucket_region               = "ap-northeast-1"
        bucket_regional_domain_name = "reimei-chat-prd-tfstate.s3.ap-northeast-1.amazonaws.com"
        force_destroy               = false
        hosted_zone_id              = "Z2M4EHUR26P7ZW"
        id                          = "reimei-chat-prd-tfstate"
        object_lock_enabled         = false
        policy                      = null
        region                      = "ap-northeast-1"
        request_payer               = "BucketOwner"
        tags                        = {}
      ~ tags_all                    = {
          + "Env"         = "prd"
          + "Project"     = "reimei-chat"
          + "Terraform"   = "true"
          + "environment" = "prod"
          + "product"     = "reimei"
        }

        grant {
            id          = "aba2623a7e748e27b1f7d715c83e5307c9773c6b5c706fa453e238831b00e4e3"
            permissions = [
                "FULL_CONTROL",
            ]
            type        = "CanonicalUser"
            uri         = null
        }

        server_side_encryption_configuration {
            rule {
                bucket_key_enabled = true

                apply_server_side_encryption_by_default {
                    kms_master_key_id = null
                    sse_algorithm     = "AES256"
                }
            }
        }

        versioning {
            enabled    = true
            mfa_delete = false
        }
    }

  # module.s3_tfstate.aws_s3_bucket_versioning.versioning_tfstate_bucket will be created
  + resource "aws_s3_bucket_versioning" "versioning_tfstate_bucket" {
      + bucket = "reimei-chat-prd-tfstate"
      + id     = (known after apply)
      + region = "ap-northeast-1"

      + versioning_configuration {
          + mfa_delete = (known after apply)
          + status     = "Enabled"
        }
    }

  # module.s3_tfstate.local_file.backend will be created
  + resource "local_file" "backend" {
      + content              = <<-EOT
            terraform {
              backend "s3" {
                bucket  = "reimei-chat-prd-tfstate"
                region  = "ap-northeast-1"
                profile = "AWSAdministratorAccess-050451382758"
                key     = "terraform.tfstate"
                encrypt = true
              }
            }
        EOT
      + content_base64sha256 = (known after apply)
      + content_base64sha512 = (known after apply)
      + content_md5          = (known after apply)
      + content_sha1         = (known after apply)
      + content_sha256       = (known after apply)
      + content_sha512       = (known after apply)
      + directory_permission = "0777"
      + file_permission      = "0644"
      + filename             = "./backend.tf"
      + id                   = (known after apply)
    }

Plan: 1 to import, 20 to add, 7 to change, 4 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Importing... [id=reimei-chat-prd-tfstate]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Import complete [id=reimei-chat-prd-tfstate]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Destroying... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Destroying... [id=reimei-chat-prd-backend]
aws_iam_policy.news_embeddings_query_policy: Creating...
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Destroying... [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.news_embeddings_uploader.aws_sqs_queue.dlq: Creating...
module.news_embeddings_uploader.aws_security_group.this: Creating...
module.news_embeddings_uploader.aws_iam_role.this: Creating...
aws_iam_policy.reuters_news_s3_read_policy: Modifying... [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Modifying... [id=reimei-chat-prd-tfstate]
module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this: Creating...
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Destruction complete after 0s
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Destruction complete after 1s
module.news_embeddings_uploader.aws_s3vectors_vector_bucket.this: Creation complete after 1s
module.private_ecs_services["app-router"].aws_ecs_service.this: Modifying... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
module.news_embeddings_uploader.aws_s3vectors_index.this: Creating...
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Destruction complete after 1s
module.lambda_ecr_event_handler.aws_lambda_function.this: Destroying... [id=deploy-lambda]
module.news_embeddings_uploader.aws_s3vectors_index.this: Creation complete after 0s
module.lambda_ecr_event_handler.aws_lambda_function.this: Destruction complete after 0s
module.lambda_ecr_event_handler.aws_lambda_function.this: Creating...
module.s3_tfstate.aws_s3_bucket.tfstate_bucket: Modifications complete after 1s [id=reimei-chat-prd-tfstate]
module.s3_tfstate.aws_s3_bucket_versioning.versioning_tfstate_bucket: Creating...
module.s3_tfstate.local_file.backend: Creating...
module.s3_tfstate.local_file.backend: Creation complete after 0s [id=8acd63d089fbb6aec263b48d72e556996b3b79aa]
aws_iam_policy.news_embeddings_query_policy: Creation complete after 1s [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy]
aws_iam_policy.reuters_news_s3_read_policy: Modifications complete after 2s [id=arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-reuters-news-policy]
module.news_embeddings_uploader.aws_iam_role.this: Creation complete after 2s [id=reimei-chat-prd-embeddings-uploader-exec-role]
module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access: Creating...
module.private_ecs_services["app-router"].aws_ecs_service.this: Modifications complete after 1s [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/app-router]
aws_iam_role_policy_attachment.attach_news_embeddings_query_policy: Creating...
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Creating...
module.public_ecs_services["backend"].aws_ecs_task_definition.this: Creation complete after 0s [id=reimei-chat-prd-backend]
module.public_ecs_services["backend"].aws_ecs_service.this: Modifying... [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
module.news_embeddings_uploader.aws_iam_role_policy_attachment.lambda_vpc_access: Creation complete after 0s [id=reimei-chat-prd-embeddings-uploader-exec-role/arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole]
module.news_embeddings_uploader.aws_security_group.this: Creation complete after 2s [id=sg-054214f0bd0ee4c30]
module.news_embeddings_uploader.aws_lambda_function.this: Creating...
aws_iam_role_policy_attachment.attach_news_embeddings_query_policy: Creation complete after 0s [id=reimei-chat-prd-backend-ecs-task/arn:aws:iam::050451382758:policy/reimei-chat-prd-ecs-access-to-s3-vectors-news-embeddings-policy]
module.s3_tfstate.aws_s3_bucket_versioning.versioning_tfstate_bucket: Creation complete after 1s [id=reimei-chat-prd-tfstate]
module.public_ecs_services["backend"].aws_ecs_service.this: Modifications complete after 1s [id=arn:aws:ecs:ap-northeast-1:050451382758:service/reimei-chat-prd/backend]
module.news_embeddings_uploader.aws_sqs_queue.dlq: Still creating... [00m10s elapsed]
module.lambda_ecr_event_handler.aws_lambda_function.this: Still creating... [00m10s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [00m10s elapsed]
module.news_embeddings_uploader.aws_sqs_queue.dlq: Still creating... [00m20s elapsed]
module.lambda_ecr_event_handler.aws_lambda_function.this: Creation complete after 20s [id=reimei-chat-prd-deploy-lambda]
module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function: Reading...
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Creating...
module.lambda_ecr_event_handler.data.aws_iam_policy_document.deploy_lambda_function: Read complete after 0s [id=751831997]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Creating...
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Modifying... [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Modifying... [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.push_target: Modifications complete after 0s [id=reimei-chat-prd-ecr-push-events-for-lambda-reimei-chat-prd-ecr-push-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_replication[0]: Creation complete after 0s [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-replication]
module.lambda_ecr_event_handler.aws_cloudwatch_event_target.replication_target[0]: Modifications complete after 0s [id=reimei-chat-prd-ecr-replication-events-for-lambda-reimei-chat-prd-ecr-replication-events-target]
module.lambda_ecr_event_handler.aws_lambda_permission.event_bridge_can_invoke_lambda_for_ecr_push: Creation complete after 0s [id=reimei-chat-prd-allow-event-bridge-invoke-lambda-to-deploy-lambda-by-ecr-push]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [00m20s elapsed]
module.news_embeddings_uploader.aws_sqs_queue.dlq: Creation complete after 26s [id=https://sqs.ap-northeast-1.amazonaws.com/050451382758/reimei-chat-prd-news-to-embeddings-dlq]
module.news_embeddings_uploader.aws_sqs_queue.this: Creating...
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [00m30s elapsed]
module.news_embeddings_uploader.aws_sqs_queue.this: Still creating... [00m10s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [00m40s elapsed]
module.news_embeddings_uploader.aws_sqs_queue.this: Still creating... [00m20s elapsed]
module.news_embeddings_uploader.aws_sqs_queue.this: Creation complete after 25s [id=https://sqs.ap-northeast-1.amazonaws.com/050451382758/reimei-chat-prd-ingest-news-to-embeddings]
module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy: Reading...
module.news_embeddings_uploader.aws_sqs_queue_policy.this: Creating...
module.news_embeddings_uploader.aws_s3_bucket_notification.this: Creating...
module.news_embeddings_uploader.data.aws_iam_policy_document.lambda_exec_policy: Read complete after 0s [id=967160265]
module.news_embeddings_uploader.aws_iam_role_policy.this: Creating...
module.news_embeddings_uploader.aws_s3_bucket_notification.this: Creation complete after 0s [id=reimei-chat-data-pf-prd-reuters-sched-api-to-s3-result]
module.news_embeddings_uploader.aws_iam_role_policy.this: Creation complete after 0s [id=reimei-chat-prd-embeddings-uploader-exec-role:reimei-chat-prd-news-embeddings-uploader-exec-policy]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [00m50s elapsed]
module.news_embeddings_uploader.aws_sqs_queue_policy.this: Still creating... [00m10s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m00s elapsed]
module.news_embeddings_uploader.aws_sqs_queue_policy.this: Still creating... [00m20s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m10s elapsed]
module.news_embeddings_uploader.aws_sqs_queue_policy.this: Creation complete after 25s [id=https://sqs.ap-northeast-1.amazonaws.com/050451382758/reimei-chat-prd-ingest-news-to-embeddings]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m20s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m30s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m40s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [01m50s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [02m00s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [02m10s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Still creating... [02m20s elapsed]
module.news_embeddings_uploader.aws_lambda_function.this: Creation complete after 2m20s [id=reimei-chat-prd-news-embeddings-uploader]
module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs: Creating...
module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs: Still creating... [00m10s elapsed]
module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs: Still creating... [00m20s elapsed]
module.news_embeddings_uploader.aws_lambda_event_source_mapping.from_sqs: Creation complete after 24s [id=dccd6d2b-a254-4cc7-b4ed-c4930642fa52]

Apply complete! Resources: 1 imported, 20 added, 6 changed, 4 destroyed.

prod.shogo.kagami@VSOC-DESKTOP01 MINGW64 ~/deploy_20251224-3_app/reimei_RAG/terraform/environments/prod ((sbkk-prod-release-20251224-3))
$
